{
	"variables": {},
	"f1mdz5001sc51d": {
		"paused": false,
		"id": "f1mdz5001sc51d",
		"reference": "",
		"author": "",
		"group": "",
		"icon": "fa fa-bullhorn",
		"color": "#E8483F",
		"version": "",
		"readme": "",
		"url": "https://",
		"name": "OpenAI Test",
		"components": {},
		"design": {},
		"variables": {},
		"sources": {},
		"origin": "http://localhost:8002",
		"dtcreated": "2025-04-06T17:40:34.503Z",
		"size": 494,
		"variables2": {},
		"directory": "F:/sync/factory_platform/flowstream/flowstream/",
		"sandbox": false
	},
	"f1meus001sc51d": {
		"paused": false,
		"id": "f1meus001sc51d",
		"reference": "",
		"author": "",
		"group": "",
		"icon": "fas fa-microchip",
		"color": "",
		"version": "",
		"readme": "",
		"url": "https://",
		"name": "IAAPI",
		"components": {
			"trigger": "<script total>\n\n\texports.id = 'trigger';\n\texports.name = 'Trigger';\n\texports.group = 'Triggers';\n\texports.version = '5';\n\texports.icon = 'ti ti-start';\n\texports.author = 'Total.js';\n\texports.config = { random: true, type: 'string', data: '', restart: false, prompt: false };\n\texports.outputs = [{ id: 'output', name: 'Output' }];\n\texports.kind = 'trigger';\n\n\texports.make = function(instance, config) {\n\n\t\tvar regprompt = /\\{prompt\\}/g;\n\n\t\tinstance.trigger = function(msg) {\n\n\t\t\tvar random = !config.prompt && config.random;\n\t\t\tvar val = config.data;\n\t\t\tvar prompt = msg.value || '';\n\n\t\t\tswitch (config.type) {\n\t\t\t\tcase 'number':\n\t\t\t\t\tval = random ? U.random() : val.replace(regprompt, prompt).parseFloat();\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'buffer':\n\t\t\t\t\ttry {\n\t\t\t\t\t\tval = random ? Buffer.from(U.random_string()) : Buffer.from(val.replace(regprompt, prompt), 'base64');\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tinstance.throw(e);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'date':\n\t\t\t\t\tval = random ? NOW.add('-' + U.random(500, 10) + ' seconds') : val.replace(regprompt, prompt).parseDate();\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'object':\n\t\t\t\t\ttry {\n\t\t\t\t\t\tval = random ? {} : (new Function('return ' + val.replace(regprompt, prompt)))();\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tinstance.throw(e);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'boolean':\n\t\t\t\t\tvar tmp = random ? '' : val.replace(regprompt, prompt);\n\t\t\t\t\tval = random ? U.random() % 2 === 0 : tmp === 'true' || tmp === 'on' || tmp === '1';\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tval = random ? U.random_string(20) : val.replace(regprompt, prompt);\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tinstance.send('output', val);\n\t\t};\n\n\t\tconfig.restart && setTimeout(() => instance.trigger(), 5000);\n\t};\n\n</script>\n\n<style>\n\t.CLASS .padding { padding: 0 10px 10px; }\n\t.CLASS button { width: 100%; height: 24px; border: 1px solid #E0E0E0; border-radius: var(--radius); color: #000; background-color: #F0F0F0; margin: 0; }\n\t.CLASS button:hover { background-color: #F8F8F8; }\n\t.CLASS button:active { background-color: #E0E0E0; }\n\t.ui-dark .CLASS button { border-color: #404040; color: #FFF; background-color: #222; }\n\t.ui-dark .CLASS button:hover { background-color: #303030; }\n\t.ui-dark .CLASS button:active { background-color: #404040; }\n</style>\n\n<settings>\n\t<div class=\"padding\">\n\t\t<ui-component name=\"input\" path=\"?.type\" config=\"dirsource:string|String,number|Number,boolean|Boolean,date|Date,object|Object,buffer|Buffer as Base64;required:1\">Type</ui-component>\n\t\t<div class=\"mt10 m\">\n\t\t\t<ui-component name=\"input\" path=\"?.restart\" config=\"type:checkbox\">Trigger 5s after initialization.</ui-component>\n\t\t\t<ui-component name=\"input\" path=\"?.prompt\" config=\"type:checkbox\">Prompt</ui-component>\n\t\t\t<ui-bind path=\"?.prompt\" config=\"disabled\" class=\"block\">\n\t\t\t\t<ui-component name=\"input\" path=\"?.random\" config=\"type:checkbox\">Random data</ui-component>\n\t\t\t</ui-bind>\n\t\t\t<ui-bind path=\"?.prompt\" config=\"show\" class=\"block hidden m mt10\">\n\t\t\t\t<ui-component name=\"input\" path=\"?.promptlabel\" config=\"placeholder:Enter a value\"><b>Prompt label</b></ui-component>\n\t\t\t</ui-bind>\n\t\t</div>\n\t\t<ui-bind path=\"?\" config=\"hide:value.hide && !value.prompt || (value.random && !value.prompt)\" class=\"hidden\">\n\t\t\t<hr />\n\t\t\t<ui-component name=\"input\" path=\"?.data\" config=\"required:1;height:250;type:multiline;maxlength:100000;monospace:1\">Data</ui-component>\n\t\t\t<ui-bind path=\"?.prompt\" config=\"show\" class=\"help hidden\">The prompt value will be assigned to the <code>{prompt}</code> keyword in the code.</ui-bind>\n\t\t</ui-bind>\n\t</div>\n</settings>\n\n<readme>\nThe component triggers data into the Flow.\n</readme>\n\n<body>\n\t<header>\n\t\t<i class=\"$ICON\"></i>$NAME\n\t</header>\n\t<div class=\"padding\">\n\t\t<button name=\"run\">Run</button>\n\t</div>\n</body>\n\n<script>\n\tTOUCH(function(exports) {\n\t\texports.click = function(el) {\n\t\t\tif (exports.config.prompt) {\n\t\t\t\tvar opt = {};\n\t\t\t\topt.name = exports.config.promptlabel || 'Enter a value';\n\t\t\t\topt.value = '';\n\t\t\t\topt.callback = val => exports.trigger({ value: val });\n\t\t\t\tSETTER('prompt/show', opt);\n\t\t\t} else\n\t\t\t\texports.trigger();\n\t\t};\n\t});\n</script>",
			"chatgpt": "<script total>\n\n\texports.id = 'tapichatgptapi';\n\texports.name = 'ChatGPT';\n\texports.icon = 'ti ti-robot';\n\texports.author = 'Total.js';\n\texports.version = '1';\n\texports.group = 'Total.js API Services';\n\texports.config = { token: '', path: '', output: 'text', size: 'small', response: 'buffer' };\n\texports.inputs = [{ id: 'input', name: 'Input' }];\n\texports.outputs = [{ id: 'output', name: 'Output' }, { id: 'error', name: 'Error' }];\n\n\texports.make = function(instance, config) {\n\t\tvar cfg;\n\n\t\tinstance.message = function($) {\n\n\t\t\tif (!cfg.token) {\n\t\t\t\t$.send('error', 'Invalid token');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar payload = cfg.path ? cfg.path.includes('.') ? U.get(cfg.path, $.data) : $.data[cfg.path] : $.data;\n\n\t\t\tif (!payload) {\n\t\t\t\t$.send('error', 'Invalid data');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar data = {};\n\n\t\t\tdata.value = payload;\n\t\t\tdata.output = cfg.output;\n\t\t\tdata.size = cfg.size;\n\n\t\t\tvar api = API('TAPI', 'chatgpt', data).callback(function(err, response) {\n\t\t\t\tif (err)\n\t\t\t\t\t$.send('error', err);\n\t\t\t\telse {\n\t\t\t\t\tif (cfg.output === 'text') {\n\t\t\t\t\t\t$.send('output', response);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tswitch (cfg.response) {\n\t\t\t\t\t\t\tcase 'buffer':\n\t\t\t\t\t\t\t\t$.send('output', response);\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 'base64':\n\t\t\t\t\t\t\t\t$.send('output', response.toString('base64'));\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 'datauri':\n\t\t\t\t\t\t\t\t$.send('output', 'data:image/png;base64,' + response.toString('base64'));\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tapi.options.token = cfg.token;\n\t\t};\n\n\t\tinstance.configure = function() {\n\t\t\tcfg = instance.replace(config);\n\t\t};\n\n\t\tinstance.vary = instance.configure;\n\t\tinstance.configure();\n\n\t};\n\n</script>\n\n<readme>\nBy using this component you can asks ChatGPT / OpenAPI. It utilizes the [Total.js ChatGPT API](https://docs.totaljs.com/totalapi/6c221003eo51c/#128fm001kc51d).\n\n__Input data:__\n\n```js\n// {String} a question for ChatGPT\n'What is Total.js Platform'\n```\n\n__Output data__:\n\nIf `output` is set as Text:\n```js\n{\n    text: 'Total.js Platform is a web development platform that provides a comprehensive set of tools and modules for building modern, scalable, and high-performance web applications. It is based on the Node.js runtime and offers a seamless development experience with a powerful, intuitive, and easy-to-use framework. Total.js Platform includes features such as database integration, real-time communication, server-side rendering, RESTful API support, and more. It also supports various front-end technologies and integrates seamlessly with popular third-party libraries and services, making it a great choice for building full-stack web applications.'\n}\n```\n\nIf `output` is set as Image:\nReturns data according to the component configuration Response type. It can be `Buffer`, `Base64` or `DataURI`.\n</readme>\n\n<settings>\n\t<div class=\"padding bg-smoke\">\n\t\t<div class=\"m\">\n\t\t\t<p><a href=\"https://docs.totaljs.com/totalapi/6c221002eo50c/\" target=\"_blank\"><i class=\"ti ti-caret-right mr5\"></i>Get Total.js API token</a>.<br>The token field supports variables in the form <span class=\"badge badge-medium badge-silver\">{variable}</span>.</p>\n\t\t\t<ui-component name=\"input\" path=\"?.token\" config=\"camouflage:1;required:1;monospace:1\"><b>API token</b></ui-component>\n\t\t</div>\n\t\t<div class=\"m\">\n\t\t\t<ui-component name=\"input\" path=\"?.path\" config=\"monospace:1;placeholder:path.to.property\">Path for reading input data</ui-component>\n\t\t\t<div class=\"help\">Optional. This component will load input data from a specific property/field according to the path.</div>\n\t\t</div>\n\t</div>\n\t<div class=\"padding\">\n\t\t<div class=\"m\">\n\t\t\t<ui-component name=\"input\" path=\"?.output\" config=\"type:select;required:1;dirsource:text|Text,image|Image\">Output</ui-component>\n\t\t</div>\n\t\t<ui-bind path=\"?.output\" config=\"hide:value !== 'image'\">\n\t\t\t<div class=\"grid-2\">\n\t\t\t\t<div class=\"m\">\n\t\t\t\t\t<ui-component name=\"input\" path=\"?.size\" config=\"type:select;dirsource:small|Small,medium|Medium,large|Large\">Size</ui-component>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"m\">\n\t\t\t\t\t<ui-component name=\"input\" path=\"?.response\" config=\"type:select;dirsource:buffer|Buffer,base64|Base64,datauri|DataURI\">Response type</ui-component>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</ui-bind>\n\t</div>\n</settings>\n\n<body>\n\t<header>\n\t\t<i class=\"$ICON\"></i>$NAME\n\t</header>\n</body>",
			"print": "<script total>\n\n\texports.id = 'print';\n\texports.name = 'Print';\n\texports.group = 'Common';\n\texports.version = '6';\n\texports.icon = 'ti ti-print';\n\texports.author = 'Total.js';\n\texports.config = { repo: false, data: true, text: false };\n\texports.inputs = [{ id: 'input', name: 'Input' }];\n\n\texports.make = function(instance, config) {\n\n\t\tfunction serializer(key, value) {\n\t\t\treturn value && value.type === 'Buffer' && value.data ? ('<Buffer ' + value.data.splice(0, 10).map(n => n.toString(16).padLeft(2, '0')).join('') + '...') : value;\n\t\t}\n\n\t\tinstance.message = function($) {\n\n\t\t\tvar data = $.data;\n\n\t\t\tif (config.data !== false) {\n\t\t\t\tif (data instanceof Buffer)\n\t\t\t\t\tdata = '<Buffer ' + data.toString('hex').substring(0, 10) + '...';\n\t\t\t}\n\n\t\t\tvar count = 0;\n\n\t\t\tfor (var key in config) {\n\t\t\t\tif (config[key])\n\t\t\t\t\tcount++;\n\t\t\t}\n\n\t\t\tvar output = count > 1 ? {} : null;\n\n\t\t\tif (config.repo) {\n\t\t\t\tif (output)\n\t\t\t\t\toutput.repo = $.repo;\n\t\t\t\telse\n\t\t\t\t\toutput = $.repository;\n\t\t\t}\n\n\t\t\tif (config.data) {\n\t\t\t\tif (output)\n\t\t\t\t\toutput.data = $.data;\n\t\t\t\telse\n\t\t\t\t\toutput = $.data;\n\t\t\t}\n\n\t\t\tif (output) {\n\t\t\t\toutput = JSON.stringify(output, serializer);\n\t\t\t\tinstance.status(output, 200);\n\t\t\t}\n\n\t\t\t$.destroy();\n\t\t};\n\n\t\tinstance.trigger = function() {\n\t\t\tinstance.status('');\n\t\t};\n\n\t};\n\n</script>\n\n<style>\n\t.CLASS footer > ui-bind { margin: 10px; }\n\t.CLASS pre { font-size: 10px; margin: 0; padding: 5px; background-color: #F0F0F0; border-radius: var(--radius); }\n\t.CLASS .json { white-space: pre; }\n\t.CLASS .noscrollbar { max-height: 250px; }\n\t.CLASS .readme { position: absolute; position: absolute; font-size: 11px; right: 5px; margin-top: -5px; cursor: pointer; }\n\t.ui-dark .CLASS pre { background-color: #404040; tab-size: 2; }\n</style>\n\n<readme>\nThe component prints incoming data in a JSON format.\n</readme>\n\n<settings>\n\t<div class=\"padding\">\n\t\t<ui-component name=\"input\" path=\"?.repo\" config=\"type:checkbox\">Shows repository</ui-component>\n\t\t<ui-component name=\"input\" path=\"?.data\" config=\"type:checkbox\">Shows data</ui-component>\n\t</div>\n</settings>\n\n<body>\n\t<header>\n\t\t<button class=\"exec button\" data-exec=\"FUNC.trigger\">Clear</button>\n\t\t<i class=\"ICON\"></i>NAME\n\t</header>\n\t<footer>\n\t\t<ui-bind path=\"!STATUS\" config=\"html pre:debugprinter;show\" class=\"hidden selectable block\">\n\t\t\t<span class=\"readme\" title=\"Open in new window\"><i class=\"ti ti-window\"></i></span>\n\t\t\t<div class=\"noscrollbar mt5\">\n\t\t\t\t<pre class=\"json\"></pre>\n\t\t\t</div>\n\t\t</ui-bind>\n\t</footer>\n</body>\n\n<script>\n\n\tW.debugprinter = function(value) {\n\t\tif (value) {\n\t\t\tvalue = JSON.parse(value);\n\t\t\tif (typeof(value) === 'string')\n\t\t\t\treturn Thelpers.encode(value);\n\t\t\telse\n\t\t\t\treturn Thelpers.jsonformat(JSON.stringify(value, null, '\\t'));\n\t\t}\n\t};\n\n\tTOUCH(function(exports, reinit) {\n\n\t\tif (reinit)\n\t\t\treturn;\n\n\t\tvar laststatus;\n\n\t\texports.status = function(status, isinit) {\n\t\t\tlaststatus = status;\n\t\t};\n\n\t\texports.element.on('click', '.readme', function() {\n\t\t\tvar status = laststatus ? JSON.parse(laststatus) : null;\n\t\t\tif (typeof(status) !== 'string')\n\t\t\t\tstatus = JSON.stringify(JSON.parse(status), null, '  ');\n\t\t\tFUNC.readme('Debug', '```json\\n' + status + '\\n```');\n\t\t});\n\n\t});\n</script>",
			"printjson": "<script total>\n\n\texports.id = 'printjson';\n\texports.name = 'Print JSON';\n\texports.group = 'Common';\n\texports.version = '2';\n\texports.icon = 'ti ti-print';\n\texports.author = 'Martin Smola';\n\texports.config = { repo: false, data: true };\n\texports.inputs = [{ id: 'input', name: 'Input' }];\n\n\texports.make = function(instance, config) {\n\t\tinstance.message = function($) {\n\n\t\t\tvar data = $.data;\n\n\t\t\tif (config.data !== false) {\n\t\t\t\tif (data instanceof Buffer)\n\t\t\t\t\tdata = data.toString('hex').substring(0, 200);\n\t\t\t}\n\n\t\t\tvar count = 0;\n\n\t\t\tfor (var key in config) {\n\t\t\t\tif (config[key])\n\t\t\t\t\tcount++;\n\t\t\t}\n\n\t\t\tvar output = count > 1 ? {} : null;\n\n\t\t\tif (config.repo) {\n\t\t\t\tif (output)\n\t\t\t\t\toutput.repo = $.repo;\n\t\t\t\telse\n\t\t\t\t\toutput = $.repository;\n\t\t\t}\n\n\t\t\tif (config.data) {\n\t\t\t\tif (output)\n\t\t\t\t\toutput.data = $.data;\n\t\t\t\telse\n\t\t\t\t\toutput = $.data;\n\t\t\t}\n\n\t\t\toutput && instance.status(output, 200);\n\t\t\t$.destroy();\n\t\t};\n\n\t\tinstance.trigger = function() {\n\t\t\tinstance.status('');\n\t\t}\n\n\t};\n\n</script>\n\n<style>\n\t.CLASS footer > ui-component { margin: 10px; }\n\t.CLASS pre { font-size: 10px; margin: 0; padding: 5px; background-color: #F0F0F0; border-radius: var(--radius); }\n\t.CLASS button { float: right; height: 20px; font-size: 11px; border: 1px solid #E0E0E0; border-radius: var(--radius); color: #000; background-color: transparent; margin: 0; padding: 0 5px; }\n\t.CLASS button:hover { background-color: #F8F8F8; }\n\t.CLASS button:active { background-color: #E0E0E0; }\n\t.CLASS .ui-objecttree { background-color: #f0f0f0; padding: 4px; }\n\n\t.ui-dark .CLASS pre { background-color: #404040; tab-size: 2; }\n\t.ui-dark .CLASS button { border-color: #404040; color: #FFF; }\n\t.ui-dark .CLASS button:hover { background-color: #303030; }\n\t.ui-dark .CLASS button:active { background-color: #404040; }\n</style>\n\n<readme>\nThe component prints incoming data in a JSON format.\n</readme>\n\n<settings>\n\t<div class=\"padding\">\n\t\t<ui-component name=\"input\" path=\"?.repo\" config=\"type:checkbox\">Shows repository</ui-component>\n\t\t<ui-component name=\"input\" path=\"?.data\" config=\"type:checkbox\">Shows data</ui-component>\n\t</div>\n</settings>\n\n<script>\n\tFUNC.printjson_click = function(type, data) { // type = path/data\n\t\tnavigator.clipboard.writeText(type === 'path' ? data : STRINGIFY(data)).catch(e => console.error(e));\n\t};\n\n\t$('body').on('click', '.ui-objecttree .ti-copy, .ui-objecttree .ti-link', function(){\n\t\tvar el = $(this);\n\t\tvar iscopy = el.hclass('ti-copy');\n\t\tel.tclass(iscopy ? 'ti-copy' : 'ti-link').tclass('ti-check');\n\t\tsetTimeout(function(){\n\t\t\tel.tclass('ti-check').tclass(iscopy ? 'ti-copy' : 'ti-link');\n\t\t}, 2000);\n\t});\n</script>\n\n<body>\n\t<header>\n\t\t<button class=\"exec\" data-exec=\"FUNC.trigger\">Clear</button>\n\t\t<i class=\"ICON\"></i>NAME\n\t</header>\n\t<footer>\n\t\t<ui-component name=\"objecttree\" path=\"!STATUS\" config=\"exec:FUNC.printjson_click\" class=\"selectable\"></ui-component>\n\t</footer>\n</body>",
			"code": "<script total>\n\n\texports.id = 'code';\n\texports.name = 'Code';\n\texports.group = 'Common';\n\texports.version = '4';\n\texports.icon = 'ti ti-code';\n\texports.author = 'Total.js';\n\texports.config = { outputs: 1, name: 'Code', code: '// instance {FlowStreamInstance};\\n// $ {FlowStreamMessage};\\n// vars {Object};\\n// repo {Object};\\n// data {String/Number/Boolean/Date/Buffer/Object};\\n// $.send(\\'output\\', data); // or simply send(data); which uses the first output\\n// $.destroy();\\n// $.throw(err);\\n\\n// IMPORTANT: If you do not perform re-send, you need to destroy this message via $.destroy() method\\n// IMPORTANT: methods $.send(), $.destroy() and $.throw() can be executed only once\\n\\n// $.send(\\'output\\', data);\\n$.destroy();' };\n\texports.inputs = [{ id: 'input', name: 'Input' }];\n\texports.outputs = [{ id: 'output', name: 'Output' }];\n\texports.meta = { settingswidth: 1200 };\n\n\texports.make = function(instance, config) {\n\n\t\tvar fn;\n\n\t\tinstance.message = function($) {\n\t\t\tif (fn) {\n\t\t\t\ttry {\n\t\t\t\t\tvar send = data => $.send('output', data);\n\t\t\t\t\tfn($.data, instance, $, $, F.require, send, $.repo, $.vars, $.data);\n\t\t\t\t} catch (e) {\n\t\t\t\t\t$.throw(e);\n\t\t\t\t\t$.destroy();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tinstance.configure = function() {\n\t\t\tinstance.outputs = [];\n\t\t\tfor (let i = 1; i <= config.outputs; i++)\n\t\t\t\tinstance.outputs.push({ id: 'output' + (i === 1 ? '' : i), name: 'Output #' + i });\n\t\t\tinstance.save();\n\n\t\t\ttry {\n\t\t\t\tif (config.code) {\n\t\t\t\t\tinstance.status(1);\n\t\t\t\t\tfn = new Function('value', 'instance', '$', 'message', 'require', 'send', 'repo', 'vars', 'data', config.code);\n\t\t\t\t} else {\n\t\t\t\t\tinstance.status(0);\n\t\t\t\t\tfn = null;\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\tfn = null;\n\t\t\t\tinstance.throw('Code: ' + e.message);\n\t\t\t}\n\t\t};\n\n\t\tinstance.close = function() {\n\t\t\tfn = null;\n\t\t};\n\n\t\tinstance.configure();\n\n\t};\n\n</script>\n\n<readme>\nThis component executes a custom JavaScript code as it is.\n\nTo send data to the default output use `send(somedata);`\nTo send data to specific output when number of outputs > 1 use `$.send('outputX', somedata)` where `X` is output index, see example bellow:\n- first output--> `send(somedata)` or `$.send('output', somedata)`\n- second output --> `$.send('output2', somedata)`\n- ...\n- 5th output --> `$.send('output5', somedata)`\n- etc.\n</readme>\n\n<settings>\n\t<div class=\"padding\">\n\t\t<div class=\"row\">\n\t\t\t<div class=\"col-md-10 m\">\n\t\t\t\t<ui-component name=\"input\" path=\"?.name\">Name</ui-component>\n\t\t\t</div>\n\t\t\t<div class=\"col-md-2 m\">\n\t\t\t\t<ui-component name=\"input\" path=\"?.outputs\" config=\"type:number;format:\">Number of outputs</ui-component>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class=\"ui-input-label\">Code:</div>\n\t\t<div class=\"m\">\n\t\t\t<ui-component name=\"codemirror\" path=\"?.code\" config=\"type:javascript;minheight:300;parent:auto;margin:60;tabs:true;trim:true\"></ui-component>\n\t\t</div>\n\t</div>\n</settings>\n\n<script>\n\tTOUCH(function(exports, init) {\n\t\texports.configure = function() {\n\t\t\tvar changes = exports.instance.changes;\n\t\t\tif (changes && changes.newbie) {\n\t\t\t\tvar outputs = [];\n\t\t\t\tvar count = exports.instance.config.outputs;\n\t\t\t\tfor (let i = 1; i <= count; i++)\n\t\t\t\t\toutputs.push({ id: 'output' + (i === 1 ? '' : i), name: (count === 1 ? 'Output' : 'Output #' + i) });\n\t\t\t\texports.instance.outputs = outputs;\n\t\t\t\tUPD('flow.data');\n\t\t\t}\n\t\t}\n\t});\n</script>\n\n<body>\n\t<header>\n\t\t<i class=\"ICON\"></i>NAME\n\t</header>\n</body>"
		},
		"design": {
			"im9728a7r": {
				"id": "im9728a7r",
				"config": {
					"random": true,
					"type": "string",
					"data": "",
					"restart": false,
					"prompt": false
				},
				"x": 108,
				"y": 127,
				"component": "trigger",
				"connections": {
					"output": [
						{
							"id": "im9728lyc",
							"index": "input"
						}
					]
				},
				"template": {
					"icon": "ti ti-start",
					"group": "Triggers",
					"name": "Trigger",
					"outputs": [
						{
							"id": "output",
							"name": "Output"
						}
					]
				}
			},
			"im9728lyc": {
				"id": "im9728lyc",
				"config": {
					"outputs": 1,
					"name": "Code",
					"code": "// instance {FlowStreamInstance};\n// $ {FlowStreamMessage};\n// vars {Object};\n// repo {Object};\n// data {String/Number/Boolean/Date/Buffer/Object};\n// $.send('output', data); // or simply send(data); which uses the first output\n// $.destroy();\n// $.throw(err);\n\n// IMPORTANT: If you do not perform re-send, you need to destroy this message via $.destroy() method\n// IMPORTANT: methods $.send(), $.destroy() and $.throw() can be executed only once\n\n $.send('output', \"HEllo From me\");\n//$.destroy();"
				},
				"x": 428,
				"y": 141,
				"component": "code",
				"connections": {
					"output": [
						{
							"id": "im9728oqc",
							"index": "input"
						}
					]
				},
				"outputs": [
					{
						"id": "output",
						"name": "Output #1"
					}
				],
				"template": {
					"icon": "ti ti-code",
					"group": "Common",
					"name": "Code",
					"inputs": [
						{
							"id": "input",
							"name": "Input"
						}
					],
					"outputs": [
						{
							"id": "output",
							"name": "Output"
						}
					]
				}
			},
			"im9728oqc": {
				"id": "im9728oqc",
				"config": {
					"token": "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",
					"path": "",
					"output": "text",
					"size": "small",
					"response": "buffer"
				},
				"x": 721.0000152587891,
				"y": 166,
				"component": "chatgpt",
				"connections": {
					"output": [
						{
							"id": "im9728qz4",
							"index": "input"
						}
					],
					"error": [
						{
							"id": "im9728u7y",
							"index": "input"
						}
					]
				},
				"template": {
					"icon": "ti ti-robot",
					"group": "Total.js API Services",
					"name": "ChatGPT",
					"inputs": [
						{
							"id": "input",
							"name": "Input"
						}
					],
					"outputs": [
						{
							"id": "output",
							"name": "Output"
						},
						{
							"id": "error",
							"name": "Error"
						}
					]
				}
			},
			"im9728qz4": {
				"id": "im9728qz4",
				"config": {
					"repo": false,
					"data": true,
					"text": false
				},
				"x": 993.0000305175781,
				"y": 72,
				"component": "print",
				"connections": {},
				"template": {
					"icon": "ti ti-print",
					"group": "Common",
					"name": "Print",
					"inputs": [
						{
							"id": "input",
							"name": "Input"
						}
					]
				}
			},
			"im9728u7y": {
				"id": "im9728u7y",
				"config": {
					"repo": false,
					"data": true,
					"text": false
				},
				"x": 1025.0000762939453,
				"y": 309,
				"component": "print",
				"connections": {},
				"template": {
					"icon": "ti ti-print",
					"group": "Common",
					"name": "Print",
					"inputs": [
						{
							"id": "input",
							"name": "Input"
						}
					]
				}
			}
		},
		"variables": {},
		"sources": {},
		"origin": "http://localhost:8002",
		"dtcreated": "2025-04-07T12:39:36.219Z",
		"size": 22523,
		"variables2": {},
		"directory": "F:/sync/factory_platform/flowstream/flowstream/",
		"sandbox": false
	},
	"f1mh7e001ii51d": {
		"paused": false,
		"id": "f1mh7e001ii51d",
		"reference": "",
		"author": "",
		"group": "",
		"icon": "fas fa-microchip",
		"color": "",
		"version": "",
		"readme": "",
		"url": "https://",
		"name": "test",
		"components": {},
		"design": {},
		"variables": {},
		"sources": {},
		"origin": "http://localhost:8002",
		"dtcreated": "2025-04-09T15:26:14.864Z",
		"size": 482,
		"variables2": {},
		"directory": "F:/sync/factory_platform/flowstream/flowstream/",
		"sandbox": false
	},
	"f1n9s3001hm51d": {
		"paused": false,
		"id": "f1n9s3001hm51d",
		"reference": "tst",
		"author": "tst",
		"group": "tst",
		"icon": "fa fa-address-book",
		"color": "#7CFBFD",
		"version": "tst",
		"readme": "tst",
		"url": "https://tst.com",
		"name": "tst",
		"components": {},
		"design": {},
		"variables": {},
		"sources": {},
		"origin": "http://localhost:8002",
		"dtcreated": "2025-05-05T08:38:50.459Z",
		"size": 512,
		"variables2": {},
		"directory": "F:/sync/factory_platform/flowstream/flowstream/",
		"sandbox": false
	},
	"f1n9s4001hm51d": {
		"id": "f1n9s4001hm51d",
		"name": "tstttttt",
		"author": "",
		"version": "tttttttttt",
		"icon": "fa fa-adjust",
		"reference": "ttttttttt",
		"group": "tttttttttt",
		"url": "https://ttttt",
		"color": "",
		"readme": "",
		"design": {},
		"components": {},
		"variables": {},
		"sources": {},
		"dtcreated": "2025-05-05T08:39:50.459Z",
		"variables2": {},
		"directory": "F:/sync/factory_platform/flowstream/flowstream/",
		"sandbox": false,
		"size": 468
	},
	"f1n9vh001fk51d": {
		"id": "f1n9vh001fk51d",
		"name": "ooo",
		"author": "",
		"version": "",
		"icon": "fas fa-microchip",
		"reference": "",
		"group": "",
		"url": "https://",
		"color": "",
		"readme": "",
		"design": {},
		"components": {},
		"variables": {},
		"sources": {},
		"dtcreated": "2025-05-05T10:40:52.089Z",
		"variables2": {},
		"directory": "F:/sync/factory_platform/flowstream/flowstream/",
		"sandbox": false,
		"size": 433
	},
	"f1n9w6002dh50d": {
		"paused": false,
		"id": "f1n9w6002dh50d",
		"reference": "",
		"author": "",
		"group": "",
		"icon": "fas fa-microchip",
		"color": "",
		"version": "",
		"readme": "",
		"url": "https://",
		"name": "eeee",
		"components": {},
		"design": {},
		"variables": {},
		"sources": {},
		"origin": "http://localhost:8002",
		"dtcreated": "2025-05-05T11:06:12.199Z",
		"size": 482,
		"variables2": {},
		"directory": "F:/sync/factory_platform/flowstream/flowstream/",
		"sandbox": false
	},
	"f1n9wa001kk51d": {
		"id": "f1n9wa001kk51d",
		"name": "rrrew2",
		"author": "",
		"version": "",
		"icon": "fas fa-microchip",
		"reference": "",
		"group": "",
		"url": "https://",
		"color": "",
		"readme": "",
		"design": {},
		"components": {},
		"variables": {},
		"sources": {},
		"dtcreated": "2025-05-05T11:09:48.351Z",
		"variables2": {},
		"directory": "F:/sync/factory_platform/flowstream/flowstream/",
		"sandbox": false,
		"size": 436
	},
	"f1n9we001uk51d": {
		"id": "f1n9we001uk51d",
		"name": "llllpee",
		"author": "",
		"version": "",
		"icon": "fas fa-microchip",
		"reference": "",
		"group": "",
		"url": "https://",
		"color": "",
		"readme": "",
		"design": {},
		"components": {},
		"variables": {},
		"sources": {},
		"dtcreated": "2025-05-05T11:14:19.733Z",
		"variables2": {},
		"directory": "F:/sync/factory_platform/flowstream/flowstream/",
		"sandbox": false,
		"size": 437
	},
	"f1n9wh001sl51d": {
		"id": "f1n9wh001sl51d",
		"name": "ffee",
		"author": "",
		"version": "",
		"icon": "fas fa-microchip",
		"reference": "",
		"group": "",
		"url": "https://",
		"color": "",
		"readme": "",
		"design": {},
		"components": {},
		"variables": {},
		"sources": {},
		"dtcreated": "2025-05-05T11:17:25.934Z",
		"variables2": {},
		"directory": "F:/sync/factory_platform/flowstream/flowstream/",
		"sandbox": false,
		"size": 434
	},
	"f1n9wi001wm51d": {
		"id": "f1n9wi001wm51d",
		"name": "jjjjj",
		"author": "",
		"version": "",
		"icon": "fas fa-microchip",
		"reference": "",
		"group": "",
		"url": "https://",
		"color": "",
		"readme": "",
		"design": {},
		"components": {},
		"variables": {},
		"sources": {},
		"dtcreated": "2025-05-05T11:18:17.423Z",
		"variables2": {},
		"directory": "F:/sync/factory_platform/flowstream/flowstream/",
		"sandbox": false,
		"size": 435
	},
	"f1n9wj001ry51d": {
		"id": "f1n9wj001ry51d",
		"name": "wwwww",
		"author": "",
		"version": "",
		"icon": "fas fa-microchip",
		"reference": "",
		"group": "",
		"url": "https://",
		"color": "",
		"readme": "",
		"design": {},
		"components": {},
		"variables": {},
		"sources": {},
		"dtcreated": "2025-05-05T11:18:53.787Z",
		"variables2": {},
		"directory": "F:/sync/factory_platform/flowstream/flowstream/",
		"sandbox": false,
		"size": 435
	},
	"f1n9wv001tr51d": {
		"id": "f1n9wv001tr51d",
		"name": "llllll",
		"author": "",
		"version": "",
		"icon": "fas fa-microchip",
		"reference": "",
		"group": "",
		"url": "https://",
		"color": "",
		"readme": "",
		"design": {},
		"components": {},
		"variables": {},
		"sources": {},
		"dtcreated": "2025-05-05T11:30:41.721Z",
		"variables2": {},
		"directory": "F:/sync/factory_platform/flowstream/flowstream/",
		"sandbox": false,
		"size": 436
	},
	"f1n9wx001aj51d": {
		"id": "f1n9wx001aj51d",
		"name": "eeeeeeee",
		"author": "",
		"version": "",
		"icon": "fas fa-microchip",
		"reference": "",
		"group": "",
		"url": "https://",
		"color": "",
		"readme": "",
		"design": {},
		"components": {},
		"variables": {},
		"sources": {},
		"dtcreated": "2025-05-05T11:33:10.023Z",
		"variables2": {},
		"directory": "F:/sync/factory_platform/flowstream/flowstream/",
		"sandbox": false,
		"size": 438
	},
	"f1n9wy001aj51d": {
		"paused": false,
		"id": "f1n9wy001aj51d",
		"reference": "",
		"author": "",
		"group": "",
		"icon": "fas fa-microchip",
		"color": "",
		"version": "",
		"readme": "",
		"url": "https://",
		"name": ";;;;oi",
		"components": {},
		"design": {},
		"variables": {},
		"sources": {},
		"origin": "http://127.0.0.1:8000",
		"dtcreated": "2025-05-05T11:34:10.082Z",
		"size": 484,
		"variables2": {},
		"directory": "F:/sync/factory_platform/flowstream/flowstream/",
		"sandbox": false
	},
	"f1n9wz001aj51d": {
		"id": "f1n9wz001aj51d",
		"name": "sssss",
		"author": "",
		"version": "",
		"icon": "fas fa-microchip",
		"reference": "",
		"group": "",
		"url": "https://",
		"color": "",
		"readme": "",
		"design": {},
		"components": {},
		"variables": {},
		"sources": {},
		"dtcreated": "2025-05-05T11:35:10.093Z",
		"variables2": {},
		"directory": "F:/sync/factory_platform/flowstream/flowstream/",
		"sandbox": false,
		"size": 435
	},
	"f1n9x5001ip51d": {
		"id": "f1n9x5001ip51d",
		"name": "eeeeedd2",
		"author": "",
		"version": "",
		"icon": "fas fa-microchip",
		"reference": "",
		"group": "",
		"url": "https://",
		"color": "",
		"readme": "",
		"design": {},
		"components": {},
		"variables": {},
		"sources": {},
		"dtcreated": "2025-05-05T11:40:31.526Z",
		"variables2": {},
		"directory": "F:/sync/factory_platform/flowstream/flowstream/",
		"sandbox": false,
		"size": 438
	},
	"f1n9x6001xk51d": {
		"paused": false,
		"id": "f1n9x6001xk51d",
		"reference": "",
		"author": "",
		"group": "",
		"icon": "fas fa-microchip",
		"color": "",
		"version": "",
		"readme": "",
		"url": "https://",
		"name": "ddddd",
		"components": {},
		"design": {},
		"variables": {},
		"sources": {},
		"origin": "http://localhost:8002",
		"dtcreated": "2025-05-05T11:42:07.897Z",
		"size": 483,
		"variables2": {},
		"directory": "F:/sync/factory_platform/flowstream/flowstream/",
		"sandbox": false
	},
	"f1n9xk001xs51d": {
		"paused": false,
		"id": "f1n9xk001xs51d",
		"reference": "",
		"author": "",
		"group": "",
		"icon": "fas fa-microchip",
		"color": "",
		"version": "",
		"readme": "",
		"url": "https://",
		"name": "aaaaa",
		"components": {
			"tapirouter": "<script total>\n\n\texports.id = 'tapirouter';\n\texports.name = 'API Router';\n\texports.group = 'Total.js';\n\texports.icon = 'ti ti-crosshairs';\n\texports.version = '1';\n\texports.author = 'Total.js';\n\texports.config = { path: 'response', schema: [{ id: 'o1984', name: 'users_read/{id}' }] };\n\texports.outputs = [];\n\texports.kind = 'action';\n\texports.inputs = [{ id: 'input', name: 'Payload' }];\n\n\texports.make = function(instance, config) {\n\n\t\tvar compiled = null;\n\n\t\tinstance.message = function($) {\n\n\t\t\tvar data = $.data.payload || $.data.body;\n\t\t\tif (data && typeof(data.schema) === 'string') {\n\n\t\t\t\tvar index;\n\t\t\t\tvar schema = $.refs.schema;\n\n\t\t\t\tif (!schema) {\n\t\t\t\t\tlet tmp = {};\n\t\t\t\t\tlet meta = data.schema;\n\t\t\t\t\tindex = meta.indexOf('?');\n\t\t\t\t\ttmp.query = index === -1 ? '' : meta.substring(index + 1);\n\n\t\t\t\t\tif (index !== -1)\n\t\t\t\t\t\tmeta = meta.substring(0, index);\n\n\t\t\t\t\tindex = meta.indexOf('/');\n\t\t\t\t\ttmp.id = index === -1 ? meta : meta.substring(0, index);\n\t\t\t\t\ttmp.params = index === -1 ? EMPTYARRAY : meta.substring(index + 1).split('/').trim();\n\t\t\t\t\t$.refs.schema = tmp;\n\t\t\t\t\tschema = tmp;\n\t\t\t\t}\n\n\t\t\t\tvar meta = compiled[schema.id];\n\t\t\t\tif (meta) {\n\n\t\t\t\t\tif (schema.params.length === meta.params.length) {\n\n\t\t\t\t\t\tvar params = {};\n\t\t\t\t\t\tfor (var i = 0; i < meta.params.length; i++)\n\t\t\t\t\t\t\tparams[meta.params[i]] = schema.params[i];\n\n\t\t\t\t\t\tlet payload = $.data;\n\t\t\t\t\t\tpayload.query = schema.query ? DEF.parsers.urlencoded(schema.query) : {};\n\t\t\t\t\t\tpayload.payload = data.data;\n\t\t\t\t\t\tpayload.params = params;\n\t\t\t\t\t\t$.send(meta.id);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t$.data[config.path] = [{ id: '400', error: 'Invalid schema data' }];\n\t\t\t\t\t$.send('error');\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t$.data[config.path] = [{ id: '404', error: '404' }];\n\t\t\t$.send('error');\n\t\t};\n\n\t\tinstance.configure = function() {\n\n\t\t\tvar outputs = [];\n\n\t\t\tcompiled = {};\n\n\t\t\tfor (var item of config.schema) {\n\n\t\t\t\tif (!item)\n\t\t\t\t\tcontinue;\n\n\t\t\t\tvar params = item.name.split('/').trim();\n\t\t\t\tvar name = params.shift();\n\n\t\t\t\tfor (var i = 0; i < params.length; i++)\n\t\t\t\t\tparams[i] = params[i].replace(/\\{|\\}/g, '');\n\n\t\t\t\tcompiled[name] = { id: item.id, params: params };\n\t\t\t\toutputs.push({ id: item.id, name: item.name });\n\t\t\t}\n\n\t\t\toutputs.push({ id: 'error', name: '404' });\n\n\t\t\tvar prev = JSON.stringify(instance.outputs);\n\t\t\tvar curr = JSON.stringify(outputs);\n\n\t\t\tif (prev !== curr) {\n\t\t\t\tinstance.outputs = outputs;\n\t\t\t\tinstance.save();\n\t\t\t}\n\n\t\t};\n\n\t\tinstance.configure();\n\t};\n\n</script>\n\n<readme>\nThis component routes incoming Total.js API data according to the defined API schema. The component extends input data (query, payload and params) with parsed data.\n\n__Input & Output data__:\n\n```js\n{\n\t// REQUIRED payload:\n\tpayload: {\n\t\tschema: 'schema_name/{param_1}/{param_2}?query=arguments',\n\t\tdata: {} // optional, request payload\n\t},\n\tip: String, // optional, IP address\n\turl: String, // optional\n\tlanguage: String, // optional\n\tua: String, // optional, parsed UA\n\tuser: Object, // optional\n\theaders: { key: String }, // optional, request headers\n\tcookies: { key: String }, // optional, cookies\n\tquery: { key: String }, // optional\n\tparams: { key: String }, // optional\n\tfiles: [{ type: String, filename: String, path: String, ext: String, size: Number, width: Number, height: Number }] // optional\n}\n```\n\nIn the case of  `error`, the input data is extended by the `response` property with an error.\n</readme>\n\n<style>\n\t.CLASS-settings .fields { border: 1px solid #E0E0E0; border-radius: var(--radius); }\n\t.CLASS-settings figure { height: 26px; border-top: 1px solid #E0E0E0; line-height: 25px; font-size: 13px; }\n\t.CLASS-settings figure .edit-open { background-color: #F0F0F0; }\n\t.CLASS-settings figure .name { line-height: 14px; margin-right: 30px; }\n\t.CLASS-settings figure .name div { outline: 0; line-height: 23px; padding: 0 5px; min-height: 25px; font-weight: bold; }\n\t.CLASS-settings figure .controls { float: right; width: 90px; padding: 0; margin: 0; border-left: 1px solid #E0E0E0; text-align: center; }\n\t.CLASS-settings figure .controls span { cursor: pointer; margin-left: 5px; }\n\t.CLASS-settings figure .controls span:first-child { margin-left: 0; }\n\t.CLASS-settings figure:first-child { border-top: 0; line-height: 26px; }\n\t.CLASS-settings figure:first-child div { line-height: 26px; }\n\t.CLASS-settings figure.ismoved { background-color: rgba(92,29,196,0.3) !important; }\n\t.CLASS footer { height: 40px; line-height: 40px; padding: 0 10px; font-size: 12px; }\n\t.CLASS header div { border-radius: var(--radius); padding: 3px; background-color: #777; color: #FFF; }\n\t.CLASS header div i { background-color: rgba(0,0,0,0.2); }\n\n\t.ui-dark .CLASS header div i { background-color: rgba(255,255,255,0.2); }\n\t.ui-dark .CLASS-settings .fields { border-color: #404040; }\n\t.ui-dark .CLASS-settings figure { border-top-color: #404040; }\n\t.ui-dark .CLASS-settings figure .controls { border-left-color: #404040; }\n</style>\n\n<body>\n\t<header>\n\t\t<i class=\"$ICON\"></i>$NAME\n\t</header>\n</body>\n\n<settings>\n\t<div class=\"CLASS-settings\">\n\t\t<div class=\"padding\">\n\t\t\t<div class=\"caption m\">\n\t\t\t\t<div class=\"toolbar\">\n\t\t\t\t\t<nav>\n\t\t\t\t\t\t<button class=\"exec\" data-exec=\"tapirouter.add\"><i class=\"ti ti-plus-circle\"></i>Add</button>\n\t\t\t\t\t</nav>\n\t\t\t\t</div>\n\t\t\t\t<label>Schema</label>\n\t\t\t</div>\n\t\t\t<div class=\"message message-alert\"><i class=\"ti ti-exclamation-triangle\"></i>Every name of identifier must be unique per Flow. You can use dynamic arguments in the form <code>{argument_name}</code></div>\n\t\t\t<ui-bind path=\"?.schema\" config=\"template:figure --> data-id;show:value && value.length\" class=\"fields m block\">\n\t\t\t\t<script type=\"text/html\">\n\t\t\t\t\t{{ foreach m in value }}\n\t\t\t\t\t<figure data-id=\"{{ m.id }}\">\n\t\t\t\t\t\t<div class=\"controls\">\n\t\t\t\t\t\t\t<span class=\"exec\" data-exec=\"tapirouter.move\" title=\"Up\" data-type=\"up\"><i class=\"ti ti-arrow-up\"></i></span>\n\t\t\t\t\t\t\t<span class=\"exec\" data-exec=\"tapirouter.move\" title=\"Down\" data-type=\"down\"><i class=\"ti ti-arrow-down\"></i></span>\n\t\t\t\t\t\t\t<span class=\"exec\" data-exec=\"tapirouter.rem\" title=\"Remove\"><i class=\"ti ti-trash red\"></i></span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"name\">\n\t\t\t\t\t\t\t<div class=\"monospace edit hellip\" data-type=\"from\" data-edit=\"exec:tapirouter.name;required:1\">{{ m.name }}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</figure>\n\t\t\t\t\t{{ end }}\n\t\t\t\t</script>\n\t\t\t</ui-bind>\n\t\t\t<div class=\"help\">Use names in lower-case. We recommend to keep e.g. <code>users_read/{id}</code> or <code>products_read/{id}</code></div>\n\t\t</div>\n\t</div>\n</settings>\n\n<script>\n\n\tTOUCH(function(exports, reinit) {\n\n\t\texports.settings = function(meta) {\n\n\t\t\tif (!meta.config.schema.length) {\n\t\t\t\tvar obj = {};\n\t\t\t\tobj.id = 'o' + Math.random().toString(36).substring(6);\n\t\t\t\tobj.name = 'users_read/{id}';\n\t\t\t\tmeta.config.schema.push(obj);\n\t\t\t}\n\n\t\t\tvar tmp = W.tapirouter;\n\n\t\t\tif (!tmp) {\n\n\t\t\t\ttmp = {};\n\t\t\t\ttmp.add = function(el) {\n\t\t\t\t\tvar scope = el.scope();\n\t\t\t\t\tvar obj = {};\n\t\t\t\t\tobj.id = 'o' + Math.random().toString(36).substring(6);\n\t\t\t\t\tobj.name = 'users_read/{id}';\n\t\t\t\t\tscope.push('schema', obj);\n\t\t\t\t\tscope.change('*');\n\t\t\t\t};\n\n\t\t\t\ttmp.rem = function(el) {\n\t\t\t\t\tvar id = ATTRD(el);\n\t\t\t\t\tvar scope = el.scope();\n\t\t\t\t\tvar model = scope.get();\n\t\t\t\t\tvar index = model.schema.findIndex('id', id);\n\t\t\t\t\tmodel.schema.splice(index, 1);\n\t\t\t\t\tscope.update('schema');\n\t\t\t\t\tscope.change('*');\n\t\t\t\t};\n\n\t\t\t\ttmp.move = function(el) {\n\n\t\t\t\t\tvar scope = el.scope();\n\t\t\t\t\tvar id = ATTRD(el);\n\t\t\t\t\tvar container = el.closest('figure');\n\t\t\t\t\tvar schema = scope.get().schema;\n\t\t\t\t\tvar index = schema.findIndex('id', id);\n\t\t\t\t\tvar is = false;\n\t\t\t\t\tvar isup = el.attrd('type') === 'up';\n\n\t\t\t\t\tif (isup) {\n\t\t\t\t\t\tif (index > 0) {\n\t\t\t\t\t\t\tvar a = schema[index];\n\t\t\t\t\t\t\tschema[index] = schema[index - 1];\n\t\t\t\t\t\t\tschema[index - 1] = a;\n\t\t\t\t\t\t\tis = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (index <= schema.length - 2) {\n\t\t\t\t\t\t\tvar a = schema[index];\n\t\t\t\t\t\t\tschema[index] = schema[index + 1];\n\t\t\t\t\t\t\tschema[index + 1] = a;\n\t\t\t\t\t\t\tis = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (is) {\n\t\t\t\t\t\tNODEMOVE(container, isup);\n\t\t\t\t\t\tscope.change('*');\n\t\t\t\t\t\tcontainer.aclass('ismoved').rclass('ismoved', 500);\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\ttmp.name = function(opt, next) {\n\t\t\t\t\topt.value = opt.value.replace(/(;|\\s|,)/g, '').trim();\n\t\t\t\t\tvar scope = opt.element.scope();\n\t\t\t\t\tvar id = ATTRD(opt.element);\n\t\t\t\t\tvar item = scope.get().schema.findItem('id', id);\n\t\t\t\t\titem.name = opt.value.toLowerCase();\n\t\t\t\t\tscope.change('*');\n\t\t\t\t\tnext(true);\n\t\t\t\t};\n\n\t\t\t\tW.tapirouter = tmp;\n\t\t\t}\n\t\t};\n\n\t\texports.configure = function() {\n\n\t\t\tvar changes = exports.instance.changes;\n\n\t\t\tif (changes && changes.newbie) {\n\t\t\t\tvar outputs = [];\n\t\t\t\tfor (var item of exports.config.schema)\n\t\t\t\t\toutputs.push({ id: item.id, name: item.name });\n\t\t\t\toutputs.push({ id: 'error', name: '404' });\n\t\t\t\texports.instance.outputs = outputs;\n\t\t\t\tUPD('flow.data');\n\t\t\t}\n\n\t\t};\n\n\t});\n\n</script>",
			"tauthtoken": "<script total>\n\n\texports.id = 'tauthtoken';\n\texports.name = 'Auth token';\n\texports.group = 'Total.js';\n\texports.icon = 'ti ti-key';\n\texports.version = '1';\n\texports.author = 'Total.js';\n\texports.config = { token: '', code: 401, header: 'x-token', error: 'Unauthorized', ddos: 0 };\n\texports.inputs = [{ id: 'input', name: 'Request' }];\n\texports.outputs = [{ id: 'output', name: 'Request' }];\n\n\texports.make = function(instance, config) {\n\n\t\tvar maintoken = '';\n\t\tvar ddos = {};\n\n\t\tinstance.message = function($) {\n\n\t\t\tvar ctrl = $.refs.controller;\n\t\t\tvar token = ctrl.headers[config.header];\n\n\t\t\tif (config.ddos && ddos[ctrl.ip] > config.ddos)\n\t\t\t\ttoken = '';\n\n\t\t\tif (token === maintoken) {\n\t\t\t\t$.send('output');\n\t\t\t} else {\n\n\t\t\t\tif (config.ddos)\n\t\t\t\t\tddos[ctrl.ip] = (ddos[ctrl.ip] || 0) + 1;\n\n\t\t\t\tif (F.is5)\n\t\t\t\t\tctrl.response.status = config.code;\n\t\t\t\telse\n\t\t\t\t\tctrl.status = config.code;\n\n\t\t\t\tctrl.json([{ name: config.code + '', error: config.error }]);\n\t\t\t\t$.destroy();\n\t\t\t}\n\t\t};\n\n\t\tinstance.variables = instance.variables2 = function() {\n\t\t\tinstance.configure();\n\t\t};\n\n\t\tinstance.configure = function() {\n\t\t\tmaintoken = instance.replace(config.token);\n\t\t};\n\n\t\tinstance.service = function(counter) {\n\t\t\tif (counter % 10)\n\t\t\t\tddos = {};\n\t\t};\n\n\t\tinstance.configure();\n\n\t};\n\n</script>\n\n<readme>\nThis component must be used only with REST Route component. It reads a token from the request header and compares it with the token declared in the configuration.\n</readme>\n\n<settings>\n\t<div class=\"padding\">\n\t\t<ui-component name=\"input\" path=\"?.token\" config=\"required:1;camouflage:1\">Token</ui-component>\n\t\t<div class=\"help\"><span class=\"link exec\" data-exec=\"tmptokenauthgenerate\">Generate token</span>. It can contain a global variable in the form <code>{variable}</code>.</div>\n\t\t<hr />\n\t\t<div class=\"row\">\n\t\t\t<div class=\"col-md-3 m\">\n\t\t\t\t<ui-component name=\"input\" path=\"?.code\" config=\"required:1;type:number;format:\">Status code</ui-component>\n\t\t\t</div>\n\t\t\t<div class=\"col-md-3 m\">\n\t\t\t\t<ui-component name=\"input\" path=\"?.header\" config=\"required:1;type:lower\">Header</ui-component>\n\t\t\t</div>\n\t\t\t<div class=\"col-md-6 m\">\n\t\t\t\t<ui-component name=\"input\" path=\"?.error\" config=\"required:1\">Error message</ui-component>\n\t\t\t</div>\n\t\t</div>\n\t\t<hr />\n\t\t<div class=\"row\">\n\t\t\t<div class=\"col-md-6 m\">\n\t\t\t\t<div class=\"row\">\n\t\t\t\t\t<div class=\"col-md-6\">\n\t\t\t\t\t\t<ui-component name=\"input\" path=\"?.ddos\" config=\"required:1;type:number;format:\">DDOS protection</ui-component>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"help\">How many times can the client requested your API with a bad key? The internal IP database is cleared every 10 minutes. <code>0</code> disables DDOS protection.</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</settings>\n\n<style>\n\t.CLASS footer { padding: 10px; }\n\t.CLASS footer ui-bind { font-family: var(--monospace); }\n\t.CLASS footer .code { background-color: var(--color); color: #FFF; padding: 2px 3px; border-radius: var(--radius); }\n</style>\n\n<body>\n\t<header>\n\t\t<i class=\"$ICON\"></i>$NAME\n\t</header>\n\t<footer>\n\t\t<div><ui-bind path=\"$CONFIG.code\" config=\"text\" class=\"code\"></ui-bind><ui-bind path=\"$CONFIG.header\" config=\"text\"></ui-bind></div>\n\t</footer>\n</body>\n\n<script>\n\n\tTOUCH(function(exports, reinit) {\n\t\tif (!W.tmptokenauthgenerate) {\n\t\t\tW.tmptokenauthgenerate = function(el) {\n\t\t\t\tel.scope().set('token', W['GUI' + 'D'](30), 'show');\n\t\t\t};\n\t\t}\n\t});\n\n</script>\n",
			"tapicaptchaapi": "<script total>\n\n\texports.id = 'tapicaptchaapi';\n\texports.name = 'Captcha';\n\texports.icon = 'ti ti-game-board';\n\texports.author = 'Total.js';\n\texports.version = '1';\n\texports.group = 'Total.js API Services';\n\texports.config = { token: '', path: '', width: 200, height: 80, dark: false };\n\texports.inputs = [{ id: 'input', name: 'Input' }];\n\texports.outputs = [{ id: 'output', name: 'Output' }, { id: 'error', name: 'Error' }];\n\n\texports.make = function(instance, config) {\n\n\t\tvar cfg;\n\n\t\tinstance.message = function($) {\n\n\t\t\tif (!cfg.token) {\n\t\t\t\t$.send('error', 'Invalid token');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar payload = cfg.path ? cfg.path.includes('.') ? U.get(cfg.path, $.data) : $.data[cfg.path] : $.data;\n\n\t\t\tif (!payload) {\n\t\t\t\t$.send('error', 'Invalid data');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar data = {};\n\n\t\t\tdata.value = payload;\n\t\t\tdata.width = cfg.width;\n\t\t\tdata.height = cfg.height;\n\t\t\tdata.dark = cfg.dark;\n\n\t\t\tvar api = API('TAPI', 'captcha', data).callback(function(err, response) {\n\t\t\t\tif (err)\n\t\t\t\t\t$.send('error', err);\n\t\t\t\telse\n\t\t\t\t\t$.send('output', response);\n\t\t\t});\n\n\t\t\tapi.options.token = cfg.token;\n\t\t};\n\n\t\tinstance.configure = function() {\n\t\t\tcfg = instance.replace(config);\n\t\t};\n\n\t\tinstance.vary = instance.configure;\n\t\tinstance.configure();\n\n\t};\n\n</script>\n\n<readme>\nCaptcha image generator generates a simple JPEG image. It utilizes the [Total.js Weather API](https://docs.totaljs.com/totalapi/6c221003eo51c/#Ii6INR1cR61f).\n\n__Input data:__\n\n```js\n// {String} Captcha text\n'123456'\n```\n\n__Output data__:\n\n```js\n// Returns DataURI\n'data:image/jpeg;base64,/9j/4AAQSkZ...''\n\n```\n</readme>\n\n<settings>\n\t<div class=\"padding bg-smoke\">\n\t\t<div class=\"m\">\n\t\t\t<p><a href=\"https://docs.totaljs.com/totalapi/6c221002eo50c/\" target=\"_blank\"><i class=\"ti ti-caret-right mr5\"></i>Get Total.js API token</a>.<br>The token field supports variables in the form <span class=\"badge badge-medium badge-silver\">{variable}</span>.</p>\n\t\t\t<ui-component name=\"input\" path=\"?.token\" config=\"camouflage:1;required:1;monospace:1\"><b>API token</b></ui-component>\n\t\t</div>\n\t\t<div class=\"m\">\n\t\t\t<ui-component name=\"input\" path=\"?.path\" config=\"monospace:1;placeholder:path.to.property\">Path for reading input data</ui-component>\n\t\t\t<div class=\"help\">Optional. This component will load input data from a specific property/field according to the path.</div>\n\t\t</div>\n\t</div>\n\t<div class=\"padding\">\n\t\t<div class=\"grid-4\">\n\t\t\t<div class=\"m\">\n\t\t\t\t<ui-component name=\"input\" path=\"?.width\" config=\"type:number;required:1;maxvalue:500;\">Width</ui-component>\n\t\t\t</div>\n\t\t\t<div class=\"m\">\n\t\t\t\t<ui-component name=\"input\" path=\"?.height\" config=\"type:number;required:1;maxvalue:500;\">Height</ui-component>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class=\"m\">\n\t\t\t<ui-component name=\"input\" path=\"?.dark\" config=\"type:checkbox;\">Dark mode</ui-component>\n\t\t</div>\n\t</div>\n</settings>\n\n<body>\n\t<header>\n\t\t<i class=\"$ICON\"></i>$NAME\n\t</header>\n</body>",
			"chatgpt": "<script total>\n\n\texports.id = 'chatgpt';\n\texports.name = 'ChatGPT';\n\texports.icon = 'ti ti-robot-alt';\n\texports.author = 'Total.js';\n\texports.version = '3';\n\texports.group = 'Services';\n\texports.config = { model: 'gpt-3.5-turbo-instruct', apikey: '', question: '' };\n\texports.inputs = [{ id: 'input', name: 'Question' }];\n\texports.outputs = [{ id: 'output', name: 'Answer' }, { id: 'error', name: 'Error' }];\n\n\texports.make = function (instance, config) {\n\n\t\tconst URL = 'https://api.openai.com/v1/completions';\n\n\t\tvar model;\n\t\tvar cfg;\n\n\t\tinstance.message = async function ($) {\n\n\t\t\tvar data = $.data;\n\n\t\t\tif (!data) {\n\t\t\t\t$.send('error', 'Input text is missing');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tswitch (cfg.model) {\n\t\t\t\tcase 'gpt-3.5-turbo-instruct':\n\n\t\t\t\t\tif (data.text)\n\t\t\t\t\t\tdata = data.text;\n\n\t\t\t\t\tif (typeof data !== 'string') {\n\t\t\t\t\t\t$.send('error', 'Error: Wrong input format');\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tRESTBuilder.POST(URL, { model: cfg.model, prompt: config.question ? (config.question + ' ' + data) : data, temperature: 0, max_tokens: 220, frequency_penalty: 2 }).header('Authorization', 'Bearer ' + cfg.apikey).timeout(60000).keepalive().callback(function (err, response, output) {\n\n\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\t$.send('error', err);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (response && response.choices) {\n\t\t\t\t\t\t\tvar text = response.choices[0].text;\n\t\t\t\t\t\t\t$.send('output', text);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'gpt-3.5-turbo':\n\t\t\t\tcase 'gpt-4':\n\n\t\t\t\t\tvar messages = $.data.messages || $.data;\n\n\t\t\t\t\tif (!(messages instanceof Array)) {\n\t\t\t\t\t\t$.send('error', 'Error: Input must be array of messages');\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!messages[0] || !messages[0].role) {\n\t\t\t\t\t\t$.send('error', 'Error: Each message object must have message role attribute : user or assistant or system');\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tconfig.question && messages.unshift({ role: 'user', content: config.question });\n\n\n\t\t\t\t\tvar url = 'https://api.openai.com/v1/chat/completions';\n\t\t\t\t\tRESTBuilder.POST(url, { model: cfg.model, messages: messages }).header('Authorization', 'Bearer ' + cfg.apikey).timeout(60000).keepalive().callback(function (err, response, output) {\n\n\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\t$.send('error', err);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (response && response.choices) {\n\t\t\t\t\t\t\tvar text = response.choices[0].message.content;\n\n\t\t\t\t\t\t\t$.send('output', text);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'whisper-1':\n\t\t\t\t\tvar path = $.data.path || $.data;\n\n\t\t\t\t\tvar url = 'https://api.openai.com/v1/audio/transcriptions';\n\t\t\t\t\tRESTBuilder.POST(url, { model: cfg.model }).header('Authorization', 'Bearer ' + cfg.apikey).file('file', path).timeout(60000).keepalive().callback(function (err, response, output) {\n\n\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\t$.send('error', err);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (response && response)\n\t\t\t\t\t\t\t$.send('output', response);\n\n\t\t\t\t\t});\n\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t};\n\n\t\tinstance.configure = function () {\n\t\t\tcfg = instance.replace(config);\n\t\t};\n\n\t\tinstance.configure();\n\t};\n</script>\n\n<readme>\nThis component can talk to ChatGPT.\n\n## Input\n\nInput will depend on selected model\n\n- __CPT 3.5 Turbo__ and __CPT 4__\n```js\n\n// Object\n{\nmessages : [{ role: 'user', content: 'Text' }]\n}\n\n// or\n\n\n// Array\n[{ role: 'assistant', content: 'Text' }]\n```\n\n- __Whisper__\n```js\n\n// Object\n{\npath : 'path-to-file'\n}\n\n// or\n\n\n// String\n'path-to-file'\n```\n\n- __CPT 3.5 Turbo instruct__\n```js\n\n// Object\n{\ntext : 'your question'\n}\n\n// or\n\n\n// String\n'your question'\n```\n\n\n## Output\n\nOutput also depends on selected model\n- __CPT 3.5 Turbo__ and __CPT 4__\n```js\n'Response from assistant'\n```\n\n- __Whisper__\n```js\n\n// Object\n{\ntext : 'transcipted text'\n}\n```\n- __CPT 3.5 Turbo instruct__\n```js\n\n// String\n'Response from assistant'\n```\n</readme>\n\n<settings>\n\t<div class=\"padding\">\n\t\t<div class=\"m\">\n\t\t\t<ui-component name=\"input\" path=\"?.apikey\" config=\"camouflage:1;required:1\">API key</ui-component>\n\t\t\t<div class=\"help\"><a href=\"https://platform.openai.com/account/api-keys\" target=\"_blank\"><i class=\"ti ti-external\"></i>Generate API key</a></div>\n\t\t</div>\n\t\t<div class=\"m\">\n\t\t\t<ui-component name=\"input\" path=\"?.model\" config=\"type:select;dirsource:gpt-4|GPT 4,gpt-3.5-turbo|GPT 3.5 Turbo,gpt-3.5-turbo-instruct|GPT 3.5 Turbo instruct,Whisper|whisper-1\">Model</ui-component>\n\t\t</div>\n\t\t<div class=\"m\">\n\t\t\t<ui-component name=\"input\" path=\"?.question\" config=\"type:multiline\">Question</ui-component>\n\t\t\t<div class=\"help\">This question will be added before your messages</div>\n\t\t</div>\n\t</div>\n</settings>\n\n<body>\n\t<header>\n\t\t<i class=\"ICON\"></i>NAME\n\t</header>\n</body>",
			"code": "<script total>\n\n\texports.id = 'code';\n\texports.name = 'Code';\n\texports.group = 'Common';\n\texports.version = '4';\n\texports.icon = 'ti ti-code';\n\texports.author = 'Total.js';\n\texports.config = { outputs: 1, name: 'Code', code: '// instance {FlowStreamInstance};\\n// $ {FlowStreamMessage};\\n// vars {Object};\\n// repo {Object};\\n// data {String/Number/Boolean/Date/Buffer/Object};\\n// $.send(\\'output\\', data); // or simply send(data); which uses the first output\\n// $.destroy();\\n// $.throw(err);\\n\\n// IMPORTANT: If you do not perform re-send, you need to destroy this message via $.destroy() method\\n// IMPORTANT: methods $.send(), $.destroy() and $.throw() can be executed only once\\n\\n// $.send(\\'output\\', data);\\n$.destroy();' };\n\texports.inputs = [{ id: 'input', name: 'Input' }];\n\texports.outputs = [{ id: 'output', name: 'Output' }];\n\texports.meta = { settingswidth: 1200 };\n\n\texports.make = function(instance, config) {\n\n\t\tvar fn;\n\n\t\tinstance.message = function($) {\n\t\t\tif (fn) {\n\t\t\t\ttry {\n\t\t\t\t\tvar send = data => $.send('output', data);\n\t\t\t\t\tfn($.data, instance, $, $, F.require, send, $.repo, $.vars, $.data);\n\t\t\t\t} catch (e) {\n\t\t\t\t\t$.throw(e);\n\t\t\t\t\t$.destroy();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tinstance.configure = function() {\n\t\t\tinstance.outputs = [];\n\t\t\tfor (let i = 1; i <= config.outputs; i++)\n\t\t\t\tinstance.outputs.push({ id: 'output' + (i === 1 ? '' : i), name: 'Output #' + i });\n\t\t\tinstance.save();\n\n\t\t\ttry {\n\t\t\t\tif (config.code) {\n\t\t\t\t\tinstance.status(1);\n\t\t\t\t\tfn = new Function('value', 'instance', '$', 'message', 'require', 'send', 'repo', 'vars', 'data', config.code);\n\t\t\t\t} else {\n\t\t\t\t\tinstance.status(0);\n\t\t\t\t\tfn = null;\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\tfn = null;\n\t\t\t\tinstance.throw('Code: ' + e.message);\n\t\t\t}\n\t\t};\n\n\t\tinstance.close = function() {\n\t\t\tfn = null;\n\t\t};\n\n\t\tinstance.configure();\n\n\t};\n\n</script>\n\n<readme>\nThis component executes a custom JavaScript code as it is.\n\nTo send data to the default output use `send(somedata);`\nTo send data to specific output when number of outputs > 1 use `$.send('outputX', somedata)` where `X` is output index, see example bellow:\n- first output--> `send(somedata)` or `$.send('output', somedata)`\n- second output --> `$.send('output2', somedata)`\n- ...\n- 5th output --> `$.send('output5', somedata)`\n- etc.\n</readme>\n\n<settings>\n\t<div class=\"padding\">\n\t\t<div class=\"row\">\n\t\t\t<div class=\"col-md-10 m\">\n\t\t\t\t<ui-component name=\"input\" path=\"?.name\">Name</ui-component>\n\t\t\t</div>\n\t\t\t<div class=\"col-md-2 m\">\n\t\t\t\t<ui-component name=\"input\" path=\"?.outputs\" config=\"type:number;format:\">Number of outputs</ui-component>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class=\"ui-input-label\">Code:</div>\n\t\t<div class=\"m\">\n\t\t\t<ui-component name=\"codemirror\" path=\"?.code\" config=\"type:javascript;minheight:300;parent:auto;margin:60;tabs:true;trim:true\"></ui-component>\n\t\t</div>\n\t</div>\n</settings>\n\n<script>\n\tTOUCH(function(exports, init) {\n\t\texports.configure = function() {\n\t\t\tvar changes = exports.instance.changes;\n\t\t\tif (changes && changes.newbie) {\n\t\t\t\tvar outputs = [];\n\t\t\t\tvar count = exports.instance.config.outputs;\n\t\t\t\tfor (let i = 1; i <= count; i++)\n\t\t\t\t\toutputs.push({ id: 'output' + (i === 1 ? '' : i), name: (count === 1 ? 'Output' : 'Output #' + i) });\n\t\t\t\texports.instance.outputs = outputs;\n\t\t\t\tUPD('flow.data');\n\t\t\t}\n\t\t}\n\t});\n</script>\n\n<body>\n\t<header>\n\t\t<i class=\"ICON\"></i>NAME\n\t</header>\n</body>",
			"tcors": "<script total>\n\n\texports.id = 'tcors';\n\texports.name = 'CORS';\n\texports.group = 'Total.js';\n\texports.icon = 'ti ti-html5';\n\texports.version = '3';\n\texports.author = 'Total.js';\n\texports.config = { hostnames: [] };\n\texports.meta = { singleton: true };\n\n\texports.make = function(instance, config) {\n\n\t\tvar route = null;\n\n\t\tinstance.close = function() {\n\t\t\troute && route.remove && route.remove();\n\t\t\troute = null;\n\t\t};\n\n\t\tinstance.configure = function() {\n\t\t\troute && route.remove && route.remove();\n\t\t\tvar url = config.hostnames.join(',');\n\t\t\troute = url ? CORS(url) : CORS();\n\t\t};\n\n\t\tinstance.configure();\n\n\t};\n\n</script>\n\n<readme>\nThe component enables Cross-Origin Resource Sharing `CORS`, so the web browser will be able to communicate directly with the REST API. The functionality will work only with a defined Proxy endpoint for this Flow.\n</readme>\n\n<settings>\n\t<div class=\"padding\">\n\t\t<ui-component name=\"textboxlist\" path=\"?.hostnames\" config=\"maxlength:50;placeholder:https://www.totaljs.com\" class=\"m\">Hostnames with a protocol</ui-component>\n\t</div>\n</settings>\n\n<body>\n\t<div class=\"padding center\">\n\t\t<i class=\"ti ti-html5\" style=\"font-size:50px;color:#BD6B27\"></i>\n\t\t<div class=\"mt10 fs12\">CORS enabled</div>\n\t</div>\n</body>",
			"tapicheckapi": "<script total>\n\n\texports.id = 'tapicheckapi';\n\texports.name = 'Check credits';\n\texports.icon = 'ti ti-shield-check';\n\texports.author = 'Total.js';\n\texports.version = '1';\n\texports.group = 'Total.js API Services';\n\texports.config = { token: '' };\n\texports.inputs = [{ id: 'input', name: 'Input' }];\n\texports.outputs = [{ id: 'output', name: 'Output' }, { id: 'error', name: 'Error' }];\n\n\texports.make = function(instance, config) {\n\n\t\tvar cfg;\n\n\t\tinstance.message = function($) {\n\n\t\t\tif (!cfg.token) {\n\t\t\t\t$.send('error', 'Invalid token');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar api = API('TAPI', 'check').callback(function(err, response) {\n\t\t\t\tif (err)\n\t\t\t\t\t$.send('error', err);\n\t\t\t\telse\n\t\t\t\t\t$.send('output', response);\n\t\t\t});\n\n\t\t\tapi.options.token = cfg.token;\n\t\t};\n\n\t\tinstance.configure = function() {\n\t\t\tcfg = instance.replace(config);\n\t\t};\n\n\t\tinstance.vary = instance.configure;\n\t\tinstance.configure();\n\n\t};\n\n</script>\n\n<readme>\nReturns a current status for your token. It utilizes the [Total.js Check API](https://docs.totaljs.com/totalapi/6c221003eo51c/#6d397001td51c).\n\n__Output data__:\n\n```js\n{\n    credits: 34.49\n}\n```\n</readme>\n\n<settings>\n\t<div class=\"padding bg-smoke\">\n\t\t<div class=\"m\">\n\t\t\t<p><a href=\"https://docs.totaljs.com/totalapi/6c221002eo50c/\" target=\"_blank\"><i class=\"ti ti-caret-right mr5\"></i>Get Total.js API token</a>.<br>The token field supports variables in the form <span class=\"badge badge-medium badge-silver\">{variable}</span>.</p>\n\t\t\t<ui-component name=\"input\" path=\"?.token\" config=\"camouflage:1;required:1;monospace:1\"><b>API token</b></ui-component>\n\t\t</div>\n\t</div>\n</settings>\n\n<body>\n\t<header>\n\t\t<i class=\"$ICON\"></i>$NAME\n\t</header>\n</body>",
			"cheerio": "<script total>\n\n\texports.id = 'cheerio';\n\texports.name = 'Cheerio';\n\texports.group = 'HTML';\n\texports.icon = 'ti ti-code';\n\texports.author = 'Total.js';\n\texports.version = '1';\n\texports.config = { fn: '// instance : Component instance\\n// $: cheerio instance\\n// html: html string\\nvar body = $(\\'body\\').html();\\nreturn body;', path: '' };\n\texports.inputs = [{ id: 'input', name: 'Input' }];\n\texports.outputs = [{ id: 'output', name: 'Output' }];\n\n\texports.npm = ['cheerio'];\n\t// exports.meta = { readonly: false, singleton: false, hidden: false };\n\n\texports.make = function(instance, config) {\n\n\t\t// instance.main.variables {Object}\n\t\t// instance.main.variables2 {Object}\n\t\t// instance.save();\n\t\t// instance.replace(str); // replaces {variable_name} for values from \"variables\" and \"variables2\"\n\t\t// instance.status(obj, [refresh_delay_in_ms]);\n\n\t\tconst cheerio = require('cheerio');\n\t\tvar get, fn;\n\n\t\tinstance.message = function($) {\n\t\t\tvar data = $.data;\n\n\t\t\tvar input = CLONE(data);\n\t\t\tvar html;\n\t\t\tif (config.path) {\n\t\t\t\thtml = get(data);\n\t\t\t} else {\n\t\t\t\thtml = data;\n\t\t\t}\n\n\t\t\tif (typeof(html) !== 'string') {\n\t\t\t\t$.send('output', { error: 'invalid data, expected \"data{0}{1}\" to be a string'.format(config.path ? '.' : '', config.path) });\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst $$ = cheerio.load(html);\n\t\t\tvar result = fn($.instance,$$, html);\n\n\t\t\t$.data = { result, input };\n\t\t\t$.send('output');\n\t\t};\n\n\t\tinstance.configure = function() {\n\n\t\t\tif (config.path)\n\t\t\t\tget = new Function('data', 'return data?.{0};'.format(config.path.replace(/\\./g, '?.')));\n\n\t\t\tif (config.fn) {\n\t\t\t\ttry {\n\t\t\t\t\tfn = new Function('instance','$', 'html', config.fn);\n\t\t\t\t\tinstance.status('');\n\t\t\t\t} catch(e){\n\t\t\t\t\tinstance.throw(e.stack);\n\t\t\t\t\tinstance.status('Invalid code');\n\t\t\t\t}\n\t\t\t} else\n\t\t\t\tinstance.status('Not configured');\n\t\t};\n\n\t\tinstance.configure();\n\n\t};\n\n</script>\n\n<readme>\n\tUses [Cheerio](https://cheerio.js.org/index.html)\n\tPlease refer to the [documentation](https://cheerio.js.org/classes/Cheerio.html) for available functions.\n## Input\n```js\n<any>\n```\n\n## Output\n```js\n{\n\tresult: <the data returned from the code>,\n\tinput: <incomming data>\n}\n```\n\n## Example code\n```js\n// instance : component instance\n// $: cheerio instance\n// html: html string\n\nvar txt = [];\n$('ul > li').each(function (i, elem) {\n\ttxt.push($(this).text());\n});\nreturn txt;\n```\n</readme>\n\n<settings>\n\t<div class=\"padding\">\n\t\t<ui-component name=\"input\" path=\"?.path\">Path to html</ui-component>\n\t\t<div class=\"help m\">Leave empty if the 'data' itself is the html string, otherwise use dot notation. E.g.: { request: { body: '&lt;html&gt;...&lt;/html&gt;' }} -> `request.body` </div>\n\t\t<div class=\"ui-input-label\">Code:</div>\n\t\t<ui-component name=\"codemirror\" path=\"?.fn\" config=\"type:javascript;minheight:300;parent:.ui-largeform-body;margin:60;tabs:true;trim:true\"></ui-component>\n\t\t<div class=\"help\">Available variables: '&dollar;' -> cheerio instance, 'html' -> html string. Use 'return somedata;' to return whatever you want. Output data -> { result: somedata, input: inputdata }</div>\n\t</div>\n</settings>\n\n<style>\n\t.CLASS footer { padding: 10px; font-size: 12px; }\n</style>\n\n<body>\n\t<header>\n\t\t<i class=\"ICON\"></i>NAME\n\t</header>\n\t<footer><ui-bind path=\"!STATUS\" config=\"text;show\"></ui-bind></footer>\n</body>",
			"dataset": "<script total>\n\n\texports.id = 'dataset';\n\texports.name = 'CSV Dataset';\n\texports.group = 'Dashboard';\n\texports.version = '2';\n\texports.icon = 'ti ti-database';\n\texports.author = 'Peter Širka';\n\texports.config = { name: '', unit: '', icon: '', color: '', decimals: 2, type: 'daily', sum: 0, hours: 48, days: 12, months: 12, years: 6 };\n\texports.inputs = [{ id: 'input', name: 'Value' }, { id: 'live', name: 'Live stats' }, { id: 'stats', name: 'Stats' }];\n\texports.outputs = [{ id: 'stats', name: 'Output' }];\n\n\texports.make = function(instance, config) {\n\n\t\tvar uid = instance.id;\n\t\tvar filename_meta = PATH.private('dataset_' + uid + '.json');\n\t\tvar filename_data = PATH.private('dataset_' + uid + '.csv');\n\t\tvar meta = {};\n\n\t\tvar updatestatus = function() {\n\t\t\tinstance.status({ id: uid, keys: meta.keys });\n\t\t};\n\n\t\tF.Fs.readFile(filename_meta, function(err, response) {\n\t\t\tmeta = response ? response.toString('utf8').parseJSON(true) : CLONE(config);\n\t\t\tif (!meta.keys)\n\t\t\t\tmeta.keys = {};\n\t\t\tmeta.id = uid;\n\t\t\tupdatestatus();\n\t\t\tF.Fs.lstat(filename_data, function(err) {\n\t\t\t\tif (err)\n\t\t\t\t\tF.Fs.appendFile(filename_data, 'key,value,min,max,sum,count,tshour,tsday,tsweek,tsmonth,tsyear\\n', NOOP);\n\t\t\t});\n\t\t});\n\n\t\tinstance.close = function(removed) {\n\t\t\tif (removed) {\n\t\t\t\tF.Fs.unlink(filename_meta, NOOP);\n\t\t\t\tF.Fs.unlink(filename_data, NOOP);\n\t\t\t\tdb = null;\n\t\t\t}\n\t\t};\n\n\t\tinstance.insert = function(data) {\n\n\t\t\tvar writer = null;\n\t\t\tvar write = false;\n\t\t\tvar key = data.key || data.id || 'Value';\n\n\t\t\tif (!meta.keys[key])\n\t\t\t\tmeta.keys[key] = {};\n\n\t\t\tvar tmp = meta.keys[key];\n\n\t\t\tif (tmp.count && config.type !== 'lastvalue' && config.type !== 'logger') {\n\t\t\t\tvar date = tmp.date;\n\t\t\t\tswitch (config.type) {\n\t\t\t\t\tcase 'hourly':\n\t\t\t\t\t\twrite = date.getHours() !== NOW.getHours();\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'daily':\n\t\t\t\t\t\twrite = date.getDate() !== NOW.getDate();\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'monthly':\n\t\t\t\t\t\twrite = date.getMonth() !== NOW.getMonth();\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'weekly':\n\t\t\t\t\t\twrite = date.format('w') !== NOW.format('w');\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'yearly':\n\t\t\t\t\t\twrite = date.getFullYear() !== NOW.getFullYear();\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (write) {\n\t\t\t\twriter = {};\n\t\t\t\twriter.key = key;\n\t\t\t\twriter.value = tmp.value;\n\t\t\t\twriter.min = tmp.min;\n\t\t\t\twriter.max = tmp.max;\n\t\t\t\twriter.sum = tmp.sum;\n\t\t\t\twriter.count = tmp.count;\n\t\t\t\twriter.date = tmp.date;\n\t\t\t}\n\n\t\t\ttmp.date = NOW;\n\t\t\ttmp.value = data.value;\n\n\t\t\tif (writer) {\n\n\t\t\t\ttmp.min = tmp.value;\n\t\t\t\ttmp.max = tmp.value;\n\t\t\t\ttmp.count = 0;\n\n\t\t\t\tif (config.sum) {\n\t\t\t\t\tif (config.sum === 1)\n\t\t\t\t\t\ttmp.sum = tmp.value;\n\t\t\t\t\telse\n\t\t\t\t\t\ttmp.sum = (tmp.sum || 0) + tmp.value;\n\t\t\t\t}\n\n\t\t\t} else {\n\n\t\t\t\tif (tmp.min == null || tmp.value < tmp.min)\n\t\t\t\t\ttmp.min = tmp.value;\n\n\t\t\t\tif (tmp.max == null || tmp.value > tmp.max)\n\t\t\t\t\ttmp.max = tmp.value;\n\n\t\t\t\tif (config.sum)\n\t\t\t\t\ttmp.sum = (tmp.sum || 0) + tmp.value;\n\n\t\t\t\tif (config.type === 'logger') {\n\t\t\t\t\twriter = {};\n\t\t\t\t\twriter.key = key;\n\t\t\t\t\twriter.value = tmp.value;\n\t\t\t\t\twriter.min = tmp.min;\n\t\t\t\t\twriter.max = tmp.max;\n\t\t\t\t\twriter.sum = tmp.sum;\n\t\t\t\t\twriter.count = (tmp.count || 0) + 1;\n\t\t\t\t\twriter.date = tmp.date;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\ttmp.count = (tmp.count || 0) + 1;\n\n\t\t\tupdatestatus();\n\t\t\tF.Fs.writeFile(filename_meta, JSON.stringify(meta, null, '\\t'), NOOP);\n\n\t\t\tif (!writer)\n\t\t\t\treturn;\n\n\t\t\tvar values = [];\n\n\t\t\t// 0 key\n\t\t\t// 1 value\n\t\t\t// 2 min\n\t\t\t// 3 max\n\t\t\t// 4 sum\n\t\t\t// 5 count\n\t\t\t// 6 tsh\n\t\t\t// 7 tsd\n\t\t\t// 8 tsw\n\t\t\t// 9 tsm\n\t\t\t// 10 tsy\n\n\t\t\tvar ts = writer.date.format('yyyyMMddHH');\n\n\t\t\tvalues.push(writer.key);\n\t\t\tvalues.push(writer.value + '');\n\t\t\tvalues.push((writer.min != null ? writer.min : '') + '');\n\t\t\tvalues.push((writer.max != null ? writer.max : '') + '');\n\t\t\tvalues.push((writer.sum != null ? writer.sum : '') + '');\n\t\t\tvalues.push((writer.count != null ? writer.count : '') + '');\n\t\t\tvalues.push(ts);\n\t\t\tvalues.push(ts.substring(0, 8));\n\t\t\tvalues.push(writer.date.format('yyyyww'));\n\t\t\tvalues.push(ts.substring(0, 6));\n\t\t\tvalues.push(ts.substring(0, 4));\n\n\t\t\tF.Fs.appendFile(filename_data, values.join(',') + '\\n', NOOP);\n\t\t};\n\n\t\tvar updatefile = function(fn) {\n\t\t\tF.Fs.readFile(filename_data, function(err, data) {\n\t\t\t\tvar lines = data.toString('utf8').split('\\n');\n\t\t\t\tfn(lines);\n\t\t\t\tF.Fs.writeFile(filename_data, lines.join('\\n'), NOOP);\n\t\t\t});\n\t\t};\n\n\t\tinstance.trigger = function(msg) {\n\t\t\tif (msg.type === 'remove') {\n\t\t\t\t// msg.key\n\t\t\t\tdelete meta.keys[msg.key];\n\t\t\t\tupdatestatus();\n\t\t\t\tF.Fs.writeFile(filename_meta, JSON.stringify(meta, null, '\\t'), NOOP);\n\t\t\t\tupdatefile(function(lines) {\n\t\t\t\t\tvar counter = 0;\n\t\t\t\t\tvar key = msg.key + ',';\n\t\t\t\t\twhile (true) {\n\t\t\t\t\t\tvar line = lines[counter];\n\t\t\t\t\t\tif (line == null)\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tif (line.substring(0, key.length) === key)\n\t\t\t\t\t\t\tlines.splice(counter, 1);\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tcounter++;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else if (msg.type === 'rename') {\n\t\t\t\t// msg.key\n\t\t\t\t// msg.name\n\t\t\t\tmeta.keys[msg.name] = meta.keys[msg.key];\n\t\t\t\tdelete meta.keys[msg.key];\n\t\t\t\tupdatestatus();\n\t\t\t\tF.Fs.writeFile(filename_meta, JSON.stringify(meta, null, '\\t'), NOOP);\n\t\t\t\tupdatefile(function(lines) {\n\t\t\t\t\tvar counter = 0;\n\t\t\t\t\tvar key = msg.key + ',';\n\t\t\t\t\twhile (true) {\n\t\t\t\t\t\tvar line = lines[counter];\n\t\t\t\t\t\tif (line == null)\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tif (line.substring(0, key.length) === key)\n\t\t\t\t\t\t\tlines[counter] = msg.name + ',' + line.substring(key.length);\n\t\t\t\t\t\tcounter++;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\n\t\tinstance.message_input = function($) {\n\n\t\t\tvar data = $.data;\n\t\t\tvar type = typeof(data);\n\n\t\t\tif (type === 'number')\n\t\t\t\tdata = { value: data };\n\n\t\t\tinstance.insert(CLONE(data));\n\t\t\t$.destroy();\n\t\t};\n\n\t\tinstance.message_stats = function($) {\n\t\t\tvar opt = {};\n\t\t\topt.filename = filename_data;\n\t\t\topt.hours = 48;\n\t\t\topt.days = 12;\n\t\t\topt.months = 12;\n\t\t\topt.years = 6;\n\t\t\tinstance.readstats(opt, function(response) {\n\t\t\t\t$.send('stats', response);\n\t\t\t});\n\t\t};\n\n\t\tinstance.message_live = function($) {\n\n\t\t\tvar output = [];\n\n\t\t\tfor (var key in meta.keys) {\n\t\t\t\tvar data = CLONE(meta.keys[key]);\n\t\t\t\tdata.id = key.makeid();\n\t\t\t\tdata.name = key;\n\t\t\t\tdata.color = meta.color;\n\t\t\t\tdata.icon = meta.icon;\n\t\t\t\tdata.unit = meta.unit;\n\t\t\t\tdata.decimals = meta.decimals;\n\t\t\t\tdata.data = data.value;\n\t\t\t\tdata.value = undefined;\n\t\t\t\toutput.push(data);\n\t\t\t}\n\n\t\t\t$.send('stats', output);\n\t\t};\n\n\t\tinstance.configure = function() {\n\t\t\tCOPY(config, meta);\n\t\t\tF.Fs.writeFile(filename_meta, JSON.stringify(meta, null, '\\t'), NOOP);\n\t\t};\n\n\t\tinstance.readstats = function(opt, callback) {\n\n\t\t\tvar builder = [];\n\t\t\tvar response = {};\n\t\t\tvar prop = 'd';\n\n\t\t\tvar fromhours = opt.hours ? (+(NOW.add('-' + opt.hours + ' hours').format('yyyyMMddHH'))) : 0;\n\t\t\tvar fromdays = opt.days ? (+(NOW.add('-' + opt.days + ' days').format('yyyyMMdd'))) : 0;\n\t\t\tvar frommonths = opt.months ? (+(NOW.add('-' + opt.months + ' months').format('yyyyMM'))) : 0;\n\t\t\tvar fromyear = opt.years ? (NOW.getFullYear() - opt.years) : 0;\n\n\t\t\tif (opt.hours)\n\t\t\t\tresponse.hours = {};\n\n\t\t\tif (opt.days)\n\t\t\t\tresponse.days = {};\n\n\t\t\tif (opt.months)\n\t\t\t\tresponse.months = {};\n\n\t\t\tif (opt.years)\n\t\t\t\tresponse.years = {};\n\n\t\t\tif (!opt.type)\n\t\t\t\topt.type = 'max';\n\n\t\t\tvar start = function() {\n\n\t\t\t\tvar add = function(type, key, x, y) {\n\n\t\t\t\t\tif (!response[type][key])\n\t\t\t\t\t\tresponse[type][key] = {};\n\n\t\t\t\t\tvar items = response[type][key];\n\t\t\t\t\tvar key2 = x + '';\n\t\t\t\t\tvar tmp;\n\n\t\t\t\t\tswitch (opt.type) {\n\t\t\t\t\t\tcase 'max':\n\t\t\t\t\t\t\ttmp = items[key2];\n\t\t\t\t\t\t\tif (tmp == null) {\n\t\t\t\t\t\t\t\titems[key2] = y;\n\t\t\t\t\t\t\t} else if (tmp < y)\n\t\t\t\t\t\t\t\titems[key2] = y;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'min':\n\t\t\t\t\t\t\ttmp = items[key2];\n\t\t\t\t\t\t\tif (tmp == null) {\n\t\t\t\t\t\t\t\titems[key2] = y;\n\t\t\t\t\t\t\t} else if (tmp > y)\n\t\t\t\t\t\t\t\titems[key2] = y;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t};\n\n\t\t\t\tvar push = function() {\n\n\t\t\t\t\tvar tmp = builder.splice(0);\n\t\t\t\t\tvar arr = tmp.join('\\n').parseCSV(',');\n\t\t\t\t\tfor (var item of arr) {\n\n\t\t\t\t\t\tfor (var key in item) {\n\t\t\t\t\t\t\tif (key !== 'a')\n\t\t\t\t\t\t\t\titem[key] = item[key] ? (+item[key]) : 0;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (response.hours && item.g >= fromhours)\n\t\t\t\t\t\t\tadd('hours', item.a, item.g, item[prop]);\n\n\t\t\t\t\t\tif (response.days && item.h >= fromdays)\n\t\t\t\t\t\t\tadd('days', item.a, item.h, item[prop]);\n\n\t\t\t\t\t\tif (response.months && item.j >= frommonths)\n\t\t\t\t\t\t\tadd('months', item.a, item.j, item[prop]);\n\n\t\t\t\t\t\tif (response.years && item.k >= fromyear)\n\t\t\t\t\t\t\tadd('years', item.a, item.k, item[prop]);\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tvar stream = F.Fs.createReadStream(opt.filename);\n\t\t\t\tstream.on('data', U.streamer('\\n', function(line, index) {\n\t\t\t\t\tif (index) {\n\t\t\t\t\t\tvar count = builder.push(line.trim());\n\t\t\t\t\t\tif (count > 100)\n\t\t\t\t\t\t\tpush();\n\t\t\t\t\t}\n\t\t\t\t}));\n\n\t\t\t\tCLEANUP(stream, function() {\n\n\t\t\t\t\tbuilder.length && push();\n\n\t\t\t\t\tvar output = {};\n\t\t\t\t\tvar tmp;\n\n\t\t\t\t\tfor (var a in response) {\n\n\t\t\t\t\t\tvar stat = response[a];\n\n\t\t\t\t\t\toutput[a] = [];\n\n\t\t\t\t\t\tfor (var b in stat) {\n\n\t\t\t\t\t\t\tvar tmp = stat[b];\n\t\t\t\t\t\t\tvar arr = [];\n\n\t\t\t\t\t\t\tfor (var c in tmp) {\n\t\t\t\t\t\t\t\tvar date;\n\n\t\t\t\t\t\t\t\tswitch (a) {\n\t\t\t\t\t\t\t\t\tcase 'hours':\n\t\t\t\t\t\t\t\t\t\tdate = new Date(+c.substring(0, 4), (+c.substring(4, 6)) - 1, +c.substring(6, 8), +c.substring(8, 10), 0, 0);\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\tcase 'days':\n\t\t\t\t\t\t\t\t\t\tdate = new Date(+c.substring(0, 4), (+c.substring(4, 6)) - 1, +c.substring(6, 8), 12, 0, 0);\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\tcase 'months':\n\t\t\t\t\t\t\t\t\t\tdate = new Date(+c.substring(0, 4), (+c.substring(4, 6)) - 1, 1, 12, 0, 0);\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\tcase 'years':\n\t\t\t\t\t\t\t\t\t\tdate = new Date(+c.substring(0, 4), 0, 1, 12, 0, 0);\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tarr.push({ x: date, y: tmp[c] });\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\toutput[a].push({ name: b, unit: config.unit, decimals: config.decimals, data: arr });\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t\tcallback && callback(output);\n\t\t\t\t});\n\n\t\t\t};\n\n\t\t\tsetImmediate(start);\n\t\t};\n\n\t};\n\n</script>\n\n<style>\n\t.CLASS hr { margin: 10px 0; }\n\t.CLASS [contenteditable] { outline: 0 }\n\t.CLASS .padding { padding: 10px; font-size: 12px; }\n\t.CLASS .padding .meta { height: 16px; font-size: 11px; }\n\t.CLASS .padding .meta span { color: #888; margin-right: 5px; width: 30px; float: left; }\n</style>\n\n<settings>\n\t<div class=\"padding\">\n\t\t<div class=\"row\">\n\t\t\t<div class=\"col-md-6 m\">\n\t\t\t\t<ui-component name=\"input\" path=\"?.name\" config=\"required:1;placeholder:Dataset name\">Name</ui-component>\n\t\t\t</div>\n\t\t\t<div class=\"col-md-3 m\">\n\t\t\t\t<ui-component name=\"input\" path=\"?.type\" config=\"dirsource:lastvalue|Last value only,logger|Logger,hourly|Hourly,daily|Daily,weekly|Weeekly,monthly|Monthly,yearly|Yearly;required:1\">Type</ui-component>\n\t\t\t</div>\n\t\t\t<div class=\"col-md-3 m\">\n\t\t\t\t<ui-component name=\"input\" path=\"?.sum\" config=\"dirsource:0|Disabled,1|Periodical sum,2|Total sum;type:number\">Calculate the sum</ui-component>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class=\"grid-4\">\n\t\t\t<div class=\"m\">\n\t\t\t\t<ui-component name=\"input\" path=\"?.unit\" config=\"align:1\">Unit</ui-component>\n\t\t\t</div>\n\t\t\t<div class=\"m\">\n\t\t\t\t<ui-component name=\"input\" path=\"?.decimals\" config=\"align:1;type:number;format:\" default=\"2\">Decimals</ui-component>\n\t\t\t</div>\n\t\t\t<div class=\"m\">\n\t\t\t\t<ui-component name=\"input\" path=\"?.icon\" config=\"type:icon\">Icon</ui-component>\n\t\t\t</div>\n\t\t\t<div class=\"m\">\n\t\t\t\t<ui-component name=\"input\" path=\"?.color\" config=\"type:color\">Color</ui-component>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class=\"caption m\">\n\t\t\t<label><i class=\"ti ti-chart-line\"></i>Stats</label>\n\t\t</div>\n\t\t<p>Zero values will prevent statistics from being displayed for the selected period.</p>\n\t\t<div class=\"grid-4\">\n\t\t\t<div class=\"m\">\n\t\t\t\t<ui-component name=\"input\" path=\"?.hours\" config=\"type:number;format:\">Hours</ui-component>\n\t\t\t\t<div class=\"help\">How many hours to be returned?</div>\n\t\t\t</div>\n\t\t\t<div class=\"m\">\n\t\t\t\t<ui-component name=\"input\" path=\"?.days\" config=\"type:number;format:\">Days</ui-component>\n\t\t\t\t<div class=\"help\">How many days to be returned?</div>\n\t\t\t</div>\n\t\t\t<div class=\"m\">\n\t\t\t\t<ui-component name=\"input\" path=\"?.months\" config=\"type:number;format:\">Months</ui-component>\n\t\t\t\t<div class=\"help\">How many months to be returned?</div>\n\t\t\t</div>\n\t\t\t<div class=\"m\">\n\t\t\t\t<ui-component name=\"input\" path=\"?.years\" config=\"type:number;format:\">Years</ui-component>\n\t\t\t\t<div class=\"help\">How many years to be returned?</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</settings>\n\n<readme>\nThe component stores data as CSV Dataset for e.g. Dashboard application. Dataset is stored in `/private/` path that is available with the help of the Flow access token.\n\nCSV file contains only processed values (according to the period) and the `.meta` file contains meta data + last value.\n\n__Input for data processing__:\n\n```js\n{\n\tkey: String,    // optional, e.g. device_id | device_name\n\tvalue: Number   // measured value\n}\n```\n\n### CSV columns\n\n- `a` = `key {String}`\n- `b` = `value {Number}`\n- `c` = `min {Number}`\n- `d` = `max {Number}`\n- `e` = `sum {Number}`\n- `f` = `count {Number}`\n- `g` = `tshour {Number}`in the form `yyyyMMddhh`\n- `h` = `tsday {Number}` in the form `yyyyMMdd`\n- `i` = `tsweek {Number}` in the form `yyyyww`\n- `j` = `tsmonth {Number}` in the form `yyyyMM`\n- `k` = `tsyear {Number}` in the form `yyyy`\n</readme>\n\n<script>\n\tTOUCH(function(exports, reinit) {\n\n\t\tvar laststatus;\n\n\t\texports.configure = function(config, isinit) {\n\t\t\tif (!isinit) {\n\t\t\t\texports.status(laststatus);\n\t\t\t\texports.rebind('status');\n\t\t\t}\n\t\t};\n\n\t\texports.status = function(status, isinit) {\n\t\t\tlaststatus = status;\n\t\t\tif (status) {\n\t\t\t\tstatus.type = exports.config.type;\n\t\t\t\tfor (var key in status.keys)\n\t\t\t\t\tstatus.keys[key].unit = exports.config.unit;\n\t\t\t}\n\t\t};\n\n\t\texports.rename = function(meta, next) {\n\n\t\t\tvar id = ATTRD(meta.element);\n\t\t\tvar value = meta.value.replace(/\\\"|\\,/g, '');\n\n\t\t\tif (id !== value) {\n\t\t\t\tnext(false);\n\t\t\t\t// Due to \"enter\" key\n\t\t\t\tsetTimeout(ASETTER('approve/show', 'Are you sure you want to rename \"{0}\" to <b>\"{1}\"</b>?'.format(id, value), '\"ti ti-trash\" Remove', function() {\n\t\t\t\t\texports.trigger({ type: 'rename', key: id, name: value });\n\t\t\t\t\tnext(value);\n\t\t\t\t}), 200);\n\t\t\t} else\n\t\t\t\tnext(false);\n\n\t\t};\n\n\t\texports.click = function(el) {\n\t\t\tvar id = ATTRD(el);\n\t\t\tSETTER('approve/show', 'Are you sure you want to remove selected key <b>\"{0}\"</b>?'.format(id.encode()), '\"ti ti-trash\" Remove', function() {\n\t\t\t\texports.trigger({ type: 'remove', key: id });\n\t\t\t});\n\t\t};\n\n\t});\n</script>\n\n<body>\n\t<header>\n\t\t<i class=\"ICON\"></i>NAME\n\t</header>\n\t<footer>\n\t\t<div class=\"padding\">\n\t\t\t<ui-bind path=\"CONFIG\" config=\"template\">\n\t\t\t\t<script type=\"text/html\">\n\t\t\t\t\t<span class=\"badge badge-medium badge-color mr5\">{{ value.type }}</span> {{ if value.icon }}<i class=\"{{ value.icon }} mr5\"></i>{{ fi }}<b>{{ value.name }}</b>\n\t\t\t\t</script>\n\t\t\t</ui-bind>\n\t\t\t<ui-bind path=\"STATUS\" config=\"template;show\" class=\"keys hidden\">\n\t\t\t\t<script type=\"text/html\">\n\t\t\t\t\t<div class=\"selectable\">\n\t\t\t\t\t\t<div class=\"meta mt5\">\n\t\t\t\t\t\t\t<span>Meta:</span><div><a href=\"/private/?filename=dataset_{{ value.id }}.json&token=\" target=\"_blank\">dataset_{{ value.id }}.json</a></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{{ if value.type !== 'lastvalue' }}\n\t\t\t\t\t\t<div class=\"meta\">\n\t\t\t\t\t\t\t<span>Data:</span><div><a href=\"/private/?filename=dataset_{{ value.id }}.csv&token=\" target=\"_blank\">dataset_{{ value.id }}.csv</a></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{{ fi }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<hr />\n\t\t\t\t\t<div class=\"selectable\">\n\t\t\t\t\t{{ foreach m in value.keys }}\n\t\t\t\t\t\t<div class=\"keyvalue small\" data-id=\"{{ m.key }}\">\n\t\t\t\t\t\t\t<span><i class=\"ti ti-trash red clickable\"></i><b class=\"edit\" data-edit=\"required:1;offsetWidth:150;exec:TOUCH.rename\" data-id=\"{{ m.key }}\">{{ m.key }}</b></span>\n\t\t\t\t\t\t\t<div class=\"right\">{{ m.value.value }} {{ m.value.unit }}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{{ end }}\n\t\t\t\t\t</div>\n\t\t\t\t</script>\n\t\t\t</ui-bind>\n\t\t</div>\n\t</footer>\n</body>",
			"opensync": "<script total>\n\n\texports.id = 'opensync';\n\texports.name = 'OpenSync';\n\texports.group = 'External';\n\texports.author = 'Total.js';\n\texports.icon = 'ti ti-sync';\n\texports.version = '2';\n\texports.config = {};\n\texports.outputs = [{ id: 'output', name: 'Output' }];\n\n\texports.make = function(instance, config) {\n\n\t\tvar client = null;\n\t\tvar status = { connected: 0, meta: EMPTYOBJECT };\n\n\t\tvar connect = function() {\n\t\t\tclient = OPENCLIENT(config.url, instance.id);\n\t\t\tclient.error(err => instance.throw(err));\n\n\t\t\tclient.online(function(meta) {\n\t\t\t\tstatus.connected = meta ? 1 : 0;\n\t\t\t\tstatus.meta = meta;\n\t\t\t\tinstance.status(status);\n\t\t\t});\n\n\t\t\tclient.message(function(msg) {\n\t\t\t\tinstance.newmessage(msg).send('output');\n\t\t\t});\n\t\t};\n\n\t\tinstance.configure = function() {\n\t\t\tif (config.url) {\n\t\t\t\tconnect();\n\t\t\t} else {\n\t\t\t\tif (client) {\n\t\t\t\t\tclient.close();\n\t\t\t\t\tclient = null;\n\t\t\t\t}\n\t\t\t\tinstance.status({ connected: 0 });\n\t\t\t}\n\t\t};\n\n\t\tinstance.close = function() {\n\t\t\tif (client) {\n\t\t\t\tclient.close();\n\t\t\t\tclient = null;\n\t\t\t}\n\t\t};\n\n\t\tinstance.configure();\n\n\t};\n\n</script>\n\n<style>\n\t.CLASS footer { padding: 8px; font-size: 12px; }\n\t.CLASS footer i { width: 12px; text-align: center; margin-right: 5px; }\n</style>\n\n<readme>\nThis component receives a data from the [OpenSync](https://docs.totaljs.com/opensync/) app. Data example:\n\n```js\n{\n\tid: String,              // Internal ID\n\ttype: String,            // Parsed content-type (can be empty with the \"GET\" method)\n\tchannel: String,         // Channel\n\tip: String,              // Host IP address\n\tmethod: String,          // HTTP method (upper-case)\n\theaders: Object,         // Key:value\n\tquery: Object,           // Key:value\n\tbody: Object,            // JSON/key:value/String\n\tua: String,              // Parsed user-agent\n\tfiles: [Object Array]    // Uploaded files { filename: String, extension: String, type: String, size: Number, url: String, width: Number, height: Number }\n}\n```\n</readme>\n\n<settings>\n\t<div class=\"padding\">\n\t\t<ui-component name=\"input\" path=\"?.url\" config=\"required:1;camouflage:1\">URL address + token</ui-component>\n\t\t<div class=\"help\">Enter URL address + token to the OpenSync server. This component will connect to the OpenSync via WebSocket.</div>\n\t</div>\n</settings>\n\n<body>\n\t<header>\n\t\t<i class=\"ICON\"></i>NAME\n\t</header>\n\t<footer>\n\t\t<ui-bind path=\"!STATUS\" config=\"template\">\n\t\t\t<script type=\"text/html\">\n\t\t\t\t<div class=\"b\"><i class=\"ti ti-globe\"></i>{{ if value.meta }}{{value.meta.name }}{{ else }}---{{ fi }}</div>\n\t\t\t\t<div><i class=\"ti ti-circle {{ if value.connected }}green{{ else }}red{{ fi }}\"></i>{{ if value.connected }}Connected{{ else }}Disconnected{{ fi }}</div>\n\t\t\t</script>\n\t\t</ui-bind>\n\t</footer>\n</body>",
			"filewriter": "<script total>\n\n\texports.id = 'filewriter';\n\texports.name = 'File Writer';\n\texports.group = 'Files';\n\texports.version = '1';\n\texports.icon = 'ti ti-pencil';\n\texports.author = 'Total.js';\n\texports.config = { path: '', serializer: 'json', rewrite: true, divider: '\\\\n' };\n\texports.inputs = [{ id: 'input', name: 'Input' }];\n\n\texports.make = function(instance, config) {\n\n\t\tvar path;\n\t\tvar divider;\n\t\tvar timeout;\n\n\t\tvar replacewhitechar = function(text) {\n\t\t\tswitch (text[1]) {\n\t\t\t\tcase 'n':\n\t\t\t\t\treturn '\\n';\n\t\t\t\tcase 'r':\n\t\t\t\t\treturn '\\r';\n\t\t\t\tcase 't':\n\t\t\t\t\treturn '\\t';\n\t\t\t}\n\t\t\treturn text;\n\t\t};\n\n\t\tinstance.message = function($) {\n\n\t\t\tif (!config.path)\n\t\t\t\treturn;\n\n\t\t\tvar data = $.data;\n\n\t\t\tswitch (config.serializer) {\n\t\t\t\tcase 'json':\n\t\t\t\t\tdata = JSON.stringify($.data);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'text':\n\t\t\t\t\tdata = data + '';\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tif (!(data instanceof Buffer)) {\n\t\t\t\tif (typeof(data) !== 'string')\n\t\t\t\t\tdata = data + '';\n\t\t\t\tdata = Buffer.from(data, 'utf8');\n\t\t\t}\n\n\t\t\tNOW = new Date();\n\t\t\tinstance.status({ used: NOW, size: data.length });\n\n\t\t\tif (config.rewrite) {\n\t\t\t\tF.Fs.writeFile(path, data, NOOP);\n\t\t\t} else {\n\t\t\t\tif (divider)\n\t\t\t\t\tdata = Buffer.concat([data, divider]);\n\t\t\t\tF.Fs.appendFile(path, data, NOOP);\n\t\t\t}\n\n\t\t\t$.destroy();\n\t\t};\n\n\t\tinstance.configure = function() {\n\t\t\tpath = config.path[0] === '~' ? PATH.root(config.path.substring(1)) : config.path;\n\t\t\tdivider = config.divider ? Buffer.from(config.divider.replace(/\\\\[a-z]/g, replacewhitechar), 'utf8') : null;\n\t\t};\n\n\t\tinstance.configure();\n\n\t};\n\n</script>\n\n<settings>\n\t<div class=\"padding\">\n\t\t<ui-component name=\"input\" path=\"?.path\" config=\"required:1;placeholder:/www/flowstream/data.json\"><b>Path</b></ui-component>\n\t\t<div class=\"help m\">Absolute path to the file. The path starts with the <code>~</code> char will use a filename in the project's root directory.</div>\n\t\t<ui-component name=\"input\" path=\"?.serializer\" config=\"dirsource:json|JSON,text|Text,buffer|Buffer;required:1\" default=\"'json'\" class=\"m\">Serializer</ui-component>\n\t\t<ui-component name=\"input\" path=\"?.rewrite\" config=\"type:checkbox\" default=\"true\">Rewrite content</ui-component>\n\t\t<ui-bind path=\"?.rewrite\" config=\"hide\" class=\"hidden\">\n\t\t\t<hr />\n\t\t\t<div class=\"row\">\n\t\t\t\t<div class=\"col-md-4 m\">\n\t\t\t\t\t<ui-component name=\"input\" path=\"?.divider\">Divider</ui-component>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</ui-bind>\n\t</div>\n</settings>\n\n<readme>\nThe component writes incoming data into the file.\n</readme>\n\n<style>\n\t.CLASS footer { padding: 10px; font-size: 12px; }\n\t.CLASS hr { margin: 5px 0; }\n</style>\n\n<body>\n\t<header>\n\t\t<i class=\"ICON\"></i>NAME\n\t</header>\n\t<footer>\n\t\t<div><i class=\"ti ti-calendar mr5\"></i><ui-bind path=\"STATUS.used\" config=\"text;format:yyyy-MM-dd HH:mm:ss;empty\"></span></ui-bind></div>\n\t\t<div><i class=\"ti ti-calculator mr5\"></i><ui-bind path=\"STATUS.size\" config=\"text;helper:filesize;empty\"></span></ui-bind></div>\n\t\t<hr />\n\t\t<ui-bind path=\"CONFIG.path\" config=\"text;empty\"></ui-bind>\n\t</footer>\n</body>"
		},
		"design": {
			"imavanz0f": {
				"id": "imavanz0f",
				"config": {
					"path": "",
					"serializer": "json",
					"rewrite": true,
					"divider": "\\n"
				},
				"x": 68,
				"y": 155,
				"component": "filewriter",
				"connections": {},
				"template": {
					"icon": "ti ti-pencil",
					"group": "Files",
					"name": "File Writer",
					"inputs": [
						{
							"id": "input",
							"name": "Input"
						}
					]
				}
			}
		},
		"variables": {},
		"sources": {},
		"origin": "http://localhost:8002",
		"dtcreated": "2025-05-05T11:56:08.452Z",
		"size": 58065,
		"variables2": {},
		"directory": "F:/sync/factory_platform/flowstream/flowstream/",
		"sandbox": false
	},
	"f1n9xn001tp51d": {
		"id": "f1n9xn001tp51d",
		"name": "wwwwwwww",
		"author": "",
		"version": "",
		"icon": "fas fa-microchip",
		"reference": "",
		"group": "",
		"url": "https://",
		"color": "",
		"readme": "",
		"design": {},
		"components": {},
		"variables": {},
		"sources": {},
		"dtcreated": "2025-05-05T11:59:04.447Z",
		"variables2": {},
		"directory": "F:/sync/factory_platform/flowstream/flowstream/",
		"sandbox": false,
		"size": 438
	},
	"f1n9xq001tp51d": {
		"paused": false,
		"id": "f1n9xq001tp51d",
		"reference": "",
		"author": "",
		"group": "",
		"icon": "fas fa-microchip",
		"color": "",
		"version": "",
		"readme": "",
		"url": "https://",
		"name": "aae33",
		"components": {},
		"design": {},
		"variables": {},
		"sources": {},
		"origin": "http://localhost:8002",
		"dtcreated": "2025-05-05T12:02:04.523Z",
		"size": 483,
		"variables2": {},
		"directory": "F:/sync/factory_platform/flowstream/flowstream/",
		"sandbox": false
	},
	"f1n9xs001tp51d": {
		"paused": false,
		"id": "f1n9xs001tp51d",
		"reference": "",
		"author": "",
		"group": "",
		"icon": "fas fa-microchip",
		"color": "",
		"version": "",
		"readme": "",
		"url": "https://",
		"name": "33ee",
		"components": {
			"mqttpublish": "<script total>\n\n\texports.id = 'mqttpublish';\n\texports.name = 'MQTT Publish';\n\texports.icon = 'ti ti-sign-out';\n\texports.group = 'MQTT';\n\texports.config = { broker: '' };\n\texports.inputs = [{ id: 'message', name: 'Message' }];\n\texports.author = 'Martin Smola';\n\texports.version = '3';\n\texports.flags = ['mqttbroker-dep'];\n\n\texports.make = function(instance, config) {\n\n\t\tinstance.configure = function() {\n\t\t\tvar broker = instance.main.find(config.broker);\n\t\t\tif (!broker)\n\t\t\t\tinstance.status('Broker not found');\n\t\t\telse\n\t\t\t\tinstance.status(broker.state.status);\n\t\t};\n\n\t\tinstance.message = function($) {\n\t\t\tvar broker = instance.main.find(config.broker);\n\t\t\tif (!broker) {\n\t\t\t\t$.destroy();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tbroker.publish($.data.topic, $.data.message);\n\t\t\t$.destroy();\n\t\t};\n\n\t\tinstance.configure();\n\t};\n\n\texports.call = function(data, answer) {\n\t\tvar arr = [];\n\n\t\tvar instances = this.instances();\n\n\t\tinstances = instances.filter(i => i.module.flags && i.module.flags.includes('mqttbroker'));\n\t\tfor (let com of instances)\n\t\t\tarr.push({ id: com.id, name: `${com.state.name} (${com.state.status})` });\n\n\t\tanswer(arr);\n\t};\n</script>\n\n<readme>\nMQTT Publish\n\nInput:\n```javascript\n{\n\ttopic: 'some/topic',\n\tmessage: { some: 'data' },\n\t// optional\n\toptions: {\n\t\tqos: 0|1|2,\n\t\tretain: true|false\n\t}\n}\n```\n</readme>\n\n<style>\n\t.CLASS footer { padding: 10px; font-size: 11px; }\n\t.CLASS footer > ui-bind > div { height: 16px; }\n\t.CLASS footer b { float: right; }\n</style>\n\n<script>\n\tON('configure_mqttpublish', function(data) {\n\t\tdata.call(function(response) {\n\t\t\tSET('%brokers', response);\n\t\t}, true);\n\t});\n</script>\n\n<settings>\n\t<div class=\"padding\">\n\t\t<div class=\"row\">\n\t\t\t<div class=\"col-md-6\">\n\t\t\t\t<ui-component name=\"input\" path=\"?.broker\" config=\"dirsource:%brokers;dirraw:1;placeholder:Select broker;dirempty:No broker;required:1\" class=\"m\"><b>Broker</b></ui-component>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</settings>\n\n<body>\n\t<header>\n\t\t<i class=\"ICON\"></i>NAME\n\t</header>\n\t<footer>\n\t\t<ui-bind path=\"!STATUS\" config=\"template;show\" class=\"block\">\n\t\t\t<script type=\"text/html\">\n\t\t\t\t<div><b>{{ value }}</b>Status</div>\n\t\t\t</script>\n\t\t</ui-bind>\n\t</footer>\n</body>",
			"trigger": "<script total>\n\n\texports.id = 'trigger';\n\texports.name = 'Trigger';\n\texports.group = 'Triggers';\n\texports.version = '5';\n\texports.icon = 'ti ti-start';\n\texports.author = 'Total.js';\n\texports.config = { random: true, type: 'string', data: '', restart: false, prompt: false };\n\texports.outputs = [{ id: 'output', name: 'Output' }];\n\texports.kind = 'trigger';\n\n\texports.make = function(instance, config) {\n\n\t\tvar regprompt = /\\{prompt\\}/g;\n\n\t\tinstance.trigger = function(msg) {\n\n\t\t\tvar random = !config.prompt && config.random;\n\t\t\tvar val = config.data;\n\t\t\tvar prompt = msg.value || '';\n\n\t\t\tswitch (config.type) {\n\t\t\t\tcase 'number':\n\t\t\t\t\tval = random ? U.random() : val.replace(regprompt, prompt).parseFloat();\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'buffer':\n\t\t\t\t\ttry {\n\t\t\t\t\t\tval = random ? Buffer.from(U.random_string()) : Buffer.from(val.replace(regprompt, prompt), 'base64');\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tinstance.throw(e);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'date':\n\t\t\t\t\tval = random ? NOW.add('-' + U.random(500, 10) + ' seconds') : val.replace(regprompt, prompt).parseDate();\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'object':\n\t\t\t\t\ttry {\n\t\t\t\t\t\tval = random ? {} : (new Function('return ' + val.replace(regprompt, prompt)))();\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tinstance.throw(e);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'boolean':\n\t\t\t\t\tvar tmp = random ? '' : val.replace(regprompt, prompt);\n\t\t\t\t\tval = random ? U.random() % 2 === 0 : tmp === 'true' || tmp === 'on' || tmp === '1';\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tval = random ? U.random_string(20) : val.replace(regprompt, prompt);\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tinstance.send('output', val);\n\t\t};\n\n\t\tconfig.restart && setTimeout(() => instance.trigger(), 5000);\n\t};\n\n</script>\n\n<style>\n\t.CLASS .padding { padding: 0 10px 10px; }\n\t.CLASS button { width: 100%; height: 24px; border: 1px solid #E0E0E0; border-radius: var(--radius); color: #000; background-color: #F0F0F0; margin: 0; }\n\t.CLASS button:hover { background-color: #F8F8F8; }\n\t.CLASS button:active { background-color: #E0E0E0; }\n\t.ui-dark .CLASS button { border-color: #404040; color: #FFF; background-color: #222; }\n\t.ui-dark .CLASS button:hover { background-color: #303030; }\n\t.ui-dark .CLASS button:active { background-color: #404040; }\n</style>\n\n<settings>\n\t<div class=\"padding\">\n\t\t<ui-component name=\"input\" path=\"?.type\" config=\"dirsource:string|String,number|Number,boolean|Boolean,date|Date,object|Object,buffer|Buffer as Base64;required:1\">Type</ui-component>\n\t\t<div class=\"mt10 m\">\n\t\t\t<ui-component name=\"input\" path=\"?.restart\" config=\"type:checkbox\">Trigger 5s after initialization.</ui-component>\n\t\t\t<ui-component name=\"input\" path=\"?.prompt\" config=\"type:checkbox\">Prompt</ui-component>\n\t\t\t<ui-bind path=\"?.prompt\" config=\"disabled\" class=\"block\">\n\t\t\t\t<ui-component name=\"input\" path=\"?.random\" config=\"type:checkbox\">Random data</ui-component>\n\t\t\t</ui-bind>\n\t\t\t<ui-bind path=\"?.prompt\" config=\"show\" class=\"block hidden m mt10\">\n\t\t\t\t<ui-component name=\"input\" path=\"?.promptlabel\" config=\"placeholder:Enter a value\"><b>Prompt label</b></ui-component>\n\t\t\t</ui-bind>\n\t\t</div>\n\t\t<ui-bind path=\"?\" config=\"hide:!value.prompt && (value.random && !value.prompt)\" class=\"hidden\">\n\t\t\t<hr />\n\t\t\t<ui-component name=\"input\" path=\"?.data\" config=\"required:1;height:250;type:multiline;maxlength:100000;monospace:1\">Data</ui-component>\n\t\t\t<ui-bind path=\"?.prompt\" config=\"show\" class=\"help hidden\">The prompt value will be assigned to the <code>{prompt}</code> keyword in the code.</ui-bind>\n\t\t</ui-bind>\n\t</div>\n</settings>\n\n<readme>\nThe component triggers data into the Flow.\n</readme>\n\n<body>\n\t<header>\n\t\t<i class=\"$ICON\"></i>$NAME\n\t</header>\n\t<div class=\"padding\">\n\t\t<button name=\"run\">Run</button>\n\t</div>\n</body>\n\n<script>\n\tTOUCH(function(exports) {\n\t\texports.click = function(el) {\n\t\t\tif (exports.config.prompt) {\n\t\t\t\tvar opt = {};\n\t\t\t\topt.name = exports.config.promptlabel || 'Enter a value';\n\t\t\t\topt.value = '';\n\t\t\t\topt.callback = val => exports.trigger({ value: val });\n\t\t\t\tSETTER('prompt/show', opt);\n\t\t\t} else\n\t\t\t\texports.trigger();\n\t\t};\n\t});\n</script>",
			"code": "<script total>\n\n\texports.id = 'code';\n\texports.name = 'Code';\n\texports.group = 'Common';\n\texports.version = '4';\n\texports.icon = 'ti ti-code';\n\texports.author = 'Total.js';\n\texports.config = { outputs: 1, name: 'Code', code: '// instance {FlowStreamInstance};\\n// $ {FlowStreamMessage};\\n// vars {Object};\\n// repo {Object};\\n// data {String/Number/Boolean/Date/Buffer/Object};\\n// $.send(\\'output\\', data); // or simply send(data); which uses the first output\\n// $.destroy();\\n// $.throw(err);\\n\\n// IMPORTANT: If you do not perform re-send, you need to destroy this message via $.destroy() method\\n// IMPORTANT: methods $.send(), $.destroy() and $.throw() can be executed only once\\n\\n// $.send(\\'output\\', data);\\n$.destroy();' };\n\texports.inputs = [{ id: 'input', name: 'Input' }];\n\texports.outputs = [{ id: 'output', name: 'Output' }];\n\texports.meta = { settingswidth: 1200 };\n\n\texports.make = function(instance, config) {\n\n\t\tvar fn;\n\n\t\tinstance.message = function($) {\n\t\t\tif (fn) {\n\t\t\t\ttry {\n\t\t\t\t\tvar send = data => $.send('output', data);\n\t\t\t\t\tfn($.data, instance, $, $, F.require, send, $.repo, $.vars, $.data);\n\t\t\t\t} catch (e) {\n\t\t\t\t\t$.throw(e);\n\t\t\t\t\t$.destroy();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tinstance.configure = function() {\n\t\t\tinstance.outputs = [];\n\t\t\tfor (let i = 1; i <= config.outputs; i++)\n\t\t\t\tinstance.outputs.push({ id: 'output' + (i === 1 ? '' : i), name: 'Output #' + i });\n\t\t\tinstance.save();\n\n\t\t\ttry {\n\t\t\t\tif (config.code) {\n\t\t\t\t\tinstance.status(1);\n\t\t\t\t\tfn = new Function('value', 'instance', '$', 'message', 'require', 'send', 'repo', 'vars', 'data', config.code);\n\t\t\t\t} else {\n\t\t\t\t\tinstance.status(0);\n\t\t\t\t\tfn = null;\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\tfn = null;\n\t\t\t\tinstance.throw('Code: ' + e.message);\n\t\t\t}\n\t\t};\n\n\t\tinstance.close = function() {\n\t\t\tfn = null;\n\t\t};\n\n\t\tinstance.configure();\n\n\t};\n\n</script>\n\n<readme>\nThis component executes a custom JavaScript code as it is.\n\nTo send data to the default output use `send(somedata);`\nTo send data to specific output when number of outputs > 1 use `$.send('outputX', somedata)` where `X` is output index, see example bellow:\n- first output--> `send(somedata)` or `$.send('output', somedata)`\n- second output --> `$.send('output2', somedata)`\n- ...\n- 5th output --> `$.send('output5', somedata)`\n- etc.\n</readme>\n\n<settings>\n\t<div class=\"padding\">\n\t\t<div class=\"row\">\n\t\t\t<div class=\"col-md-10 m\">\n\t\t\t\t<ui-component name=\"input\" path=\"?.name\">Name</ui-component>\n\t\t\t</div>\n\t\t\t<div class=\"col-md-2 m\">\n\t\t\t\t<ui-component name=\"input\" path=\"?.outputs\" config=\"type:number;format:\">Number of outputs</ui-component>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class=\"ui-input-label\">Code:</div>\n\t\t<div class=\"m\">\n\t\t\t<ui-component name=\"codemirror\" path=\"?.code\" config=\"type:javascript;minheight:300;parent:auto;margin:60;tabs:true;trim:true\"></ui-component>\n\t\t</div>\n\t</div>\n</settings>\n\n<script>\n\tTOUCH(function(exports, init) {\n\t\texports.configure = function() {\n\t\t\tvar changes = exports.instance.changes;\n\t\t\tif (changes && changes.newbie) {\n\t\t\t\tvar outputs = [];\n\t\t\t\tvar count = exports.instance.config.outputs;\n\t\t\t\tfor (let i = 1; i <= count; i++)\n\t\t\t\t\toutputs.push({ id: 'output' + (i === 1 ? '' : i), name: (count === 1 ? 'Output' : 'Output #' + i) });\n\t\t\t\texports.instance.outputs = outputs;\n\t\t\t\tUPD('flow.data');\n\t\t\t}\n\t\t}\n\t});\n</script>\n\n<body>\n\t<header>\n\t\t<i class=\"ICON\"></i>NAME\n\t</header>\n</body>",
			"mqttbroker": "<script total>\n\n\texports.id = 'mqttbroker';\n\texports.name = 'MQTT Broker';\n\texports.icon = 'ti ti-exchange';\n\texports.group = 'MQTT';\n\texports.config = { host: 'localhost', port: 1883, secure: false };\n\texports.outputs = [{ id: 'output', name: 'Messages' }];\n\texports.author = 'Martin Smola';\n\texports.version = '3';\n\texports.npm = ['mqtt'];\n\texports.flags = ['mqttbroker'];\n\n\texports.make = function(instance, config) {\n\n\t\tconst mqtt = require('mqtt');\n\t\tvar client;\n\t\tconst subscribtions = {};\n\n\t\tconst state = () => {\n\t\t\tvar obj;\n\t\t\tif (!client) {\n\t\t\t\tobj = { connected: false, connecting: false, disconnected: true, disconnnecting: false, status: 'disconnected' };\n\t\t\t} else {\n\t\t\t\tconst { connected, disconnecting, reconnecting } = client;\n\t\t\t\tobj = { connecting: client.stream ? client.stream.connecting : false, connected, disconnecting, reconnecting };\n\t\t\t\tconst current = Object.keys(obj).filter(s => obj[s]);\n\t\t\t\tobj.status = current.length ? current[0] : 'disconnected';\n\t\t\t}\n\n\t\t\tinstance.state = { status: obj.status, name: config.host + ':' + config.port };\n\t\t\tinstance.status(instance.state);\n\t\t\treturn obj;\n\t\t};\n\n\t\tinstance.configure = function() {\n\t\t\tdisconnect(connect);\n\t\t};\n\n\t\tinstance.close = function() {\n\t\t\tdisconnect(notifypubsub);\n\t\t};\n\n\t\tinstance.configure();\n\n\t\tfunction disconnect(callback) {\n\t\t\tif (!client)\n\t\t\t\treturn callback && callback();\n\n\t\t\tif (client.end)\n\t\t\t\tclient.end(true, cb);\n\t\t\telse\n\t\t\t\tcb();\n\n\t\t\tfunction cb() {\n\t\t\t\tclient.removeAllListeners();\n\t\t\t\tclient = null;\n\t\t\t\tcallback && callback();\n\t\t\t};\n\t\t};\n\n\t\tfunction connect() {\n\n\t\t\tstate();\n\n\t\t\tvar broker = config.secure ? 'mqtts://' : 'mqtt://' + config.host + ':' + config.port;\n\t\t\tconfig.name = '[MQTT] ' + config.host + ':' + config.port;\n\t\t\tvar opt = CLONE(config);\n\t\t\tdelete opt.auth;\n\t\t\tclient = mqtt.connect(broker, opt);\n\n\t\t\tclient.on('connect', function() {\n\t\t\t\tstate();\n\t\t\t\tnotifypubsub();\n\t\t\t});\n\n\t\t\tclient.on('reconnect', function() {\n\t\t\t\tstate();\n\t\t\t});\n\n\t\t\tclient.on('message', function(topic, message) {\n\t\t\t\tmessage = message.toString();\n\t\t\t\tif (message[0] === '{' || message[0] === '[')\n\t\t\t\t\tmessage = message.parseJSON(true);\n\n\t\t\t\tonmessage(topic, message);\n\t\t\t});\n\n\t\t\tclient.on('close', function(err) {\n\t\t\t\tconsole.log(config.name + ' close', err);\n\t\t\t\tstate();\n\t\t\t});\n\n\t\t\tclient.on('error', function(err) {\n\t\t\t\tconsole.log(config.name + ' error', err);\n\t\t\t\tstate();\n\t\t\t});\n\t\t};\n\n\t\tfunction onmessage(topic, message) {\n\t\t\tlet ts = new Date();\n\t\t\tfor (const sub in subscribtions) {\n\t\t\t\tvar match = mqttWildcard(topic, sub);\n\t\t\t\tif (match) {\n\t\t\t\t\tconst ids = subscribtions[sub];\n\t\t\t\t\tconst len = ids.length;\n\t\t\t\t\tfor (let i = 0; i < len; i++) {\n\t\t\t\t\t\tconst com = instance.main.find(ids[i]);\n\t\t\t\t\t\tcom && com.onmessage(topic, message, match, ts);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tinstance.send('output', { topic, message, ts });\n\t\t}\n\n\t\tinstance.publish = function(topic, message, options) {\n\t\t\tvar isstring = typeof(message) === 'string';\n\t\t\tvar data = '';\n\t\t\tif (isstring)\n\t\t\t\tdata = message;\n\t\t\telse\n\t\t\t\ttry {\n\t\t\t\t\tdata = JSON.stringify(message);\n\t\t\t\t} catch(e) {}\n\n\t\t\tclient && client.publish(topic, data, options, function(err){\n\t\t\t\tif (err)\n\t\t\t\t\tconsole.log(config.name + ' publish error', err);\n\t\t\t});\n\t\t};\n\n\t\tinstance.subscribe = function(componentid, topic) {\n\t\t\tvar self = this;\n\t\t\tsubscribtions[topic] = subscribtions[topic] || [];\n\t\t\tif (subscribtions[topic].indexOf(componentid) > -1)\n\t\t\t\treturn;\n\n\t\t\tclient.subscribe(topic);\n\t\t\tsubscribtions[topic].push(componentid);\n\t\t};\n\n\t\tinstance.unsubscribe = function(componentid, topic) {\n\t\t\tvar self = this;\n\t\t\tvar sub = subscribtions[topic];\n\t\t\tif (sub) {\n\t\t\t\tsubscribtions[topic] = sub.remove(componentid);\n\t\t\t\tclient && client.connected && !subscribtions[topic].length && client.unsubscribe(topic);\n\t\t\t}\n\t\t};\n\n\t\tfunction notifypubsub() {\n\t\t\tvar instances = instance.main.instances().filter(i => i.module.flags && i.module.flags.includes('mqttbroker-dep') > -1 && i.config.broker === instance.id);\n\t\t\tfor (let com of instances)\n\t\t\t\tcom.configure();\n\t\t}\n\n\t\t// https://github.com/hobbyquaker/mqtt-wildcard\n\t\tfunction mqttWildcard(topic, wildcard) {\n\t\t\tif (topic === wildcard) {\n\t\t\t\treturn [];\n\t\t\t} else if (wildcard === '#') {\n\t\t\t\treturn [topic];\n\t\t\t}\n\n\t\t\tvar res = [];\n\n\t\t\tvar t = String(topic).split('/');\n\t\t\tvar w = String(wildcard).split('/');\n\n\t\t\tvar i = 0;\n\t\t\tfor (var lt = t.length; i < lt; i++) {\n\t\t\t\tif (w[i] === '+') {\n\t\t\t\t\tres.push(t[i]);\n\t\t\t\t} else if (w[i] === '#') {\n\t\t\t\t\tres.push(t.slice(i).join('/'));\n\t\t\t\t\treturn res;\n\t\t\t\t} else if (w[i] !== t[i]) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (w[i] === '#') {\n\t\t\t\ti += 1;\n\t\t\t}\n\n\t\t\treturn (i === w.length) ? res : null;\n\t\t}\n\t};\n\n</script>\n\n<readme>\n\n</readme>\n\n<style>\n\t.CLASS footer { padding: 10px; font-size: 11px; }\n\t.CLASS footer > ui-bind > div { height: 16px; }\n\t.CLASS footer b { float: right; }\n</style>\n\n<settings>\n\t<div class=\"padding\">\n\t\t<div class=\"row m\">\n\t\t\t<div class=\"col-md-4\">\n\t\t\t\t<ui-component name=\"input\" path=\"?.host\" config=\"placeholder:test.mosquitto.org;required:1\">Hostname or IP address</ui-component>\n\t\t\t</div>\n\t\t\t<div class=\"col-md-4\">\n\t\t\t\t<ui-component name=\"input\" path=\"?.port\" config=\"type:number;placeholder:1883;required:1;format:\">Port</ui-component>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class=\"row\">\n\t\t\t<div class=\"col-md-6\">\n\t\t\t\t<ui-component name=\"input\" path=\"?.clientid\">Client id</ui-component>\n\t\t\t\t<div class=\"help m\">Supports variables, example: \\`client_{device-id}\\`</div>\n\t\t\t\t<ui-component name=\"checkbox\" path=\"?.secure\" class=\"m\">Secure (ssl)</ui-component>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class=\"row\">\n\t\t\t<div class=\"col-md-6\">\n\t\t\t\t<ui-component name=\"checkbox\" path=\"?.auth\" class=\"m\">Require Authorization</ui-component>\n\t\t\t</div>\n\t\t</div>\n\t\t<ui-bind path=\"?.auth\" config=\"show:value\" class=\"row block\">\n\t\t\t<div class=\"col-md-6\">\n\t\t\t\t<ui-component name=\"input\" path=\"?.username\" class=\"m\">Username</ui-component>\n\t\t\t</div>\n\t\t\t<div class=\"col-md-6\">\n\t\t\t\t<ui-component name=\"input\" path=\"?.password\" data-jc-config=\"type:password\" class=\"m\">Password</ui-component>\n\t\t\t</div>\n\t\t</ui-bind>\n\t\t<div class=\"row\">\n\t\t\t<div class=\"col-md-6\">\n\t\t\t\t<ui-component name=\"checkbox\" path=\"?.lwt\" class=\"m\">LWT</ui-component>\n\t\t\t</div>\n\t\t</div>\n\t\t<ui-bind path=\"?.lwt\" config=\"show:value\" class=\"row block\">\n\t\t\t<div class=\"col-md-6\">\n\t\t\t\t<ui-component name=\"input\" path=\"?.lwttopic\">Last will topic</ui-component>\n\t\t\t\t<div class=\"help m\">Supports variables, example: \\`lwt/{device-id}\\`</div>\n\t\t\t</div>\n\t\t\t<div class=\"col-md-6\">\n\t\t\t\t<ui-component name=\"input\" path=\"?.lwtmessage\">Last will message</ui-component>\n\t\t\t\t<div class=\"help m\">Supports variables, example: \\`{device-id} is offline\\`</div>\n\t\t\t</div>\n\t\t</ui-bind>\n\t</div>\n</settings>\n\n<body>\n\t<header>\n\t\t<i class=\"ICON\"></i>NAME\n\t</header>\n\t<footer>\n\t\t<ui-bind path=\"!STATUS\" config=\"template;show\" class=\"block\">\n\t\t\t<script type=\"text/html\">\n\t\t\t\t<div><b>{{ value.name }}</b>Name</div>\n\t\t\t\t<div><b>{{ value.status }}</b>Status</div>\n\t\t\t</script>\n\t\t</ui-bind>\n\t</footer>\n</body>",
			"print": "<script total>\n\n\texports.id = 'print';\n\texports.name = 'Print';\n\texports.group = 'Common';\n\texports.version = '7';\n\texports.icon = 'ti ti-print';\n\texports.author = 'Total.js';\n\texports.config = { repo: false, data: true, text: false };\n\texports.inputs = [{ id: 'input', name: 'Input' }];\n\n\texports.make = function(instance, config) {\n\n\t\tfunction serializer(key, value) {\n\t\t\treturn value && value.type === 'Buffer' && value.data ? ('<Buffer ' + value.data.splice(0, 10).map(n => n.toString(16).padLeft(2, '0')).join('') + '...') : value;\n\t\t}\n\n\t\tinstance.message = function($) {\n\n\t\t\tvar data = $.data;\n\n\t\t\tif (config.data !== false) {\n\t\t\t\tif (data instanceof Buffer)\n\t\t\t\t\tdata = '<Buffer ' + data.toString('hex').substring(0, 10) + '...';\n\t\t\t}\n\n\t\t\tvar count = 0;\n\n\t\t\tfor (var key in config) {\n\t\t\t\tif (config[key])\n\t\t\t\t\tcount++;\n\t\t\t}\n\n\t\t\tvar output = count > 1 ? {} : null;\n\n\t\t\tif (config.repo) {\n\t\t\t\tif (output)\n\t\t\t\t\toutput.repo = $.repo;\n\t\t\t\telse\n\t\t\t\t\toutput = $.repository;\n\t\t\t}\n\n\t\t\tif (config.data) {\n\t\t\t\tif (output)\n\t\t\t\t\toutput.data = $.data;\n\t\t\t\telse\n\t\t\t\t\toutput = $.data;\n\t\t\t}\n\n\t\t\tif (output) {\n\t\t\t\toutput = JSON.stringify(output, serializer);\n\t\t\t\tinstance.status(output, 200);\n\t\t\t}\n\n\t\t\t$.destroy();\n\t\t};\n\n\t\tinstance.trigger = function() {\n\t\t\tinstance.status('');\n\t\t};\n\n\t};\n\n</script>\n\n<style>\n\t.CLASS footer > ui-bind { margin: 10px; }\n\t.CLASS pre { font-size: 10px; margin: 0; padding: 5px; background-color: #F0F0F0; border-radius: var(--radius); }\n\t.CLASS .json { white-space: pre; }\n\t.CLASS .noscrollbar { max-height: 250px; }\n\t.CLASS .readme { position: absolute; position: absolute; font-size: 11px; right: 5px; margin-top: -5px; cursor: pointer; }\n\t.ui-dark .CLASS pre { background-color: #404040; tab-size: 2; }\n</style>\n\n<readme>\nThe component prints incoming data in a JSON format.\n</readme>\n\n<settings>\n\t<div class=\"padding\">\n\t\t<ui-component name=\"input\" path=\"?.repo\" config=\"type:checkbox\">Shows repository</ui-component>\n\t\t<ui-component name=\"input\" path=\"?.data\" config=\"type:checkbox\">Shows data</ui-component>\n\t</div>\n</settings>\n\n<body>\n\t<header>\n\t\t<button class=\"exec button\" data-exec=\"FUNC.trigger\">Clear</button>\n\t\t<i class=\"$ICON\"></i>$NAME\n\t</header>\n\t<footer>\n\t\t<ui-bind path=\"!$STATUS\" config=\"html pre:debugprinter(value);show\" class=\"hidden selectable block\">\n\t\t\t<span class=\"readme\" title=\"Open in new window\"><i class=\"ti ti-window\"></i></span>\n\t\t\t<div class=\"noscrollbar mt5\">\n\t\t\t\t<pre class=\"json\"></pre>\n\t\t\t</div>\n\t\t</ui-bind>\n\t</footer>\n</body>\n\n<script>\n\n\tW.debugprinter = function(value) {\n\t\tif (value) {\n\t\t\tvalue = JSON.parse(value);\n\t\t\tif (typeof(value) === 'string')\n\t\t\t\treturn Thelpers.encode(value);\n\t\t\telse\n\t\t\t\treturn Thelpers.jsonformat(JSON.stringify(value, null, '\\t'));\n\t\t} else\n\t\t\treturn '';\n\t};\n\n\tTOUCH(function(exports, reinit) {\n\n\t\tif (reinit)\n\t\t\treturn;\n\n\t\tvar laststatus;\n\n\t\texports.status = function(status, isinit) {\n\t\t\tlaststatus = status;\n\t\t};\n\n\t\texports.element.on('click', '.readme', function() {\n\t\t\tvar status = laststatus ? JSON.parse(laststatus) : null;\n\n\t\t\tif (status != null) {\n\t\t\t\tif (typeof(status) !== 'string')\n\t\t\t\t\tstatus = JSON.stringify(status, null, '  ');\n\t\t\t} else\n\t\t\t\tstatus = '';\n\n\t\t\tFUNC.readme('Debug', '```json\\n' + status + '\\n```');\n\t\t});\n\n\t});\n</script>"
		},
		"design": {
			"imb5ls06r": {
				"id": "imb5ls06r",
				"config": {
					"broker": "imb5ltiyy"
				},
				"x": 631,
				"y": 256,
				"component": "mqttpublish",
				"connections": {},
				"template": {
					"icon": "ti ti-sign-out",
					"group": "MQTT",
					"name": "MQTT Publish",
					"inputs": [
						{
							"id": "message",
							"name": "Message"
						}
					]
				}
			},
			"imb5ls163": {
				"id": "imb5ls163",
				"config": {
					"random": true,
					"type": "string",
					"data": "",
					"restart": false,
					"prompt": false
				},
				"x": 266,
				"y": 238,
				"component": "trigger",
				"connections": {
					"output": [
						{
							"id": "imb5lt8v7",
							"index": "input"
						},
						{
							"id": "imb5lv5ca",
							"index": "input"
						}
					]
				},
				"template": {
					"icon": "ti ti-start",
					"group": "Triggers",
					"name": "Trigger",
					"outputs": [
						{
							"id": "output",
							"name": "Output"
						}
					]
				}
			},
			"imb5lt8v7": {
				"id": "imb5lt8v7",
				"config": {
					"outputs": 1,
					"name": "Code",
					"code": "// instance {FlowStreamInstance};\n// $ {FlowStreamMessage};\n// vars {Object};\n// repo {Object};\n// data {String/Number/Boolean/Date/Buffer/Object};\n// $.send('output', data); // or simply send(data); which uses the first output\n// $.destroy();\n// $.throw(err);\n\n// IMPORTANT: If you do not perform re-send, you need to destroy this message via $.destroy() method\n// IMPORTANT: methods $.send(), $.destroy() and $.throw() can be executed only once\n\n// $.send('output', data);\n$.destroy();"
				},
				"x": 426,
				"y": 423,
				"component": "code",
				"connections": {
					"output": [
						{
							"id": "imb5ls06r",
							"index": "message"
						}
					]
				},
				"outputs": [
					{
						"id": "output",
						"name": "Output #1"
					}
				],
				"template": {
					"icon": "ti ti-code",
					"group": "Common",
					"name": "Code",
					"inputs": [
						{
							"id": "input",
							"name": "Input"
						}
					],
					"outputs": [
						{
							"id": "output",
							"name": "Output"
						}
					]
				}
			},
			"imb5ltiyy": {
				"id": "imb5ltiyy",
				"config": {
					"host": "localhost",
					"port": 1883,
					"secure": false,
					"name": "[MQTT] localhost:1883"
				},
				"x": 713,
				"y": 450,
				"component": "mqttbroker",
				"connections": {},
				"template": {
					"icon": "ti ti-exchange",
					"group": "MQTT",
					"name": "MQTT Broker",
					"outputs": [
						{
							"id": "output",
							"name": "Messages"
						}
					]
				}
			},
			"imb5lv5ca": {
				"id": "imb5lv5ca",
				"config": {
					"repo": false,
					"data": true,
					"text": false
				},
				"x": 320,
				"y": 577,
				"component": "print",
				"connections": {},
				"template": {
					"icon": "ti ti-print",
					"group": "Common",
					"name": "Print",
					"inputs": [
						{
							"id": "input",
							"name": "Input"
						}
					]
				}
			},
			"paused": {
				"output__imb5ls163__output": 1
			}
		},
		"variables": {},
		"sources": {},
		"origin": "http://127.0.0.1:8002",
		"dtcreated": "2025-05-05T12:04:04.541Z",
		"size": 24633
	},
	"f1n9xt001un51d": {
		"id": "f1n9xt001un51d",
		"name": "eedd",
		"author": "",
		"version": "",
		"icon": "fas fa-microchip",
		"reference": "",
		"group": "",
		"url": "https://",
		"color": "",
		"readme": "",
		"design": {},
		"components": {},
		"variables": {},
		"sources": {},
		"dtcreated": "2025-05-05T12:04:40.259Z",
		"variables2": {},
		"directory": "F:/sync/factory_platform/flowstream/flowstream/",
		"sandbox": false,
		"size": 434
	},
	"f1n9ye001un51d": {
		"paused": false,
		"id": "f1n9ye001un51d",
		"reference": "",
		"author": "",
		"group": "",
		"icon": "fas fa-microchip",
		"color": "",
		"version": "",
		"readme": "",
		"url": "https://",
		"name": "55rrr",
		"components": {},
		"design": {},
		"variables": {},
		"sources": {},
		"origin": "http://127.0.0.1:8000",
		"dtcreated": "2025-05-05T12:25:42.916Z",
		"size": 483,
		"variables2": {},
		"directory": "F:/sync/factory_platform/flowstream/flowstream/",
		"sandbox": false
	},
	"f1n9yf001un51d": {
		"id": "f1n9yf001un51d",
		"name": "aaaaaaae3",
		"author": "",
		"version": "",
		"icon": "fas fa-microchip",
		"reference": "",
		"group": "",
		"url": "https://",
		"color": "",
		"readme": "",
		"design": {},
		"components": {},
		"variables": {},
		"sources": {},
		"dtcreated": "2025-05-05T12:26:42.921Z",
		"variables2": {},
		"directory": "F:/sync/factory_platform/flowstream/flowstream/",
		"sandbox": false,
		"size": 439
	},
	"f1n9yf002un50d": {
		"id": "f1n9yf002un50d",
		"name": "eeeeee",
		"author": "",
		"version": "",
		"icon": "fas fa-microchip",
		"reference": "",
		"group": "",
		"url": "https://",
		"color": "",
		"readme": "",
		"design": {},
		"components": {},
		"variables": {},
		"sources": {},
		"dtcreated": "2025-05-05T12:27:00.789Z",
		"variables2": {},
		"directory": "F:/sync/factory_platform/flowstream/flowstream/",
		"sandbox": false,
		"size": 436
	},
	"f1n9yg001un51d": {
		"id": "f1n9yg001un51d",
		"name": "wwwwww2",
		"author": "",
		"version": "",
		"icon": "fas fa-microchip",
		"reference": "",
		"group": "",
		"url": "https://",
		"color": "",
		"readme": "",
		"design": {},
		"components": {},
		"variables": {},
		"sources": {},
		"dtcreated": "2025-05-05T12:27:42.931Z",
		"variables2": {},
		"directory": "F:/sync/factory_platform/flowstream/flowstream/",
		"sandbox": false,
		"size": 437
	},
	"f1n9yj001un51d": {
		"paused": true,
		"id": "f1n9yj001un51d",
		"reference": "",
		"author": "",
		"group": "",
		"icon": "fas fa-microchip",
		"color": "",
		"version": "",
		"readme": "",
		"url": "https://",
		"name": "a33ddc",
		"components": {},
		"design": {},
		"variables": {},
		"sources": {},
		"origin": "http://127.0.0.1:8002",
		"dtcreated": "2025-05-05T12:30:42.959Z",
		"size": 309
	},
	"f1n9yk001un51d": {
		"paused": false,
		"id": "f1n9yk001un51d",
		"reference": "",
		"author": "",
		"group": "",
		"icon": "fas fa-microchip",
		"color": "",
		"version": "",
		"readme": "",
		"url": "https://",
		"name": "aaaaaaaaaaa3",
		"components": {},
		"design": {},
		"variables": {},
		"sources": {},
		"origin": "http://127.0.0.1:8002",
		"dtcreated": "2025-05-05T12:31:42.965Z",
		"size": 490,
		"variables2": {},
		"directory": "F:/sync/factory_platform/flowstream/flowstream/",
		"sandbox": false
	},
	"f1n9yl001un51d": {
		"id": "f1n9yl001un51d",
		"name": "ee3d",
		"author": "",
		"version": "",
		"icon": "fas fa-microchip",
		"reference": "",
		"group": "",
		"url": "https://",
		"color": "",
		"readme": "",
		"design": {},
		"components": {},
		"variables": {},
		"sources": {},
		"dtcreated": "2025-05-05T12:32:42.968Z",
		"variables2": {},
		"directory": "F:/sync/factory_platform/flowstream/flowstream/",
		"sandbox": false,
		"size": 434
	},
	"f1n9yl002un50d": {
		"id": "f1n9yl002un50d",
		"name": "aaaaaa",
		"author": "",
		"version": "",
		"icon": "fas fa-microchip",
		"reference": "",
		"group": "",
		"url": "https://",
		"color": "",
		"readme": "",
		"design": {},
		"components": {},
		"variables": {},
		"sources": {},
		"dtcreated": "2025-05-05T12:33:22.365Z",
		"variables2": {},
		"directory": "F:/sync/factory_platform/flowstream/flowstream/",
		"sandbox": false,
		"size": 436
	},
	"f1n9yn001un51d": {
		"id": "f1n9yn001un51d",
		"name": "aaaa3",
		"author": "",
		"version": "",
		"icon": "fas fa-microchip",
		"reference": "",
		"group": "",
		"url": "https://",
		"color": "",
		"readme": "",
		"design": {},
		"components": {},
		"variables": {},
		"sources": {},
		"dtcreated": "2025-05-05T12:34:42.980Z",
		"variables2": {},
		"directory": "F:/sync/factory_platform/flowstream/flowstream/",
		"sandbox": false,
		"size": 435
	},
	"f1n9yn002un50d": {
		"id": "f1n9yn002un50d",
		"name": "jjj",
		"author": "",
		"version": "",
		"icon": "fas fa-microchip",
		"reference": "",
		"group": "",
		"url": "https://",
		"color": "",
		"readme": "",
		"design": {},
		"components": {},
		"variables": {},
		"sources": {},
		"dtcreated": "2025-05-05T12:35:03.592Z",
		"variables2": {},
		"directory": "F:/sync/factory_platform/flowstream/flowstream/",
		"sandbox": false,
		"size": 433
	},
	"f1na0r001un51d": {
		"paused": false,
		"id": "f1na0r001un51d",
		"reference": "",
		"author": "",
		"group": "",
		"icon": "fas fa-microchip",
		"color": "",
		"version": "",
		"readme": "",
		"url": "https://",
		"name": "eee",
		"components": {},
		"design": {},
		"variables": {},
		"sources": {},
		"origin": "http://localhost:8002",
		"dtcreated": "2025-05-05T13:51:00.635Z",
		"size": 481,
		"variables2": {},
		"directory": "F:/sync/factory_platform/flowstream/flowstream/",
		"sandbox": false
	},
	"f1nqv1001er51d": {
		"paused": false,
		"id": "f1nqv1001er51d",
		"reference": "",
		"author": "",
		"group": "",
		"icon": "fas fa-user",
		"color": "",
		"version": "",
		"readme": "",
		"url": "2",
		"name": "test",
		"components": {
			"mqtt-broker": "<script total>\n\n\texports.name = 'MQTT Broker';\n\texports.icon = 'fa fa-exchange-alt';\n\texports.group = 'MQTT';\n\texports.config = { host: 'localhost', port: 1883, secure: false };\n\texports.outputs = [{ id: 'output', name: 'Messages' }];\n\texports.author = 'Martin Smola';\n\texports.version = '3';\n\texports.npm = ['mqtt'];\n\texports.flags = ['mqttbroker'];\n\n\texports.make = function(instance, config) {\n\n\t\tconst mqtt = require('mqtt');\n\t\tvar client;\n\t\tconst subscribtions = {};\n\n\t\tconst state = () => {\n\t\t\tvar obj;\n\t\t\tif (!client) {\n\t\t\t\tobj = { connected: false, connecting: false, disconnected: true, disconnnecting: false, status: 'disconnected' };\n\t\t\t} else {\n\t\t\t\tconst { connected, disconnecting, reconnecting } = client;\n\t\t\t\tobj = { connecting: client.stream ? client.stream.connecting : false, connected, disconnecting, reconnecting };\n\t\t\t\tconst current = Object.keys(obj).filter(s => obj[s]);\n\t\t\t\tobj.status = current.length ? current[0] : 'disconnected';\n\t\t\t}\n\n\t\t\tinstance.state = { status: obj.status, name: config.host + ':' + config.port };\n\t\t\tinstance.status(instance.state);\n\t\t\treturn obj;\n\t\t};\n\n\t\tinstance.configure = function() {\n\t\t\tdisconnect(connect);\n\t\t};\n\n\t\tinstance.close = function() {\n\t\t\tdisconnect(notifypubsub);\n\t\t};\n\n\t\tinstance.configure();\n\n\t\tfunction disconnect(callback) {\n\t\t\tif (!client)\n\t\t\t\treturn callback && callback();\n\n\t\t\tif (client.end)\n\t\t\t\tclient.end(true, cb);\n\t\t\telse\n\t\t\t\tcb();\n\n\t\t\tfunction cb() {\n\t\t\t\tclient.removeAllListeners();\n\t\t\t\tclient = null;\n\t\t\t\tcallback && callback();\n\t\t\t};\n\t\t};\n\n\t\tfunction connect() {\n\n\t\t\tstate();\n\n\t\t\tvar broker = config.secure ? 'mqtts://' : 'mqtt://' + config.host + ':' + config.port;\n\t\t\tconfig.name = '[MQTT] ' + config.host + ':' + config.port;\n\t\t\tvar opt = CLONE(config);\n\t\t\tdelete opt.auth;\n\t\t\tclient = mqtt.connect(broker, opt);\n\n\t\t\tclient.on('connect', function() {\n\t\t\t\tstate();\n\t\t\t\tnotifypubsub();\n\t\t\t});\n\n\t\t\tclient.on('reconnect', function() {\n\t\t\t\tstate();\n\t\t\t});\n\n\t\t\tclient.on('message', function(topic, message) {\n\t\t\t\tmessage = message.toString();\n\t\t\t\tif (message[0] === '{' || message[0] === '[')\n\t\t\t\t\tmessage = message.parseJSON(true);\n\n\t\t\t\tonmessage(topic, message);\n\t\t\t});\n\n\t\t\tclient.on('close', function(err) {\n\t\t\t\tconsole.log(config.name + ' close', err);\n\t\t\t\tstate();\n\t\t\t});\n\n\t\t\tclient.on('error', function(err) {\n\t\t\t\tconsole.log(config.name + ' error', err);\n\t\t\t\tstate();\n\t\t\t});\n\t\t};\n\n\t\tfunction onmessage(topic, message) {\n\t\t\tlet ts = new Date();\n\t\t\tfor (const sub in subscribtions) {\n\t\t\t\tvar match = mqttWildcard(topic, sub);\n\t\t\t\tif (match) {\n\t\t\t\t\tconst ids = subscribtions[sub];\n\t\t\t\t\tconst len = ids.length;\n\t\t\t\t\tfor (let i = 0; i < len; i++) {\n\t\t\t\t\t\tconst com = instance.main.find(ids[i]);\n\t\t\t\t\t\tcom && com.onmessage(topic, message, match, ts);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tinstance.send('output', { topic, message, ts });\n\t\t}\n\n\t\tinstance.publish = function(topic, message, options) {\n\t\t\tvar isstring = typeof(message) === 'string';\n\t\t\tvar data = '';\n\t\t\tif (isstring)\n\t\t\t\tdata = message;\n\t\t\telse\n\t\t\t\ttry {\n\t\t\t\t\tdata = JSON.stringify(message);\n\t\t\t\t} catch(e) {}\n\n\t\t\tclient && client.publish(topic, data, options, function(err){\n\t\t\t\tif (err)\n\t\t\t\t\tconsole.log(config.name + ' publish error', err);\n\t\t\t});\n\t\t};\n\n\t\tinstance.subscribe = function(componentid, topic) {\n\t\t\tvar self = this;\n\t\t\tsubscribtions[topic] = subscribtions[topic] || [];\n\t\t\tif (subscribtions[topic].indexOf(componentid) > -1)\n\t\t\t\treturn;\n\n\t\t\tclient.subscribe(topic);\n\t\t\tsubscribtions[topic].push(componentid);\n\t\t};\n\n\t\tinstance.unsubscribe = function(componentid, topic) {\n\t\t\tvar self = this;\n\t\t\tvar sub = subscribtions[topic];\n\t\t\tif (sub) {\n\t\t\t\tsubscribtions[topic] = sub.remove(componentid);\n\t\t\t\tclient && client.connected && !subscribtions[topic].length && client.unsubscribe(topic);\n\t\t\t}\n\t\t};\n\n\t\tfunction notifypubsub() {\n\t\t\tvar instances = instance.main.instances().filter(i => i.module.flags && i.module.flags.includes('mqttbroker-dep') > -1 && i.config.broker === instance.id);\n\t\t\tfor (let com of instances)\n\t\t\t\tcom.configure();\n\t\t}\n\n\t\t// https://github.com/hobbyquaker/mqtt-wildcard\n\t\tfunction mqttWildcard(topic, wildcard) {\n\t\t\tif (topic === wildcard) {\n\t\t\t\treturn [];\n\t\t\t} else if (wildcard === '#') {\n\t\t\t\treturn [topic];\n\t\t\t}\n\n\t\t\tvar res = [];\n\n\t\t\tvar t = String(topic).split('/');\n\t\t\tvar w = String(wildcard).split('/');\n\n\t\t\tvar i = 0;\n\t\t\tfor (var lt = t.length; i < lt; i++) {\n\t\t\t\tif (w[i] === '+') {\n\t\t\t\t\tres.push(t[i]);\n\t\t\t\t} else if (w[i] === '#') {\n\t\t\t\t\tres.push(t.slice(i).join('/'));\n\t\t\t\t\treturn res;\n\t\t\t\t} else if (w[i] !== t[i]) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (w[i] === '#') {\n\t\t\t\ti += 1;\n\t\t\t}\n\n\t\t\treturn (i === w.length) ? res : null;\n\t\t}\n\t};\n\n</script>\n\n<readme>\n\n</readme>\n\n<style>\n\t.CLASS footer { padding: 10px; font-size: 11px; }\n\t.CLASS footer > div > div { height: 16px; }\n\t.CLASS footer b { float: right; }\n</style>\n\n<settings>\n\t<div class=\"padding\">\n\t\t<div class=\"row m\">\n\t\t\t<div class=\"col-md-4\">\n\t\t\t\t<div data---=\"input__?.host__placeholder:test.mosquitto.org;required:1\">Hostname or IP address</div>\n\t\t\t</div>\n\t\t\t<div class=\"col-md-4\">\n\t\t\t\t<div data---=\"input__?.port__type:number;placeholder:1883;required:1\">Port</div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class=\"row\">\n\t\t\t<div class=\"col-md-6\">\n\t\t\t\t<div data---=\"input__?.clientid\">Client id</div>\n\t\t\t\t<div class=\"help m\">Supports variables, example: \\`client_{device-id}\\`</div>\n\t\t\t\t<div data---=\"checkbox__?.secure\" class=\"m\">Secure (ssl)</div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class=\"row\">\n\t\t\t<div class=\"col-md-6\">\n\t\t\t\t<div data---=\"checkbox__?.auth\" class=\"m\">Require Authorization</div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class=\"row\" data-bind=\"?.auth__show:value\">\n\t\t\t<div class=\"col-md-6\">\n\t\t\t\t<div data---=\"input__?.username\" class=\"m\">Username</div>\n\t\t\t</div>\n\t\t\t<div class=\"col-md-6\">\n\t\t\t\t<div data---=\"input__?.password\" data-jc-config=\"type:password\" class=\"m\">Password</div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class=\"row\">\n\t\t\t<div class=\"col-md-6\">\n\t\t\t\t<div data---=\"checkbox__?.lwt\" class=\"m\">LWT</div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class=\"row\" data-bind=\"?.lwt__show:value\">\n\t\t\t<div class=\"col-md-6\">\n\t\t\t\t<div data---=\"input__?.lwttopic\">Last will topic</div>\n\t\t\t\t<div class=\"help m\">Supports variables, example: \\`lwt/{device-id}\\`</div>\n\t\t\t</div>\n\t\t\t<div class=\"col-md-6\">\n\t\t\t\t<div data---=\"input__?.lwtmessage\">Last will message</div>\n\t\t\t\t<div class=\"help m\">Supports variables, example: \\`{device-id} is offline\\`</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</settings>\n\n<body>\n\t<header>\n\t\t<i class=\"ICON\"></i>NAME\n\t</header>\n\t<footer>\n\t\t<div data-bind=\"!STATUS__template__show\">\n\t\t\t<script type=\"text/html\">\n\t\t\t\t<div><b>{{ value.name }}</b>Name</div>\n\t\t\t\t<div><b>{{ value.status }}</b>Status</div>\n\t\t\t</script>\n\t\t</div>\n\t</footer>\n</body>",
			"mqtt-subscribe": "<script total>\n\n\texports.name = 'MQTT Subscribe';\n\texports.icon = 'fa fa-sign-in';\n\texports.group = 'MQTT';\n\texports.config = { broker: '' };\n\texports.outputs = [{ id: 'message', name: 'Message' }];\n\texports.author = 'Martin Smola';\n\texports.version = '3';\n\texports.flags = ['mqttbroker-dep'];\n\n\texports.make = function(instance, config) {\n\n\t\tvar subscribed = false;\n\t\tvar broker, topic;\n\n\t\tinstance.configure = function() {\n\n\t\t\tif (subscribed && broker)\n\t\t\t\tbroker.unsubscribe(instance.id, topic);\n\n\t\t\ttopic = config.topic;\n\n\t\t\tbroker = instance.main.find(config.broker);\n\n\t\t\tif (broker) {\n\t\t\t\tbroker.subscribe(instance.id, topic);\n\t\t\t\tsubscribed = true;\n\t\t\t\tinstance.status({ status: broker.state.status + ' (subscribed)', topic });\n\t\t\t} else {\n\t\t\t\tinstance.status({ status: 'Broker not found', topic });\n\t\t\t}\n\t\t};\n\n\t\tinstance.onmessage = function(topic, message, match, ts) {\n\t\t\tinstance.send('message', { topic, message, match, ts });\n\t\t};\n\n\t\tinstance.close = function() {\n\t\t\tif (subscribed && broker)\n\t\t\t\tbroker.unsubscribe(instance.id, topic);\n\t\t};\n\n\t\tinstance.configure();\n\t};\n\n\texports.call = function(data, answer) {\n\t\tvar arr = [];\n\n\t\tvar instances = this.instances();\n\n\t\tinstances = instances.filter(i => i.module.flags && i.module.flags.includes('mqttbroker'));\n\t\tfor (let com of instances)\n\t\t\tarr.push({ id: com.id, name: `${com.state.name} (${com.state.status})` });\n\n\t\tanswer(arr);\n\t};\n</script>\n\n<readme>\nMQTT Subscribe\n</readme>\n\n<style>\n\t.CLASS footer { padding: 10px; font-size: 11px; }\n\t.CLASS footer > div > div { height: 16px; }\n\t.CLASS footer b { float: right; margin-left: 12px; }\n</style>\n\n<script>\n\tON('configure_mqttsubscribe', function(data) {\n\t\tdata.call(function(response) {\n\t\t\tSET('%brokers', response);\n\t\t}, true);\n\t});\n</script>\n\n<settings>\n\t<div class=\"padding\">\n\t\t<div class=\"row\">\n\t\t\t<div class=\"col-md-6\">\n\t\t\t\t<div data---=\"input__?.broker__dirsource:%brokers;dirraw:1;placeholder:Select broker;dirempty:No broker;required:1\" class=\"m\"><b>Broker</b></div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class=\"row\">\n\t\t\t<div class=\"col-md-6\">\n\t\t\t\t<div data---=\"input__?.topic__placeholder:devices/status;required:1\" class=\"m\"><b>Topic</b></div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class=\"row\">\n\t\t\t<div class=\"col-md-12\">\n\t\t\t\t<p>\n\t\t\t\t\t<b>The topic supports wildcards like:</b><br>\n\t\t\t\t\t- devices/+/status -> devices/1/status or devices/123456/status etc.<br>\n\t\t\t\t\t- devices/#        -> any topic begining with devices/.......\n\t\t\t\t</p>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</settings>\n\n<body>\n\t<header>\n\t\t<i class=\"ICON\"></i>NAME\n\t</header>\n\t<footer>\n\t\t<div data-bind=\"!STATUS__template__show\">\n\t\t\t<script type=\"text/html\">\n\t\t\t\t<div><b>{{ value.status }}</b>Status</div>\n\t\t\t\t<div><b>{{ value.topic }}</b>Topic</div>\n\t\t\t</script>\n\t\t</div>\n\t</footer>\n</body>",
			"chatgpt": "<script total>\n\n\texports.id = 'chatgpt';\n\texports.name = 'ChatGPT';\n\texports.icon = 'ti ti-robot-alt';\n\texports.author = 'Total.js';\n\texports.version = '3';\n\texports.group = 'Services';\n\texports.config = { model: 'gpt-3.5-turbo-instruct', apikey: '', question: '' };\n\texports.inputs = [{ id: 'input', name: 'Question' }];\n\texports.outputs = [{ id: 'output', name: 'Answer' }, { id: 'error', name: 'Error' }];\n\n\texports.make = function (instance, config) {\n\n\t\tconst URL = 'https://api.openai.com/v1/completions';\n\n\t\tvar model;\n\t\tvar cfg;\n\n\t\tinstance.message = async function ($) {\n\n\t\t\tvar data = $.data;\n\n\t\t\tif (!data) {\n\t\t\t\t$.send('error', 'Input text is missing');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tswitch (cfg.model) {\n\t\t\t\tcase 'gpt-3.5-turbo-instruct':\n\n\t\t\t\t\tif (data.text)\n\t\t\t\t\t\tdata = data.text;\n\n\t\t\t\t\tif (typeof data !== 'string') {\n\t\t\t\t\t\t$.send('error', 'Error: Wrong input format');\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tRESTBuilder.POST(URL, { model: cfg.model, prompt: config.question ? (config.question + ' ' + data) : data, temperature: 0, max_tokens: 220, frequency_penalty: 2 }).header('Authorization', 'Bearer ' + cfg.apikey).timeout(60000).keepalive().callback(function (err, response, output) {\n\n\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\t$.send('error', err);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (response && response.choices) {\n\t\t\t\t\t\t\tvar text = response.choices[0].text;\n\t\t\t\t\t\t\t$.send('output', text);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'gpt-3.5-turbo':\n\t\t\t\tcase 'gpt-4':\n\n\t\t\t\t\tvar messages = $.data.messages || $.data;\n\n\t\t\t\t\tif (!(messages instanceof Array)) {\n\t\t\t\t\t\t$.send('error', 'Error: Input must be array of messages');\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!messages[0] || !messages[0].role) {\n\t\t\t\t\t\t$.send('error', 'Error: Each message object must have message role attribute : user or assistant or system');\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tconfig.question && messages.unshift({ role: 'user', content: config.question });\n\n\n\t\t\t\t\tvar url = 'https://api.openai.com/v1/chat/completions';\n\t\t\t\t\tRESTBuilder.POST(url, { model: cfg.model, messages: messages }).header('Authorization', 'Bearer ' + cfg.apikey).timeout(60000).keepalive().callback(function (err, response, output) {\n\n\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\t$.send('error', err);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (response && response.choices) {\n\t\t\t\t\t\t\tvar text = response.choices[0].message.content;\n\n\t\t\t\t\t\t\t$.send('output', text);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'whisper-1':\n\t\t\t\t\tvar path = $.data.path || $.data;\n\n\t\t\t\t\tvar url = 'https://api.openai.com/v1/audio/transcriptions';\n\t\t\t\t\tRESTBuilder.POST(url, { model: cfg.model }).header('Authorization', 'Bearer ' + cfg.apikey).file('file', path).timeout(60000).keepalive().callback(function (err, response, output) {\n\n\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\t$.send('error', err);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (response && response)\n\t\t\t\t\t\t\t$.send('output', response);\n\n\t\t\t\t\t});\n\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t};\n\n\t\tinstance.configure = function () {\n\t\t\tcfg = instance.replace(config);\n\t\t};\n\n\t\tinstance.configure();\n\t};\n</script>\n\n<readme>\nThis component can talk to ChatGPT.\n\n## Input\n\nInput will depend on selected model\n\n- __CPT 3.5 Turbo__ and __CPT 4__\n```js\n\n// Object\n{\nmessages : [{ role: 'user', content: 'Text' }]\n}\n\n// or\n\n\n// Array\n[{ role: 'assistant', content: 'Text' }]\n```\n\n- __Whisper__\n```js\n\n// Object\n{\npath : 'path-to-file'\n}\n\n// or\n\n\n// String\n'path-to-file'\n```\n\n- __CPT 3.5 Turbo instruct__\n```js\n\n// Object\n{\ntext : 'your question'\n}\n\n// or\n\n\n// String\n'your question'\n```\n\n\n## Output\n\nOutput also depends on selected model\n- __CPT 3.5 Turbo__ and __CPT 4__\n```js\n'Response from assistant'\n```\n\n- __Whisper__\n```js\n\n// Object\n{\ntext : 'transcipted text'\n}\n```\n- __CPT 3.5 Turbo instruct__\n```js\n\n// String\n'Response from assistant'\n```\n</readme>\n\n<settings>\n\t<div class=\"padding\">\n\t\t<div class=\"m\">\n\t\t\t<ui-component name=\"input\" path=\"?.apikey\" config=\"camouflage:1;required:1\">API key</ui-component>\n\t\t\t<div class=\"help\"><a href=\"https://platform.openai.com/account/api-keys\" target=\"_blank\"><i class=\"ti ti-external\"></i>Generate API key</a></div>\n\t\t</div>\n\t\t<div class=\"m\">\n\t\t\t<ui-component name=\"input\" path=\"?.model\" config=\"type:select;dirsource:gpt-4|GPT 4,gpt-3.5-turbo|GPT 3.5 Turbo,gpt-3.5-turbo-instruct|GPT 3.5 Turbo instruct,Whisper|whisper-1\">Model</ui-component>\n\t\t</div>\n\t\t<div class=\"m\">\n\t\t\t<ui-component name=\"input\" path=\"?.question\" config=\"type:multiline\">Question</ui-component>\n\t\t\t<div class=\"help\">This question will be added before your messages</div>\n\t\t</div>\n\t</div>\n</settings>\n\n<body>\n\t<header>\n\t\t<i class=\"ICON\"></i>NAME\n\t</header>\n</body>",
			"trigger": "<script total>\n\n\texports.id = 'trigger';\n\texports.name = 'Trigger';\n\texports.group = 'Triggers';\n\texports.version = '5';\n\texports.icon = 'ti ti-start';\n\texports.author = 'Total.js';\n\texports.config = { random: true, type: 'string', data: '', restart: false, prompt: false };\n\texports.outputs = [{ id: 'output', name: 'Output' }];\n\texports.kind = 'trigger';\n\n\texports.make = function(instance, config) {\n\n\t\tvar regprompt = /\\{prompt\\}/g;\n\n\t\tinstance.trigger = function(msg) {\n\n\t\t\tvar random = !config.prompt && config.random;\n\t\t\tvar val = config.data;\n\t\t\tvar prompt = msg.value || '';\n\n\t\t\tswitch (config.type) {\n\t\t\t\tcase 'number':\n\t\t\t\t\tval = random ? U.random() : val.replace(regprompt, prompt).parseFloat();\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'buffer':\n\t\t\t\t\ttry {\n\t\t\t\t\t\tval = random ? Buffer.from(U.random_string()) : Buffer.from(val.replace(regprompt, prompt), 'base64');\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tinstance.throw(e);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'date':\n\t\t\t\t\tval = random ? NOW.add('-' + U.random(500, 10) + ' seconds') : val.replace(regprompt, prompt).parseDate();\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'object':\n\t\t\t\t\ttry {\n\t\t\t\t\t\tval = random ? {} : (new Function('return ' + val.replace(regprompt, prompt)))();\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tinstance.throw(e);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'boolean':\n\t\t\t\t\tvar tmp = random ? '' : val.replace(regprompt, prompt);\n\t\t\t\t\tval = random ? U.random() % 2 === 0 : tmp === 'true' || tmp === 'on' || tmp === '1';\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tval = random ? U.random_string(20) : val.replace(regprompt, prompt);\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tinstance.send('output', val);\n\t\t};\n\n\t\tconfig.restart && setTimeout(() => instance.trigger(), 5000);\n\t};\n\n</script>\n\n<style>\n\t.CLASS .padding { padding: 0 10px 10px; }\n\t.CLASS button { width: 100%; height: 24px; border: 1px solid #E0E0E0; border-radius: var(--radius); color: #000; background-color: #F0F0F0; margin: 0; }\n\t.CLASS button:hover { background-color: #F8F8F8; }\n\t.CLASS button:active { background-color: #E0E0E0; }\n\t.ui-dark .CLASS button { border-color: #404040; color: #FFF; background-color: #222; }\n\t.ui-dark .CLASS button:hover { background-color: #303030; }\n\t.ui-dark .CLASS button:active { background-color: #404040; }\n</style>\n\n<settings>\n\t<div class=\"padding\">\n\t\t<ui-component name=\"input\" path=\"?.type\" config=\"dirsource:string|String,number|Number,boolean|Boolean,date|Date,object|Object,buffer|Buffer as Base64;required:1\">Type</ui-component>\n\t\t<div class=\"mt10 m\">\n\t\t\t<ui-component name=\"input\" path=\"?.restart\" config=\"type:checkbox\">Trigger 5s after initialization.</ui-component>\n\t\t\t<ui-component name=\"input\" path=\"?.prompt\" config=\"type:checkbox\">Prompt</ui-component>\n\t\t\t<ui-bind path=\"?.prompt\" config=\"disabled\" class=\"block\">\n\t\t\t\t<ui-component name=\"input\" path=\"?.random\" config=\"type:checkbox\">Random data</ui-component>\n\t\t\t</ui-bind>\n\t\t\t<ui-bind path=\"?.prompt\" config=\"show\" class=\"block hidden m mt10\">\n\t\t\t\t<ui-component name=\"input\" path=\"?.promptlabel\" config=\"placeholder:Enter a value\"><b>Prompt label</b></ui-component>\n\t\t\t</ui-bind>\n\t\t</div>\n\t\t<ui-bind path=\"?\" config=\"hide:!value.prompt && (value.random && !value.prompt)\" class=\"hidden\">\n\t\t\t<hr />\n\t\t\t<ui-component name=\"input\" path=\"?.data\" config=\"required:1;height:250;type:multiline;maxlength:100000;monospace:1\">Data</ui-component>\n\t\t\t<ui-bind path=\"?.prompt\" config=\"show\" class=\"help hidden\">The prompt value will be assigned to the <code>{prompt}</code> keyword in the code.</ui-bind>\n\t\t</ui-bind>\n\t</div>\n</settings>\n\n<readme>\nThe component triggers data into the Flow.\n</readme>\n\n<body>\n\t<header>\n\t\t<i class=\"$ICON\"></i>$NAME\n\t</header>\n\t<div class=\"padding\">\n\t\t<button name=\"run\">Run</button>\n\t</div>\n</body>\n\n<script>\n\tTOUCH(function(exports) {\n\t\texports.click = function(el) {\n\t\t\tif (exports.config.prompt) {\n\t\t\t\tvar opt = {};\n\t\t\t\topt.name = exports.config.promptlabel || 'Enter a value';\n\t\t\t\topt.value = '';\n\t\t\t\topt.callback = val => exports.trigger({ value: val });\n\t\t\t\tSETTER('prompt/show', opt);\n\t\t\t} else\n\t\t\t\texports.trigger();\n\t\t};\n\t});\n</script>",
			"digiSenseInput": "<html><head><meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\"><script total>\r\n    exports.id = 'digisense_trigger_dashboard';\r\n    exports.name = 'Digisense trigger Dashboard';\r\n    exports.icon = 'ti ti-plug';\r\n    exports.author = 'Oussama Farhat';\r\n    exports.version = '1.0.3';\r\n    exports.group = 'Custom';\r\n    exports.npm = ['socket.io-client'];\r\n    exports.flag = ['socket.io-client'];\r\n    exports.config = {\r\n        flowName:undefined,\r\n        isRegistered:false,\r\n        url: 'https://cloud.digisense.es',\r\n        token: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOjEyLCJ0ZW5hbnRJZCI6MTUsImVtYWlsIjoieWFzc2luZUBkaWdpc2Vuc2UuZXMiLCJyb2xlIjoiIiwicGVybWlzc2lvbnMiOltdLCJpYXQiOjE3NDcwOTI5NTMsImV4cCI6MTc3ODYyODk1M30.J_iq86wIQ92QFsiUzJpZEewbiw50EhSldx-_F9DaqvA',\r\n        inputName:undefined\r\n    };\r\n    \r\n    exports.inputs = [];\r\n    \r\n    exports.outputs = [\r\n        { id: 'output', name: 'Output' },\r\n        { id: 'status', name: 'Stauts' },\r\n    ];\r\n    \r\n    exports.make = function(instance, config) {\r\n        let socket;\r\n    \r\n    \r\n        instance.configure = function(config) {\r\n            console.log(\"Connecting to Socket.IO...\");\r\n            connectSocketIO();\r\n        };\r\n        function connectSocketIO() {\r\n            if (socket) {\r\n                socket.disconnect();\r\n                socket = null;\r\n            }\r\n    \r\n            instance.status({ text: 'connecting to socket now ....', color: '#c0392b' });\r\n            console.log(\"connect sockett\");\r\n    \r\n                const io = require('socket.io-client');\r\n    \r\n                socket = io(config.url, {\r\n                    transports: ['websocket']\r\n                });\r\n    \r\n                const eventName = `analyticData/${config.flowName}/${config.inputName}`;\r\n    \r\n                socket.on('connect', () => {\r\n                    instance.status({ text: `Connected: ${eventName}`, color: '#27ae60' });\r\n                });\r\n    \r\n                socket.on(eventName, (payload) => {\r\n                    instance.send('output', payload);\r\n                });\r\n    \r\n                socket.on('disconnect', () => {\r\n                    instance.status({ text: 'Disconnected', color: '#c0392b' });\r\n                });\r\n    \r\n                socket.on('connect_error', err => {\r\n                    instance.throw(`Socket.IO error: ${err.message}`);\r\n                    instance.status({ text: 'Connected', color: '#c0392b' });\r\n                });\r\n    \r\n    \r\n        }\r\n    \r\n        instance.close = function() {\r\n            if (socket)\r\n                socket.disconnect();\r\n        };\r\n    \r\n    \r\n    \r\n    };\r\n    </script>\r\n    </head>\r\n    <settings>\r\n    \r\n        <div class=\"padding\">\r\n            <div class=\"form-group\">\r\n                <ui-component name=\"input\" path=\"?.url\" config=\"placeholder:https://cloud.digisense.es;required:1\">\r\n                    API URL\r\n                </ui-component>\r\n            </div>\r\n            <div class=\"form-group\">\r\n                <ui-component name=\"textarea\" path=\"?.token\" config=\"placeholder:1;\">\r\n                    Bearer Token (JWT)\r\n                </ui-component>\r\n            </div>\r\n            <div class=\"form-group\">\r\n                <ui-component name=\"input\" path=\"?.inputName\" config=\"placeholder:1\">\r\n                    Input Name\r\n                </ui-component>\r\n            </div>\r\n            <div class=\"form-group\">\r\n                <ui-component name=\"input\" path=\"?.flowName\" config=\"placeholder:1\">\r\n                    flow Name\r\n                </ui-component>\r\n            </div>\r\n        </div>\r\n    </settings>\r\n    \r\n    <script>\r\n    TOUCH(function(exports) {\r\n    \r\n    \r\n        exports.settings = function() {\r\n    \r\n        };\r\n    \r\n        exports.configure = function(config) {\r\n            submitInput();\r\n        };\r\n    \r\n        function submitInput(){\r\n            console.log(exports.config.inputName,exports.config.flowName)\r\n            console.log('Token:', exports.config.token);\r\n    \r\n            const body = {\r\n                name:exports.config.inputName ,\r\n                serial:exports.config.flowName,\r\n            };\r\n    \r\n            $.ajax({\r\n                url:  `${exports.config.url}/api/v1/analytic/output` ,\r\n                type: 'POST',\r\n                headers: { Authorization: 'Bearer ' + exports.config.token },\r\n                data:body,\r\n                success(response) {\r\n                    exports.config.isRegisterd = true;\r\n                },\r\n                error(err) {\r\n                    console.error('Failed to register output:', err);\r\n                }\r\n            });\r\n        }\r\n    \r\n    });\r\n    \r\n    \r\n    </script>\r\n    \r\n    <body>\r\n        <header><i class=\"$ICON\"></i> $NAME</header>\r\n        <footer class=\"footer\">AI Platform</footer>\r\n    </body>\r\n    \r\n    <style>\r\n    .footer {\r\n        padding: 10px;\r\n        font-size: 12px;\r\n        color: #888;\r\n    }\r\n    </style>\r\n    </html>"
		},
		"design": {
			"trigger_1747935863313": {
				"id": "trigger_1747935863313",
				"config": {
					"random": true,
					"type": "string",
					"data": "ayoub elharyry",
					"restart": false,
					"prompt": false,
					"promptlabel": "rrrrr"
				},
				"x": 337,
				"y": 358,
				"component": "trigger",
				"connections": {},
				"outputs": [
					{
						"id": "output",
						"name": "Output"
					}
				],
				"template": {
					"icon": "ti ti-start",
					"group": "Triggers",
					"name": "Trigger",
					"outputs": [
						{
							"id": "output",
							"name": "Output"
						}
					]
				}
			},
			"digiSenseInput_1747935908298": {
				"id": "digiSenseInput_1747935908298",
				"config": {
					"isRegistered": false,
					"url": "https://cloud.digisense.es",
					"token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOjEyLCJ0ZW5hbnRJZCI6MTUsImVtYWlsIjoieWFzc2luZUBkaWdpc2Vuc2UuZXMiLCJyb2xlIjoiIiwicGVybWlzc2lvbnMiOltdLCJpYXQiOjE3NDcwOTI5NTMsImV4cCI6MTc3ODYyODk1M30.J_iq86wIQ92QFsiUzJpZEewbiw50EhSldx-_F9DaqvA"
				},
				"x": 404.5,
				"y": 233,
				"component": "digiSenseInput",
				"connections": {},
				"outputs": [
					{
						"id": "output",
						"name": "Output"
					},
					{
						"id": "status",
						"name": "Stauts"
					}
				],
				"template": {
					"icon": "ti ti-plug",
					"group": "Custom",
					"name": "Digisense trigger Dashboard",
					"inputs": [],
					"outputs": [
						{
							"id": "output",
							"name": "Output"
						},
						{
							"id": "status",
							"name": "Stauts"
						}
					]
				}
			}
		},
		"variables": {},
		"sources": {},
		"dtcreated": "2025-05-20T17:37:12.645Z",
		"size": 27304,
		"variables2": {},
		"directory": "F:/sync/factory_platform/flowstream/flowstream/",
		"sandbox": false
	},
	"f1nxei001yo51d": {
		"paused": false,
		"id": "f1nxei001yo51d",
		"reference": "",
		"author": "",
		"group": "",
		"icon": "fas fa-user",
		"color": "",
		"version": "",
		"readme": "",
		"url": "23",
		"name": "test",
		"components": {
			"digiSenseInput": "<html><head><meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\"><script total>\r\n    exports.id = 'digisense_trigger_dashboard';\r\n    exports.name = 'Digisense trigger Dashboard';\r\n    exports.icon = 'ti ti-plug';\r\n    exports.author = 'Oussama Farhat';\r\n    exports.version = '1.0.3';\r\n    exports.group = 'Custom';\r\n    exports.npm = ['socket.io-client'];\r\n    exports.flag = ['socket.io-client'];\r\n    exports.config = {\r\n        flowName:undefined,\r\n        isRegistered:false,\r\n        url: 'https://cloud.digisense.es',\r\n        token: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOjEyLCJ0ZW5hbnRJZCI6MTUsImVtYWlsIjoieWFzc2luZUBkaWdpc2Vuc2UuZXMiLCJyb2xlIjoiIiwicGVybWlzc2lvbnMiOltdLCJpYXQiOjE3NDcwOTI5NTMsImV4cCI6MTc3ODYyODk1M30.J_iq86wIQ92QFsiUzJpZEewbiw50EhSldx-_F9DaqvA',\r\n        inputName:undefined\r\n    };\r\n    \r\n    exports.inputs = [];\r\n    \r\n    exports.outputs = [\r\n        { id: 'output', name: 'Output' },\r\n        { id: 'status', name: 'Stauts' },\r\n    ];\r\n    \r\n    exports.make = function(instance, config) {\r\n        let socket;\r\n    \r\n    \r\n        instance.configure = function(config) {\r\n            console.log(\"Connecting to Socket.IO...\");\r\n            connectSocketIO();\r\n        };\r\n        function connectSocketIO() {\r\n            if (socket) {\r\n                socket.disconnect();\r\n                socket = null;\r\n            }\r\n    \r\n            instance.status({ text: 'connecting to socket now ....', color: '#c0392b' });\r\n            console.log(\"connect sockett\");\r\n    \r\n                const io = require('socket.io-client');\r\n    \r\n                socket = io(config.url, {\r\n                    transports: ['websocket']\r\n                });\r\n    \r\n                const eventName = `analyticData/${config.flowName}/${config.inputName}`;\r\n    \r\n                socket.on('connect', () => {\r\n                    instance.status({ text: `Connected: ${eventName}`, color: '#27ae60' });\r\n                });\r\n    \r\n                socket.on(eventName, (payload) => {\r\n                    instance.send('output', payload);\r\n                });\r\n    \r\n                socket.on('disconnect', () => {\r\n                    instance.status({ text: 'Disconnected', color: '#c0392b' });\r\n                });\r\n    \r\n                socket.on('connect_error', err => {\r\n                    instance.throw(`Socket.IO error: ${err.message}`);\r\n                    instance.status({ text: 'Connected', color: '#c0392b' });\r\n                });\r\n    \r\n    \r\n        }\r\n    \r\n        instance.close = function() {\r\n            if (socket)\r\n                socket.disconnect();\r\n        };\r\n    \r\n    \r\n    \r\n    };\r\n    </script>\r\n    </head>\r\n    <settings>\r\n    \r\n        <div class=\"padding\">\r\n            <div class=\"form-group\">\r\n                <ui-component name=\"input\" path=\"?.url\" config=\"placeholder:https://cloud.digisense.es;required:1\">\r\n                    API URL\r\n                </ui-component>\r\n            </div>\r\n            <div class=\"form-group\">\r\n                <ui-component name=\"textarea\" path=\"?.token\" config=\"placeholder:1;\">\r\n                    Bearer Token (JWT)\r\n                </ui-component>\r\n            </div>\r\n            <div class=\"form-group\">\r\n                <ui-component name=\"input\" path=\"?.inputName\" config=\"placeholder:1\">\r\n                    Input Name\r\n                </ui-component>\r\n            </div>\r\n            <div class=\"form-group\">\r\n                <ui-component name=\"input\" path=\"?.flowName\" config=\"placeholder:1\">\r\n                    flow Name\r\n                </ui-component>\r\n            </div>\r\n        </div>\r\n    </settings>\r\n    \r\n    <script>\r\n    TOUCH(function(exports) {\r\n    \r\n    \r\n        exports.settings = function() {\r\n    \r\n        };\r\n    \r\n        exports.configure = function(config) {\r\n            submitInput();\r\n        };\r\n    \r\n        function submitInput(){\r\n            console.log(exports.config.inputName,exports.config.flowName)\r\n            console.log('Token:', exports.config.token);\r\n    \r\n            const body = {\r\n                name:exports.config.inputName ,\r\n                serial:exports.config.flowName,\r\n            };\r\n    \r\n            $.ajax({\r\n                url:  `${exports.config.url}/api/v1/analytic/output` ,\r\n                type: 'POST',\r\n                headers: { Authorization: 'Bearer ' + exports.config.token },\r\n                data:body,\r\n                success(response) {\r\n                    exports.config.isRegisterd = true;\r\n                },\r\n                error(err) {\r\n                    console.error('Failed to register output:', err);\r\n                }\r\n            });\r\n        }\r\n    \r\n    });\r\n    \r\n    \r\n    </script>\r\n    \r\n    <body>\r\n        <header><i class=\"$ICON\"></i> $NAME</header>\r\n        <footer class=\"footer\">AI Platform</footer>\r\n    </body>\r\n    \r\n    <style>\r\n    .footer {\r\n        padding: 10px;\r\n        font-size: 12px;\r\n        color: #888;\r\n    }\r\n    </style>\r\n    </html>",
			"mqtt-broker": "<script total>\n\n\texports.id = 'mqttbroker';\n\texports.name = 'MQTT Broker';\n\texports.icon = 'ti ti-exchange';\n\texports.group = 'MQTT';\n\texports.config = { host: 'localhost', port: 1883, secure: false };\n\texports.outputs = [{ id: 'output', name: 'Messages' }];\n\texports.author = 'Martin Smola';\n\texports.version = '3';\n\texports.npm = ['mqtt'];\n\texports.flags = ['mqttbroker'];\n\n\texports.make = function(instance, config) {\n\n\t\tconst mqtt = require('mqtt');\n\t\tvar client;\n\t\tconst subscribtions = {};\n\n\t\tconst state = () => {\n\t\t\tvar obj;\n\t\t\tif (!client) {\n\t\t\t\tobj = { connected: false, connecting: false, disconnected: true, disconnnecting: false, status: 'disconnected' };\n\t\t\t} else {\n\t\t\t\tconst { connected, disconnecting, reconnecting } = client;\n\t\t\t\tobj = { connecting: client.stream ? client.stream.connecting : false, connected, disconnecting, reconnecting };\n\t\t\t\tconst current = Object.keys(obj).filter(s => obj[s]);\n\t\t\t\tobj.status = current.length ? current[0] : 'disconnected';\n\t\t\t}\n\n\t\t\tinstance.state = { status: obj.status, name: config.host + ':' + config.port };\n\t\t\tinstance.status(instance.state);\n\t\t\treturn obj;\n\t\t};\n\n\t\tinstance.configure = function() {\n\t\t\tdisconnect(connect);\n\t\t};\n\n\t\tinstance.close = function() {\n\t\t\tdisconnect(notifypubsub);\n\t\t};\n\n\t\tinstance.configure();\n\n\t\tfunction disconnect(callback) {\n\t\t\tif (!client)\n\t\t\t\treturn callback && callback();\n\n\t\t\tif (client.end)\n\t\t\t\tclient.end(true, cb);\n\t\t\telse\n\t\t\t\tcb();\n\n\t\t\tfunction cb() {\n\t\t\t\tclient.removeAllListeners();\n\t\t\t\tclient = null;\n\t\t\t\tcallback && callback();\n\t\t\t};\n\t\t};\n\n\t\tfunction connect() {\n\n\t\t\tstate();\n\n\t\t\tvar broker = config.secure ? 'mqtts://' : 'mqtt://' + config.host + ':' + config.port;\n\t\t\tconfig.name = '[MQTT] ' + config.host + ':' + config.port;\n\t\t\tvar opt = CLONE(config);\n\t\t\tdelete opt.auth;\n\t\t\tclient = mqtt.connect(broker, opt);\n\n\t\t\tclient.on('connect', function() {\n\t\t\t\tstate();\n\t\t\t\tnotifypubsub();\n\t\t\t});\n\n\t\t\tclient.on('reconnect', function() {\n\t\t\t\tstate();\n\t\t\t});\n\n\t\t\tclient.on('message', function(topic, message) {\n\t\t\t\tmessage = message.toString();\n\t\t\t\tif (message[0] === '{' || message[0] === '[')\n\t\t\t\t\tmessage = message.parseJSON(true);\n\n\t\t\t\tonmessage(topic, message);\n\t\t\t});\n\n\t\t\tclient.on('close', function(err) {\n\t\t\t\tconsole.log(config.name + ' close', err);\n\t\t\t\tstate();\n\t\t\t});\n\n\t\t\tclient.on('error', function(err) {\n\t\t\t\tconsole.log(config.name + ' error', err);\n\t\t\t\tstate();\n\t\t\t});\n\t\t};\n\n\t\tfunction onmessage(topic, message) {\n\t\t\tlet ts = new Date();\n\t\t\tfor (const sub in subscribtions) {\n\t\t\t\tvar match = mqttWildcard(topic, sub);\n\t\t\t\tif (match) {\n\t\t\t\t\tconst ids = subscribtions[sub];\n\t\t\t\t\tconst len = ids.length;\n\t\t\t\t\tfor (let i = 0; i < len; i++) {\n\t\t\t\t\t\tconst com = instance.main.find(ids[i]);\n\t\t\t\t\t\tcom && com.onmessage(topic, message, match, ts);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tinstance.send('output', { topic, message, ts });\n\t\t}\n\n\t\tinstance.publish = function(topic, message, options) {\n\t\t\tvar isstring = typeof(message) === 'string';\n\t\t\tvar data = '';\n\t\t\tif (isstring)\n\t\t\t\tdata = message;\n\t\t\telse\n\t\t\t\ttry {\n\t\t\t\t\tdata = JSON.stringify(message);\n\t\t\t\t} catch(e) {}\n\n\t\t\tclient && client.publish(topic, data, options, function(err){\n\t\t\t\tif (err)\n\t\t\t\t\tconsole.log(config.name + ' publish error', err);\n\t\t\t});\n\t\t};\n\n\t\tinstance.subscribe = function(componentid, topic) {\n\t\t\tvar self = this;\n\t\t\tsubscribtions[topic] = subscribtions[topic] || [];\n\t\t\tif (subscribtions[topic].indexOf(componentid) > -1)\n\t\t\t\treturn;\n\n\t\t\tclient.subscribe(topic);\n\t\t\tsubscribtions[topic].push(componentid);\n\t\t};\n\n\t\tinstance.unsubscribe = function(componentid, topic) {\n\t\t\tvar self = this;\n\t\t\tvar sub = subscribtions[topic];\n\t\t\tif (sub) {\n\t\t\t\tsubscribtions[topic] = sub.remove(componentid);\n\t\t\t\tclient && client.connected && !subscribtions[topic].length && client.unsubscribe(topic);\n\t\t\t}\n\t\t};\n\n\t\tfunction notifypubsub() {\n\t\t\tvar instances = instance.main.instances().filter(i => i.module.flags && i.module.flags.includes('mqttbroker-dep') > -1 && i.config.broker === instance.id);\n\t\t\tfor (let com of instances)\n\t\t\t\tcom.configure();\n\t\t}\n\n\t\t// https://github.com/hobbyquaker/mqtt-wildcard\n\t\tfunction mqttWildcard(topic, wildcard) {\n\t\t\tif (topic === wildcard) {\n\t\t\t\treturn [];\n\t\t\t} else if (wildcard === '#') {\n\t\t\t\treturn [topic];\n\t\t\t}\n\n\t\t\tvar res = [];\n\n\t\t\tvar t = String(topic).split('/');\n\t\t\tvar w = String(wildcard).split('/');\n\n\t\t\tvar i = 0;\n\t\t\tfor (var lt = t.length; i < lt; i++) {\n\t\t\t\tif (w[i] === '+') {\n\t\t\t\t\tres.push(t[i]);\n\t\t\t\t} else if (w[i] === '#') {\n\t\t\t\t\tres.push(t.slice(i).join('/'));\n\t\t\t\t\treturn res;\n\t\t\t\t} else if (w[i] !== t[i]) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (w[i] === '#') {\n\t\t\t\ti += 1;\n\t\t\t}\n\n\t\t\treturn (i === w.length) ? res : null;\n\t\t}\n\t};\n\n</script>\n\n<readme>\n\n</readme>\n\n<style>\n\t.CLASS footer { padding: 10px; font-size: 11px; }\n\t.CLASS footer > ui-bind > div { height: 16px; }\n\t.CLASS footer b { float: right; }\n</style>\n\n<settings>\n\t<div class=\"padding\">\n\t\t<div class=\"row m\">\n\t\t\t<div class=\"col-md-4\">\n\t\t\t\t<ui-component name=\"input\" path=\"?.host\" config=\"placeholder:test.mosquitto.org;required:1\">Hostname or IP address</ui-component>\n\t\t\t</div>\n\t\t\t<div class=\"col-md-4\">\n\t\t\t\t<ui-component name=\"input\" path=\"?.port\" config=\"type:number;placeholder:1883;required:1;format:\">Port</ui-component>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class=\"row\">\n\t\t\t<div class=\"col-md-6\">\n\t\t\t\t<ui-component name=\"input\" path=\"?.clientid\">Client id</ui-component>\n\t\t\t\t<div class=\"help m\">Supports variables, example: \\`client_{device-id}\\`</div>\n\t\t\t\t<ui-component name=\"checkbox\" path=\"?.secure\" class=\"m\">Secure (ssl)</ui-component>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class=\"row\">\n\t\t\t<div class=\"col-md-6\">\n\t\t\t\t<ui-component name=\"checkbox\" path=\"?.auth\" class=\"m\">Require Authorization</ui-component>\n\t\t\t</div>\n\t\t</div>\n\t\t<ui-bind path=\"?.auth\" config=\"show:value\" class=\"row block\">\n\t\t\t<div class=\"col-md-6\">\n\t\t\t\t<ui-component name=\"input\" path=\"?.username\" class=\"m\">Username</ui-component>\n\t\t\t</div>\n\t\t\t<div class=\"col-md-6\">\n\t\t\t\t<ui-component name=\"input\" path=\"?.password\" data-jc-config=\"type:password\" class=\"m\">Password</ui-component>\n\t\t\t</div>\n\t\t</ui-bind>\n\t\t<div class=\"row\">\n\t\t\t<div class=\"col-md-6\">\n\t\t\t\t<ui-component name=\"checkbox\" path=\"?.lwt\" class=\"m\">LWT</ui-component>\n\t\t\t</div>\n\t\t</div>\n\t\t<ui-bind path=\"?.lwt\" config=\"show:value\" class=\"row block\">\n\t\t\t<div class=\"col-md-6\">\n\t\t\t\t<ui-component name=\"input\" path=\"?.lwttopic\">Last will topic</ui-component>\n\t\t\t\t<div class=\"help m\">Supports variables, example: \\`lwt/{device-id}\\`</div>\n\t\t\t</div>\n\t\t\t<div class=\"col-md-6\">\n\t\t\t\t<ui-component name=\"input\" path=\"?.lwtmessage\">Last will message</ui-component>\n\t\t\t\t<div class=\"help m\">Supports variables, example: \\`{device-id} is offline\\`</div>\n\t\t\t</div>\n\t\t</ui-bind>\n\t</div>\n</settings>\n\n<body>\n\t<header>\n\t\t<i class=\"ICON\"></i>NAME\n\t</header>\n\t<footer>\n\t\t<ui-bind path=\"!STATUS\" config=\"template;show\" class=\"block\">\n\t\t\t<script type=\"text/html\">\n\t\t\t\t<div><b>{{ value.name }}</b>Name</div>\n\t\t\t\t<div><b>{{ value.status }}</b>Status</div>\n\t\t\t</script>\n\t\t</ui-bind>\n\t</footer>\n</body>",
			"mqtt-subscribe": "<script total>\n\n\texports.id = 'mqttsubscribe';\n\texports.name = 'MQTT Subscribe';\n\texports.icon = 'ti ti-sign-in';\n\texports.group = 'MQTT';\n\texports.config = { broker: '' };\n\texports.outputs = [{ id: 'message', name: 'Message' }];\n\texports.author = 'Martin Smola';\n\texports.version = '3';\n\texports.flags = ['mqttbroker-dep'];\n\n\texports.make = function(instance, config) {\n\n\t\tvar subscribed = false;\n\t\tvar broker, topic;\n\n\t\tinstance.configure = function() {\n\n\t\t\tif (subscribed && broker)\n\t\t\t\tbroker.unsubscribe(instance.id, topic);\n\n\t\t\ttopic = config.topic;\n\n\t\t\tbroker = instance.main.find(config.broker);\n\n\t\t\tif (broker) {\n\t\t\t\tbroker.subscribe(instance.id, topic);\n\t\t\t\tsubscribed = true;\n\t\t\t\tinstance.status({ status: broker.state.status + ' (subscribed)', topic });\n\t\t\t} else {\n\t\t\t\tinstance.status({ status: 'Broker not found', topic });\n\t\t\t}\n\t\t};\n\n\t\tinstance.onmessage = function(topic, message, match, ts) {\n\t\t\tinstance.send('message', { topic, message, match, ts });\n\t\t};\n\n\t\tinstance.close = function() {\n\t\t\tif (subscribed && broker)\n\t\t\t\tbroker.unsubscribe(instance.id, topic);\n\t\t};\n\n\t\tinstance.configure();\n\t};\n\n\texports.call = function(data, answer) {\n\t\tvar arr = [];\n\n\t\tvar instances = this.instances();\n\n\t\tinstances = instances.filter(i => i.module.flags && i.module.flags.includes('mqttbroker'));\n\t\tfor (let com of instances)\n\t\t\tarr.push({ id: com.id, name: `${com.state.name} (${com.state.status})` });\n\n\t\tanswer(arr);\n\t};\n</script>\n\n<readme>\nMQTT Subscribe\n</readme>\n\n<style>\n\t.CLASS footer { padding: 10px; font-size: 11px; }\n\t.CLASS footer > ui-bind > div { height: 16px; }\n\t.CLASS footer b { float: right; margin-left: 12px; }\n</style>\n\n<script>\n\tON('configure_mqttsubscribe', function(data) {\n\t\tdata.call(function(response) {\n\t\t\tSET('%brokers', response);\n\t\t}, true);\n\t});\n</script>\n\n<settings>\n\t<div class=\"padding\">\n\t\t<div class=\"row\">\n\t\t\t<div class=\"col-md-6\">\n\t\t\t\t<ui-component name=\"input\" path=\"?.broker\" config=\"dirsource:%brokers;dirraw:1;placeholder:Select broker;dirempty:No broker;required:1\" class=\"m\"><b>Broker</b></ui-component>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class=\"row\">\n\t\t\t<div class=\"col-md-6\">\n\t\t\t\t<ui-component name=\"input\" path=\"?.topic\" config=\"placeholder:devices/status;required:1\" class=\"m\"><b>Topic</b></ui-component>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class=\"row\">\n\t\t\t<div class=\"col-md-12\">\n\t\t\t\t<p>\n\t\t\t\t\t<b>The topic supports wildcards like:</b><br>\n\t\t\t\t\t- devices/+/status -> devices/1/status or devices/123456/status etc.<br>\n\t\t\t\t\t- devices/#        -> any topic begining with devices/.......\n\t\t\t\t</p>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</settings>\n\n<body>\n\t<header>\n\t\t<i class=\"ICON\"></i>NAME\n\t</header>\n\t<footer>\n\t\t<ui-bind path=\"!STATUS\" config=\"template;show\">\n\t\t\t<script type=\"text/html\">\n\t\t\t\t<div><b>{{ value.status }}</b>Status</div>\n\t\t\t\t<div><b>{{ value.topic }}</b>Topic</div>\n\t\t\t</script>\n\t\t</ui-bind>\n\t</footer>\n</body>",
			"print": "<script total>\n\n\texports.id = 'print';\n\texports.name = 'Print';\n\texports.group = 'Common';\n\texports.version = '7';\n\texports.icon = 'ti ti-print';\n\texports.author = 'Total.js';\n\texports.config = { repo: false, data: true, text: false };\n\texports.inputs = [{ id: 'input', name: 'Input' }];\n\n\texports.make = function(instance, config) {\n\n\t\tfunction serializer(key, value) {\n\t\t\treturn value && value.type === 'Buffer' && value.data ? ('<Buffer ' + value.data.splice(0, 10).map(n => n.toString(16).padLeft(2, '0')).join('') + '...') : value;\n\t\t}\n\n\t\tinstance.message = function($) {\n\n\t\t\tvar data = $.data;\n\n\t\t\tif (config.data !== false) {\n\t\t\t\tif (data instanceof Buffer)\n\t\t\t\t\tdata = '<Buffer ' + data.toString('hex').substring(0, 10) + '...';\n\t\t\t}\n\n\t\t\tvar count = 0;\n\n\t\t\tfor (var key in config) {\n\t\t\t\tif (config[key])\n\t\t\t\t\tcount++;\n\t\t\t}\n\n\t\t\tvar output = count > 1 ? {} : null;\n\n\t\t\tif (config.repo) {\n\t\t\t\tif (output)\n\t\t\t\t\toutput.repo = $.repo;\n\t\t\t\telse\n\t\t\t\t\toutput = $.repository;\n\t\t\t}\n\n\t\t\tif (config.data) {\n\t\t\t\tif (output)\n\t\t\t\t\toutput.data = $.data;\n\t\t\t\telse\n\t\t\t\t\toutput = $.data;\n\t\t\t}\n\n\t\t\tif (output) {\n\t\t\t\toutput = JSON.stringify(output, serializer);\n\t\t\t\tinstance.status(output, 200);\n\t\t\t}\n\n\t\t\t$.destroy();\n\t\t};\n\n\t\tinstance.trigger = function() {\n\t\t\tinstance.status('');\n\t\t};\n\n\t};\n\n</script>\n\n<style>\n\t.CLASS footer > ui-bind { margin: 10px; }\n\t.CLASS pre { font-size: 10px; margin: 0; padding: 5px; background-color: #F0F0F0; border-radius: var(--radius); }\n\t.CLASS .json { white-space: pre; }\n\t.CLASS .noscrollbar { max-height: 250px; }\n\t.CLASS .readme { position: absolute; position: absolute; font-size: 11px; right: 5px; margin-top: -5px; cursor: pointer; }\n\t.ui-dark .CLASS pre { background-color: #404040; tab-size: 2; }\n</style>\n\n<readme>\nThe component prints incoming data in a JSON format.\n</readme>\n\n<settings>\n\t<div class=\"padding\">\n\t\t<ui-component name=\"input\" path=\"?.repo\" config=\"type:checkbox\">Shows repository</ui-component>\n\t\t<ui-component name=\"input\" path=\"?.data\" config=\"type:checkbox\">Shows data</ui-component>\n\t</div>\n</settings>\n\n<body>\n\t<header>\n\t\t<button class=\"exec button\" data-exec=\"FUNC.trigger\">Clear</button>\n\t\t<i class=\"$ICON\"></i>$NAME\n\t</header>\n\t<footer>\n\t\t<ui-bind path=\"!$STATUS\" config=\"html pre:debugprinter(value);show\" class=\"hidden selectable block\">\n\t\t\t<span class=\"readme\" title=\"Open in new window\"><i class=\"ti ti-window\"></i></span>\n\t\t\t<div class=\"noscrollbar mt5\">\n\t\t\t\t<pre class=\"json\"></pre>\n\t\t\t</div>\n\t\t</ui-bind>\n\t</footer>\n</body>\n\n<script>\n\n\tW.debugprinter = function(value) {\n\t\tif (value) {\n\t\t\tvalue = JSON.parse(value);\n\t\t\tif (typeof(value) === 'string')\n\t\t\t\treturn Thelpers.encode(value);\n\t\t\telse\n\t\t\t\treturn Thelpers.jsonformat(JSON.stringify(value, null, '\\t'));\n\t\t} else\n\t\t\treturn '';\n\t};\n\n\tTOUCH(function(exports, reinit) {\n\n\t\tif (reinit)\n\t\t\treturn;\n\n\t\tvar laststatus;\n\n\t\texports.status = function(status, isinit) {\n\t\t\tlaststatus = status;\n\t\t};\n\n\t\texports.element.on('click', '.readme', function() {\n\t\t\tvar status = laststatus ? JSON.parse(laststatus) : null;\n\n\t\t\tif (status != null) {\n\t\t\t\tif (typeof(status) !== 'string')\n\t\t\t\t\tstatus = JSON.stringify(status, null, '  ');\n\t\t\t} else\n\t\t\t\tstatus = '';\n\n\t\t\tFUNC.readme('Debug', '```json\\n' + status + '\\n```');\n\t\t});\n\n\t});\n</script>"
		},
		"design": {
			"print_1748271301944": {
				"id": "print_1748271301944",
				"config": {
					"repo": false,
					"data": true,
					"text": false
				},
				"x": 891,
				"y": 437.5,
				"component": "print",
				"connections": {},
				"inputs": [
					{
						"id": "input",
						"name": "Input"
					}
				],
				"template": {
					"icon": "ti ti-print",
					"group": "Common",
					"name": "Print",
					"inputs": [
						{
							"id": "input",
							"name": "Input"
						}
					]
				}
			},
			"mqtt-subscribe_1748271302613": {
				"id": "mqtt-subscribe_1748271302613",
				"config": {
					"broker": "mqtt-broker_1748271303166",
					"topic": "nxt/devices/tt/data",
					"%brokers": [
						{
							"id": "mqtt-broker_1748271303166",
							"name": "localhost:1883 (reconnecting)"
						}
					]
				},
				"x": 512,
				"y": 356.5,
				"component": "mqtt-subscribe",
				"connections": {
					"message": [
						{
							"id": "print_1748271301944",
							"index": "input"
						}
					]
				},
				"outputs": [
					{
						"id": "message",
						"name": "Message"
					}
				],
				"template": {
					"icon": "ti ti-sign-in",
					"group": "MQTT",
					"name": "MQTT Subscribe",
					"outputs": [
						{
							"id": "message",
							"name": "Message"
						}
					]
				}
			},
			"mqtt-broker_1748271303166": {
				"id": "mqtt-broker_1748271303166",
				"config": {
					"host": "localhost",
					"port": 1883,
					"secure": false,
					"name": "[MQTT] localhost:1883",
					"password": "nextronic",
					"username": "nextronic",
					"clientid": "testcccc"
				},
				"x": 770,
				"y": 227.5,
				"component": "mqtt-broker",
				"connections": {},
				"outputs": [
					{
						"id": "output",
						"name": "Messages"
					}
				],
				"template": {
					"icon": "ti ti-exchange",
					"group": "MQTT",
					"name": "MQTT Broker",
					"outputs": [
						{
							"id": "output",
							"name": "Messages"
						}
					]
				}
			}
		},
		"variables": {},
		"sources": {},
		"dtcreated": "2025-05-26T14:53:40.843Z",
		"size": 21959,
		"variables2": {},
		"directory": "F:/sync/factory_platform/flowstream/flowstream/",
		"sandbox": false
	},
	"f1nxnd001cw51d": {
		"paused": false,
		"id": "f1nxnd001cw51d",
		"reference": "",
		"author": "",
		"group": "",
		"icon": "fas fa-user",
		"color": "",
		"version": "",
		"readme": "",
		"url": "21",
		"name": "tt",
		"components": {
			"mqtt-publish": "<script total>\n\n\texports.id = 'mqttpublish';\n\texports.name = 'MQTT Publish';\n\texports.icon = 'ti ti-sign-out';\n\texports.group = 'MQTT';\n\texports.config = { broker: '' };\n\texports.inputs = [{ id: 'message', name: 'Message' }];\n\texports.author = 'Martin Smola';\n\texports.version = '3';\n\texports.flags = ['mqttbroker-dep'];\n\n\texports.make = function(instance, config) {\n\n\t\tinstance.configure = function() {\n\t\t\tvar broker = instance.main.find(config.broker);\n\t\t\tif (!broker)\n\t\t\t\tinstance.status('Broker not found');\n\t\t\telse\n\t\t\t\tinstance.status(broker.state.status);\n\t\t};\n\n\t\tinstance.message = function($) {\n\t\t\tvar broker = instance.main.find(config.broker);\n\t\t\tif (!broker) {\n\t\t\t\t$.destroy();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tbroker.publish($.data.topic, $.data.message);\n\t\t\t$.destroy();\n\t\t};\n\n\t\tinstance.configure();\n\t};\n\n\texports.call = function(data, answer) {\n\t\tvar arr = [];\n\n\t\tvar instances = this.instances();\n\n\t\tinstances = instances.filter(i => i.module.flags && i.module.flags.includes('mqttbroker'));\n\t\tfor (let com of instances)\n\t\t\tarr.push({ id: com.id, name: `${com.state.name} (${com.state.status})` });\n\n\t\tanswer(arr);\n\t};\n</script>\n\n<readme>\nMQTT Publish\n\nInput:\n```javascript\n{\n\ttopic: 'some/topic',\n\tmessage: { some: 'data' },\n\t// optional\n\toptions: {\n\t\tqos: 0|1|2,\n\t\tretain: true|false\n\t}\n}\n```\n</readme>\n\n<style>\n\t.CLASS footer { padding: 10px; font-size: 11px; }\n\t.CLASS footer > ui-bind > div { height: 16px; }\n\t.CLASS footer b { float: right; }\n</style>\n\n<script>\n\tON('configure_mqttpublish', function(data) {\n\t\tdata.call(function(response) {\n\t\t\tSET('%brokers', response);\n\t\t}, true);\n\t});\n</script>\n\n<settings>\n\t<div class=\"padding\">\n\t\t<div class=\"row\">\n\t\t\t<div class=\"col-md-6\">\n\t\t\t\t<ui-component name=\"input\" path=\"?.broker\" config=\"dirsource:%brokers;dirraw:1;placeholder:Select broker;dirempty:No broker;required:1\" class=\"m\"><b>Broker</b></ui-component>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</settings>\n\n<body>\n\t<header>\n\t\t<i class=\"ICON\"></i>NAME\n\t</header>\n\t<footer>\n\t\t<ui-bind path=\"!STATUS\" config=\"template;show\" class=\"block\">\n\t\t\t<script type=\"text/html\">\n\t\t\t\t<div><b>{{ value }}</b>Status</div>\n\t\t\t</script>\n\t\t</ui-bind>\n\t</footer>\n</body>\n",
			"mqtt-broker": "<script total>\n\n\texports.id = 'mqttbroker';\n\texports.name = 'MQTT Broker';\n\texports.icon = 'ti ti-exchange';\n\texports.group = 'MQTT';\n\texports.config = { host: 'localhost', port: 1883, secure: false };\n\texports.outputs = [{ id: 'output', name: 'Messages' }];\n\texports.author = 'Martin Smola';\n\texports.version = '3';\n\texports.npm = ['mqtt'];\n\texports.flags = ['mqttbroker'];\n\n\texports.make = function(instance, config) {\n\n\t\tconst mqtt = require('mqtt');\n\t\tvar client;\n\t\tconst subscribtions = {};\n\n\t\tconst state = () => {\n\t\t\tvar obj;\n\t\t\tif (!client) {\n\t\t\t\tobj = { connected: false, connecting: false, disconnected: true, disconnnecting: false, status: 'disconnected' };\n\t\t\t} else {\n\t\t\t\tconst { connected, disconnecting, reconnecting } = client;\n\t\t\t\tobj = { connecting: client.stream ? client.stream.connecting : false, connected, disconnecting, reconnecting };\n\t\t\t\tconst current = Object.keys(obj).filter(s => obj[s]);\n\t\t\t\tobj.status = current.length ? current[0] : 'disconnected';\n\t\t\t}\n\n\t\t\tinstance.state = { status: obj.status, name: config.host + ':' + config.port };\n\t\t\tinstance.status(instance.state);\n\t\t\treturn obj;\n\t\t};\n\n\t\tinstance.configure = function() {\n\t\t\tdisconnect(connect);\n\t\t};\n\n\t\tinstance.close = function() {\n\t\t\tdisconnect(notifypubsub);\n\t\t};\n\n\t\tinstance.configure();\n\n\t\tfunction disconnect(callback) {\n\t\t\tif (!client)\n\t\t\t\treturn callback && callback();\n\n\t\t\tif (client.end)\n\t\t\t\tclient.end(true, cb);\n\t\t\telse\n\t\t\t\tcb();\n\n\t\t\tfunction cb() {\n\t\t\t\tclient.removeAllListeners();\n\t\t\t\tclient = null;\n\t\t\t\tcallback && callback();\n\t\t\t};\n\t\t};\n\n\t\tfunction connect() {\n\n\t\t\tstate();\n\n\t\t\tvar broker = config.secure ? 'mqtts://' : 'mqtt://' + config.host + ':' + config.port;\n\t\t\tconfig.name = '[MQTT] ' + config.host + ':' + config.port;\n\t\t\tvar opt = CLONE(config);\n\t\t\tdelete opt.auth;\n\t\t\tclient = mqtt.connect(broker, opt);\n\n\t\t\tclient.on('connect', function() {\n\t\t\t\tstate();\n\t\t\t\tnotifypubsub();\n\t\t\t});\n\n\t\t\tclient.on('reconnect', function() {\n\t\t\t\tstate();\n\t\t\t});\n\n\t\t\tclient.on('message', function(topic, message) {\n\t\t\t\tmessage = message.toString();\n\t\t\t\tif (message[0] === '{' || message[0] === '[')\n\t\t\t\t\tmessage = message.parseJSON(true);\n\n\t\t\t\tonmessage(topic, message);\n\t\t\t});\n\n\t\t\tclient.on('close', function(err) {\n\t\t\t\tconsole.log(config.name + ' close', err);\n\t\t\t\tstate();\n\t\t\t});\n\n\t\t\tclient.on('error', function(err) {\n\t\t\t\tconsole.log(config.name + ' error', err);\n\t\t\t\tstate();\n\t\t\t});\n\t\t};\n\n\t\tfunction onmessage(topic, message) {\n\t\t\tlet ts = new Date();\n\t\t\tfor (const sub in subscribtions) {\n\t\t\t\tvar match = mqttWildcard(topic, sub);\n\t\t\t\tif (match) {\n\t\t\t\t\tconst ids = subscribtions[sub];\n\t\t\t\t\tconst len = ids.length;\n\t\t\t\t\tfor (let i = 0; i < len; i++) {\n\t\t\t\t\t\tconst com = instance.main.find(ids[i]);\n\t\t\t\t\t\tcom && com.onmessage(topic, message, match, ts);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tinstance.send('output', { topic, message, ts });\n\t\t}\n\n\t\tinstance.publish = function(topic, message, options) {\n\t\t\tvar isstring = typeof(message) === 'string';\n\t\t\tvar data = '';\n\t\t\tif (isstring)\n\t\t\t\tdata = message;\n\t\t\telse\n\t\t\t\ttry {\n\t\t\t\t\tdata = JSON.stringify(message);\n\t\t\t\t} catch(e) {}\n\n\t\t\tclient && client.publish(topic, data, options, function(err){\n\t\t\t\tif (err)\n\t\t\t\t\tconsole.log(config.name + ' publish error', err);\n\t\t\t});\n\t\t};\n\n\t\tinstance.subscribe = function(componentid, topic) {\n\t\t\tvar self = this;\n\t\t\tsubscribtions[topic] = subscribtions[topic] || [];\n\t\t\tif (subscribtions[topic].indexOf(componentid) > -1)\n\t\t\t\treturn;\n\n\t\t\tclient.subscribe(topic);\n\t\t\tsubscribtions[topic].push(componentid);\n\t\t};\n\n\t\tinstance.unsubscribe = function(componentid, topic) {\n\t\t\tvar self = this;\n\t\t\tvar sub = subscribtions[topic];\n\t\t\tif (sub) {\n\t\t\t\tsubscribtions[topic] = sub.remove(componentid);\n\t\t\t\tclient && client.connected && !subscribtions[topic].length && client.unsubscribe(topic);\n\t\t\t}\n\t\t};\n\n\t\tfunction notifypubsub() {\n\t\t\tvar instances = instance.main.instances().filter(i => i.module.flags && i.module.flags.includes('mqttbroker-dep') > -1 && i.config.broker === instance.id);\n\t\t\tfor (let com of instances)\n\t\t\t\tcom.configure();\n\t\t}\n\n\t\t// https://github.com/hobbyquaker/mqtt-wildcard\n\t\tfunction mqttWildcard(topic, wildcard) {\n\t\t\tif (topic === wildcard) {\n\t\t\t\treturn [];\n\t\t\t} else if (wildcard === '#') {\n\t\t\t\treturn [topic];\n\t\t\t}\n\n\t\t\tvar res = [];\n\n\t\t\tvar t = String(topic).split('/');\n\t\t\tvar w = String(wildcard).split('/');\n\n\t\t\tvar i = 0;\n\t\t\tfor (var lt = t.length; i < lt; i++) {\n\t\t\t\tif (w[i] === '+') {\n\t\t\t\t\tres.push(t[i]);\n\t\t\t\t} else if (w[i] === '#') {\n\t\t\t\t\tres.push(t.slice(i).join('/'));\n\t\t\t\t\treturn res;\n\t\t\t\t} else if (w[i] !== t[i]) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (w[i] === '#') {\n\t\t\t\ti += 1;\n\t\t\t}\n\n\t\t\treturn (i === w.length) ? res : null;\n\t\t}\n\t};\n\n</script>\n\n<readme>\n\n</readme>\n\n<style>\n\t.CLASS footer { padding: 10px; font-size: 11px; }\n\t.CLASS footer > ui-bind > div { height: 16px; }\n\t.CLASS footer b { float: right; }\n</style>\n\n<settings>\n\t<div class=\"padding\">\n\t\t<div class=\"row m\">\n\t\t\t<div class=\"col-md-4\">\n\t\t\t\t<ui-component name=\"input\" path=\"?.host\" config=\"placeholder:test.mosquitto.org;required:1\">Hostname or IP address</ui-component>\n\t\t\t</div>\n\t\t\t<div class=\"col-md-4\">\n\t\t\t\t<ui-component name=\"input\" path=\"?.port\" config=\"type:number;placeholder:1883;required:1;format:\">Port</ui-component>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class=\"row\">\n\t\t\t<div class=\"col-md-6\">\n\t\t\t\t<ui-component name=\"input\" path=\"?.clientid\">Client id</ui-component>\n\t\t\t\t<div class=\"help m\">Supports variables, example: \\`client_{device-id}\\`</div>\n\t\t\t\t<ui-component name=\"checkbox\" path=\"?.secure\" class=\"m\">Secure (ssl)</ui-component>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class=\"row\">\n\t\t\t<div class=\"col-md-6\">\n\t\t\t\t<ui-component name=\"checkbox\" path=\"?.auth\" class=\"m\">Require Authorization</ui-component>\n\t\t\t</div>\n\t\t</div>\n\t\t<ui-bind path=\"?.auth\" config=\"show:value\" class=\"row block\">\n\t\t\t<div class=\"col-md-6\">\n\t\t\t\t<ui-component name=\"input\" path=\"?.username\" class=\"m\">Username</ui-component>\n\t\t\t</div>\n\t\t\t<div class=\"col-md-6\">\n\t\t\t\t<ui-component name=\"input\" path=\"?.password\" data-jc-config=\"type:password\" class=\"m\">Password</ui-component>\n\t\t\t</div>\n\t\t</ui-bind>\n\t\t<div class=\"row\">\n\t\t\t<div class=\"col-md-6\">\n\t\t\t\t<ui-component name=\"checkbox\" path=\"?.lwt\" class=\"m\">LWT</ui-component>\n\t\t\t</div>\n\t\t</div>\n\t\t<ui-bind path=\"?.lwt\" config=\"show:value\" class=\"row block\">\n\t\t\t<div class=\"col-md-6\">\n\t\t\t\t<ui-component name=\"input\" path=\"?.lwttopic\">Last will topic</ui-component>\n\t\t\t\t<div class=\"help m\">Supports variables, example: \\`lwt/{device-id}\\`</div>\n\t\t\t</div>\n\t\t\t<div class=\"col-md-6\">\n\t\t\t\t<ui-component name=\"input\" path=\"?.lwtmessage\">Last will message</ui-component>\n\t\t\t\t<div class=\"help m\">Supports variables, example: \\`{device-id} is offline\\`</div>\n\t\t\t</div>\n\t\t</ui-bind>\n\t</div>\n</settings>\n\n<body>\n\t<header>\n\t\t<i class=\"ICON\"></i>NAME\n\t</header>\n\t<footer>\n\t\t<ui-bind path=\"!STATUS\" config=\"template;show\" class=\"block\">\n\t\t\t<script type=\"text/html\">\n\t\t\t\t<div><b>{{ value.name }}</b>Name</div>\n\t\t\t\t<div><b>{{ value.status }}</b>Status</div>\n\t\t\t</script>\n\t\t</ui-bind>\n\t</footer>\n</body>",
			"mqtt-subscribe": "<script total>\n\n\texports.id = 'mqttsubscribe';\n\texports.name = 'MQTT Subscribe';\n\texports.icon = 'ti ti-sign-in';\n\texports.group = 'MQTT';\n\texports.config = { broker: '' };\n\texports.outputs = [{ id: 'message', name: 'Message' }];\n\texports.author = 'Martin Smola';\n\texports.version = '3';\n\texports.flags = ['mqttbroker-dep'];\n\n\texports.make = function(instance, config) {\n\n\t\tvar subscribed = false;\n\t\tvar broker, topic;\n\n\t\tinstance.configure = function() {\n\n\t\t\tif (subscribed && broker)\n\t\t\t\tbroker.unsubscribe(instance.id, topic);\n\n\t\t\ttopic = config.topic;\n\n\t\t\tbroker = instance.main.find(config.broker);\n\n\t\t\tif (broker) {\n\t\t\t\tbroker.subscribe(instance.id, topic);\n\t\t\t\tsubscribed = true;\n\t\t\t\tinstance.status({ status: broker.state.status + ' (subscribed)', topic });\n\t\t\t} else {\n\t\t\t\tinstance.status({ status: 'Broker not found', topic });\n\t\t\t}\n\t\t};\n\n\t\tinstance.onmessage = function(topic, message, match, ts) {\n\t\t\tinstance.send('message', { topic, message, match, ts });\n\t\t};\n\n\t\tinstance.close = function() {\n\t\t\tif (subscribed && broker)\n\t\t\t\tbroker.unsubscribe(instance.id, topic);\n\t\t};\n\n\t\tinstance.configure();\n\t};\n\n\texports.call = function(data, answer) {\n\t\tvar arr = [];\n\n\t\tvar instances = this.instances();\n\n\t\tinstances = instances.filter(i => i.module.flags && i.module.flags.includes('mqttbroker'));\n\t\tfor (let com of instances)\n\t\t\tarr.push({ id: com.id, name: `${com.state.name} (${com.state.status})` });\n\n\t\tanswer(arr);\n\t};\n</script>\n\n<readme>\nMQTT Subscribe\n</readme>\n\n<style>\n\t.CLASS footer { padding: 10px; font-size: 11px; }\n\t.CLASS footer > ui-bind > div { height: 16px; }\n\t.CLASS footer b { float: right; margin-left: 12px; }\n</style>\n\n<script>\n\tON('configure_mqttsubscribe', function(data) {\n\t\tdata.call(function(response) {\n\t\t\tSET('%brokers', response);\n\t\t}, true);\n\t});\n</script>\n\n<settings>\n\t<div class=\"padding\">\n\t\t<div class=\"row\">\n\t\t\t<div class=\"col-md-6\">\n\t\t\t\t<ui-component name=\"input\" path=\"?.broker\" config=\"dirsource:%brokers;dirraw:1;placeholder:Select broker;dirempty:No broker;required:1\" class=\"m\"><b>Broker</b></ui-component>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class=\"row\">\n\t\t\t<div class=\"col-md-6\">\n\t\t\t\t<ui-component name=\"input\" path=\"?.topic\" config=\"placeholder:devices/status;required:1\" class=\"m\"><b>Topic</b></ui-component>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class=\"row\">\n\t\t\t<div class=\"col-md-12\">\n\t\t\t\t<p>\n\t\t\t\t\t<b>The topic supports wildcards like:</b><br>\n\t\t\t\t\t- devices/+/status -> devices/1/status or devices/123456/status etc.<br>\n\t\t\t\t\t- devices/#        -> any topic begining with devices/.......\n\t\t\t\t</p>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</settings>\n\n<body>\n\t<header>\n\t\t<i class=\"ICON\"></i>NAME\n\t</header>\n\t<footer>\n\t\t<ui-bind path=\"!STATUS\" config=\"template;show\">\n\t\t\t<script type=\"text/html\">\n\t\t\t\t<div><b>{{ value.status }}</b>Status</div>\n\t\t\t\t<div><b>{{ value.topic }}</b>Topic</div>\n\t\t\t</script>\n\t\t</ui-bind>\n\t</footer>\n</body>",
			"print": "<script total>\n\n\texports.id = 'print';\n\texports.name = 'Print';\n\texports.group = 'Common';\n\texports.version = '7';\n\texports.icon = 'ti ti-print';\n\texports.author = 'Total.js';\n\texports.config = { repo: false, data: true, text: false };\n\texports.inputs = [{ id: 'input', name: 'Input' }];\n\n\texports.make = function(instance, config) {\n\n\t\tfunction serializer(key, value) {\n\t\t\treturn value && value.type === 'Buffer' && value.data ? ('<Buffer ' + value.data.splice(0, 10).map(n => n.toString(16).padLeft(2, '0')).join('') + '...') : value;\n\t\t}\n\n\t\tinstance.message = function($) {\n\n\t\t\tvar data = $.data;\n\n\t\t\tif (config.data !== false) {\n\t\t\t\tif (data instanceof Buffer)\n\t\t\t\t\tdata = '<Buffer ' + data.toString('hex').substring(0, 10) + '...';\n\t\t\t}\n\n\t\t\tvar count = 0;\n\n\t\t\tfor (var key in config) {\n\t\t\t\tif (config[key])\n\t\t\t\t\tcount++;\n\t\t\t}\n\n\t\t\tvar output = count > 1 ? {} : null;\n\n\t\t\tif (config.repo) {\n\t\t\t\tif (output)\n\t\t\t\t\toutput.repo = $.repo;\n\t\t\t\telse\n\t\t\t\t\toutput = $.repository;\n\t\t\t}\n\n\t\t\tif (config.data) {\n\t\t\t\tif (output)\n\t\t\t\t\toutput.data = $.data;\n\t\t\t\telse\n\t\t\t\t\toutput = $.data;\n\t\t\t}\n\n\t\t\tif (output) {\n\t\t\t\toutput = JSON.stringify(output, serializer);\n\t\t\t\tinstance.status(output, 200);\n\t\t\t}\n\n\t\t\t$.destroy();\n\t\t};\n\n\t\tinstance.trigger = function() {\n\t\t\tinstance.status('');\n\t\t};\n\n\t};\n\n</script>\n\n<style>\n\t.CLASS footer > ui-bind { margin: 10px; }\n\t.CLASS pre { font-size: 10px; margin: 0; padding: 5px; background-color: #F0F0F0; border-radius: var(--radius); }\n\t.CLASS .json { white-space: pre; }\n\t.CLASS .noscrollbar { max-height: 250px; }\n\t.CLASS .readme { position: absolute; position: absolute; font-size: 11px; right: 5px; margin-top: -5px; cursor: pointer; }\n\t.ui-dark .CLASS pre { background-color: #404040; tab-size: 2; }\n</style>\n\n<readme>\nThe component prints incoming data in a JSON format.\n</readme>\n\n<settings>\n\t<div class=\"padding\">\n\t\t<ui-component name=\"input\" path=\"?.repo\" config=\"type:checkbox\">Shows repository</ui-component>\n\t\t<ui-component name=\"input\" path=\"?.data\" config=\"type:checkbox\">Shows data</ui-component>\n\t</div>\n</settings>\n\n<body>\n\t<header>\n\t\t<button class=\"exec button\" data-exec=\"FUNC.trigger\">Clear</button>\n\t\t<i class=\"$ICON\"></i>$NAME\n\t</header>\n\t<footer>\n\t\t<ui-bind path=\"!$STATUS\" config=\"html pre:debugprinter(value);show\" class=\"hidden selectable block\">\n\t\t\t<span class=\"readme\" title=\"Open in new window\"><i class=\"ti ti-window\"></i></span>\n\t\t\t<div class=\"noscrollbar mt5\">\n\t\t\t\t<pre class=\"json\"></pre>\n\t\t\t</div>\n\t\t</ui-bind>\n\t</footer>\n</body>\n\n<script>\n\n\tW.debugprinter = function(value) {\n\t\tif (value) {\n\t\t\tvalue = JSON.parse(value);\n\t\t\tif (typeof(value) === 'string')\n\t\t\t\treturn Thelpers.encode(value);\n\t\t\telse\n\t\t\t\treturn Thelpers.jsonformat(JSON.stringify(value, null, '\\t'));\n\t\t} else\n\t\t\treturn '';\n\t};\n\n\tTOUCH(function(exports, reinit) {\n\n\t\tif (reinit)\n\t\t\treturn;\n\n\t\tvar laststatus;\n\n\t\texports.status = function(status, isinit) {\n\t\t\tlaststatus = status;\n\t\t};\n\n\t\texports.element.on('click', '.readme', function() {\n\t\t\tvar status = laststatus ? JSON.parse(laststatus) : null;\n\n\t\t\tif (status != null) {\n\t\t\t\tif (typeof(status) !== 'string')\n\t\t\t\t\tstatus = JSON.stringify(status, null, '  ');\n\t\t\t} else\n\t\t\t\tstatus = '';\n\n\t\t\tFUNC.readme('Debug', '```json\\n' + status + '\\n```');\n\t\t});\n\n\t});\n</script>",
			"trigger": "<script total>\n\n\texports.id = 'trigger';\n\texports.name = 'Trigger';\n\texports.group = 'Triggers';\n\texports.version = '5';\n\texports.icon = 'ti ti-start';\n\texports.author = 'Total.js';\n\texports.config = { random: true, type: 'string', data: '', restart: false, prompt: false };\n\texports.outputs = [{ id: 'output', name: 'Output' }];\n\texports.kind = 'trigger';\n\n\texports.make = function(instance, config) {\n\n\t\tvar regprompt = /\\{prompt\\}/g;\n\n\t\tinstance.trigger = function(msg) {\n\n\t\t\tvar random = !config.prompt && config.random;\n\t\t\tvar val = config.data;\n\t\t\tvar prompt = msg.value || '';\n\n\t\t\tswitch (config.type) {\n\t\t\t\tcase 'number':\n\t\t\t\t\tval = random ? U.random() : val.replace(regprompt, prompt).parseFloat();\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'buffer':\n\t\t\t\t\ttry {\n\t\t\t\t\t\tval = random ? Buffer.from(U.random_string()) : Buffer.from(val.replace(regprompt, prompt), 'base64');\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tinstance.throw(e);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'date':\n\t\t\t\t\tval = random ? NOW.add('-' + U.random(500, 10) + ' seconds') : val.replace(regprompt, prompt).parseDate();\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'object':\n\t\t\t\t\ttry {\n\t\t\t\t\t\tval = random ? {} : (new Function('return ' + val.replace(regprompt, prompt)))();\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tinstance.throw(e);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'boolean':\n\t\t\t\t\tvar tmp = random ? '' : val.replace(regprompt, prompt);\n\t\t\t\t\tval = random ? U.random() % 2 === 0 : tmp === 'true' || tmp === 'on' || tmp === '1';\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tval = random ? U.random_string(20) : val.replace(regprompt, prompt);\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tinstance.send('output', val);\n\t\t};\n\n\t\tconfig.restart && setTimeout(() => instance.trigger(), 5000);\n\t};\n\n</script>\n\n<style>\n\t.CLASS .padding { padding: 0 10px 10px; }\n\t.CLASS button { width: 100%; height: 24px; border: 1px solid #E0E0E0; border-radius: var(--radius); color: #000; background-color: #F0F0F0; margin: 0; }\n\t.CLASS button:hover { background-color: #F8F8F8; }\n\t.CLASS button:active { background-color: #E0E0E0; }\n\t.ui-dark .CLASS button { border-color: #404040; color: #FFF; background-color: #222; }\n\t.ui-dark .CLASS button:hover { background-color: #303030; }\n\t.ui-dark .CLASS button:active { background-color: #404040; }\n</style>\n\n<settings>\n\t<div class=\"padding\">\n\t\t<ui-component name=\"input\" path=\"?.type\" config=\"dirsource:string|String,number|Number,boolean|Boolean,date|Date,object|Object,buffer|Buffer as Base64;required:1\">Type</ui-component>\n\t\t<div class=\"mt10 m\">\n\t\t\t<ui-component name=\"input\" path=\"?.restart\" config=\"type:checkbox\">Trigger 5s after initialization.</ui-component>\n\t\t\t<ui-component name=\"input\" path=\"?.prompt\" config=\"type:checkbox\">Prompt</ui-component>\n\t\t\t<ui-bind path=\"?.prompt\" config=\"disabled\" class=\"block\">\n\t\t\t\t<ui-component name=\"input\" path=\"?.random\" config=\"type:checkbox\">Random data</ui-component>\n\t\t\t</ui-bind>\n\t\t\t<ui-bind path=\"?.prompt\" config=\"show\" class=\"block hidden m mt10\">\n\t\t\t\t<ui-component name=\"input\" path=\"?.promptlabel\" config=\"placeholder:Enter a value\"><b>Prompt label</b></ui-component>\n\t\t\t</ui-bind>\n\t\t</div>\n\t\t<ui-bind path=\"?\" config=\"hide:!value.prompt && (value.random && !value.prompt)\" class=\"hidden\">\n\t\t\t<hr />\n\t\t\t<ui-component name=\"input\" path=\"?.data\" config=\"required:1;height:250;type:multiline;maxlength:100000;monospace:1\">Data</ui-component>\n\t\t\t<ui-bind path=\"?.prompt\" config=\"show\" class=\"help hidden\">The prompt value will be assigned to the <code>{prompt}</code> keyword in the code.</ui-bind>\n\t\t</ui-bind>\n\t</div>\n</settings>\n\n<readme>\nThe component triggers data into the Flow.\n</readme>\n\n<body>\n\t<header>\n\t\t<i class=\"$ICON\"></i>$NAME\n\t</header>\n\t<div class=\"padding\">\n\t\t<button name=\"run\">Run</button>\n\t</div>\n</body>\n\n<script>\n\tTOUCH(function(exports) {\n\t\texports.click = function(el) {\n\t\t\tif (exports.config.prompt) {\n\t\t\t\tvar opt = {};\n\t\t\t\topt.name = exports.config.promptlabel || 'Enter a value';\n\t\t\t\topt.value = '';\n\t\t\t\topt.callback = val => exports.trigger({ value: val });\n\t\t\t\tSETTER('prompt/show', opt);\n\t\t\t} else\n\t\t\t\texports.trigger();\n\t\t};\n\t});\n</script>",
			"code": "<script total>\n\n\texports.id = 'code';\n\texports.name = 'Code';\n\texports.group = 'Common';\n\texports.version = '4';\n\texports.icon = 'ti ti-code';\n\texports.author = 'Total.js';\n\texports.config = { outputs: 1, name: 'Code', code: '// instance {FlowStreamInstance};\\n// $ {FlowStreamMessage};\\n// vars {Object};\\n// repo {Object};\\n// data {String/Number/Boolean/Date/Buffer/Object};\\n// $.send(\\'output\\', data); // or simply send(data); which uses the first output\\n// $.destroy();\\n// $.throw(err);\\n\\n// IMPORTANT: If you do not perform re-send, you need to destroy this message via $.destroy() method\\n// IMPORTANT: methods $.send(), $.destroy() and $.throw() can be executed only once\\n\\n// $.send(\\'output\\', data);\\n$.destroy();' };\n\texports.inputs = [{ id: 'input', name: 'Input' }];\n\texports.outputs = [{ id: 'output', name: 'Output' }];\n\texports.meta = { settingswidth: 1200 };\n\n\texports.make = function(instance, config) {\n\n\t\tvar fn;\n\n\t\tinstance.message = function($) {\n\t\t\tif (fn) {\n\t\t\t\ttry {\n\t\t\t\t\tvar send = data => $.send('output', data);\n\t\t\t\t\tfn($.data, instance, $, $, F.require, send, $.repo, $.vars, $.data);\n\t\t\t\t} catch (e) {\n\t\t\t\t\t$.throw(e);\n\t\t\t\t\t$.destroy();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tinstance.configure = function() {\n\t\t\tinstance.outputs = [];\n\t\t\tfor (let i = 1; i <= config.outputs; i++)\n\t\t\t\tinstance.outputs.push({ id: 'output' + (i === 1 ? '' : i), name: 'Output #' + i });\n\t\t\tinstance.save();\n\n\t\t\ttry {\n\t\t\t\tif (config.code) {\n\t\t\t\t\tinstance.status(1);\n\t\t\t\t\tfn = new Function('value', 'instance', '$', 'message', 'require', 'send', 'repo', 'vars', 'data', config.code);\n\t\t\t\t} else {\n\t\t\t\t\tinstance.status(0);\n\t\t\t\t\tfn = null;\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\tfn = null;\n\t\t\t\tinstance.throw('Code: ' + e.message);\n\t\t\t}\n\t\t};\n\n\t\tinstance.close = function() {\n\t\t\tfn = null;\n\t\t};\n\n\t\tinstance.configure();\n\n\t};\n\n</script>\n\n<readme>\nThis component executes a custom JavaScript code as it is.\n\nTo send data to the default output use `send(somedata);`\nTo send data to specific output when number of outputs > 1 use `$.send('outputX', somedata)` where `X` is output index, see example bellow:\n- first output--> `send(somedata)` or `$.send('output', somedata)`\n- second output --> `$.send('output2', somedata)`\n- ...\n- 5th output --> `$.send('output5', somedata)`\n- etc.\n</readme>\n\n<settings>\n\t<div class=\"padding\">\n\t\t<div class=\"row\">\n\t\t\t<div class=\"col-md-10 m\">\n\t\t\t\t<ui-component name=\"input\" path=\"?.name\">Name</ui-component>\n\t\t\t</div>\n\t\t\t<div class=\"col-md-2 m\">\n\t\t\t\t<ui-component name=\"input\" path=\"?.outputs\" config=\"type:number;format:\">Number of outputs</ui-component>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class=\"ui-input-label\">Code:</div>\n\t\t<div class=\"m\">\n\t\t\t<ui-component name=\"codemirror\" path=\"?.code\" config=\"type:javascript;minheight:300;parent:auto;margin:60;tabs:true;trim:true\"></ui-component>\n\t\t</div>\n\t</div>\n</settings>\n\n<script>\n\tTOUCH(function(exports, init) {\n\t\texports.configure = function() {\n\t\t\tvar changes = exports.instance.changes;\n\t\t\tif (changes && changes.newbie) {\n\t\t\t\tvar outputs = [];\n\t\t\t\tvar count = exports.instance.config.outputs;\n\t\t\t\tfor (let i = 1; i <= count; i++)\n\t\t\t\t\toutputs.push({ id: 'output' + (i === 1 ? '' : i), name: (count === 1 ? 'Output' : 'Output #' + i) });\n\t\t\t\texports.instance.outputs = outputs;\n\t\t\t\tUPD('flow.data');\n\t\t\t}\n\t\t}\n\t});\n</script>\n\n<body>\n\t<header>\n\t\t<i class=\"ICON\"></i>NAME\n\t</header>\n</body>"
		},
		"design": {
			"mqtt-subscribe_1748290452879": {
				"id": "mqtt-subscribe_1748290452879",
				"config": {
					"broker": ""
				},
				"x": 519.6136280783367,
				"y": 1032.831081198357,
				"component": "mqtt-subscribe",
				"connections": {},
				"outputs": [
					{
						"id": "message",
						"name": "Message"
					}
				],
				"template": {
					"icon": "ti ti-sign-in",
					"group": "MQTT",
					"name": "MQTT Subscribe",
					"outputs": [
						{
							"id": "message",
							"name": "Message"
						}
					]
				}
			},
			"mqtt-broker_1748290453207": {
				"id": "mqtt-broker_1748290453207",
				"config": {
					"host": "localhost",
					"port": 1883,
					"secure": false,
					"name": "[MQTT] localhost:1883",
					"password": "nextronic",
					"username": "nextronic",
					"clientid": "testddd"
				},
				"x": 528,
				"y": 422.5,
				"component": "mqtt-broker",
				"connections": {},
				"outputs": [
					{
						"id": "output",
						"name": "Messages"
					}
				],
				"template": {
					"icon": "ti ti-exchange",
					"group": "MQTT",
					"name": "MQTT Broker",
					"outputs": [
						{
							"id": "output",
							"name": "Messages"
						}
					]
				}
			},
			"mqtt-publish_1748290453495": {
				"id": "mqtt-publish_1748290453495",
				"config": {
					"broker": "mqtt-broker_1748290453207",
					"%brokers": [
						{
							"id": "mqtt-broker_1748290453207",
							"name": "localhost:1883 (connected)"
						}
					]
				},
				"x": 898,
				"y": 711.5,
				"component": "mqtt-publish",
				"connections": {},
				"inputs": [
					{
						"id": "message",
						"name": "Message"
					}
				],
				"template": {
					"icon": "ti ti-sign-out",
					"group": "MQTT",
					"name": "MQTT Publish",
					"inputs": [
						{
							"id": "message",
							"name": "Message"
						}
					]
				}
			},
			"trigger_1748290499054": {
				"id": "trigger_1748290499054",
				"config": {
					"random": true,
					"type": "string",
					"data": "",
					"restart": false,
					"prompt": false
				},
				"x": 475,
				"y": 682.5,
				"component": "trigger",
				"connections": {
					"output": [
						{
							"id": "print_1748290886133",
							"index": "input"
						},
						{
							"id": "mqtt-publish_1748290453495",
							"index": "message"
						}
					]
				},
				"outputs": [
					{
						"id": "output",
						"name": "Output"
					}
				],
				"template": {
					"icon": "ti ti-start",
					"group": "Triggers",
					"name": "Trigger",
					"outputs": [
						{
							"id": "output",
							"name": "Output"
						}
					]
				}
			},
			"print_1748290511647": {
				"id": "print_1748290511647",
				"config": {
					"repo": false,
					"data": true,
					"text": false
				},
				"x": 1177,
				"y": 793.5,
				"component": "print",
				"connections": {},
				"inputs": [
					{
						"id": "input",
						"name": "Input"
					}
				],
				"template": {
					"icon": "ti ti-print",
					"group": "Common",
					"name": "Print",
					"inputs": [
						{
							"id": "input",
							"name": "Input"
						}
					]
				}
			},
			"code_1748290585342": {
				"id": "code_1748290585342",
				"config": {
					"outputs": 1,
					"name": "Code",
					"code": "// instance {FlowStreamInstance};\n// $ {FlowStreamMessage};\n// vars {Object};\n// repo {Object};\n// data {String/Number/Boolean/Date/Buffer/Object};\n// $.send('output', data); // or simply send(data); which uses the first output\n// $.destroy();\n// $.throw(err);\n\n// IMPORTANT: If you do not perform re-send, you need to destroy this message via $.destroy() method\n// IMPORTANT: methods $.send(), $.destroy() and $.throw() can be executed only once\n\n// $.send('output', data);\n$.destroy();"
				},
				"x": 899,
				"y": 425.5,
				"component": "code",
				"connections": {},
				"outputs": [
					{
						"id": "output",
						"name": "Output #1"
					}
				],
				"inputs": [
					{
						"id": "message",
						"name": "Input"
					}
				],
				"template": {
					"icon": "ti ti-code",
					"group": "Common",
					"name": "Code",
					"inputs": [
						{
							"id": "input",
							"name": "Input"
						}
					],
					"outputs": [
						{
							"id": "output",
							"name": "Output"
						}
					]
				}
			},
			"print_1748290694246": {
				"id": "print_1748290694246",
				"config": {
					"repo": false,
					"data": true,
					"text": false
				},
				"x": 1095.5234375,
				"y": 438.296875,
				"component": "print",
				"connections": {},
				"inputs": [
					{
						"id": "input",
						"name": "Input"
					}
				],
				"template": {
					"icon": "ti ti-print",
					"group": "Common",
					"name": "Print",
					"inputs": [
						{
							"id": "input",
							"name": "Input"
						}
					]
				}
			},
			"print_1748290838573": {
				"id": "print_1748290838573",
				"config": {
					"repo": false,
					"data": true,
					"text": false
				},
				"x": 727.5831145365311,
				"y": 1058.2316560875895,
				"component": "print",
				"connections": {},
				"inputs": [
					{
						"id": "input",
						"name": "Input"
					}
				],
				"template": {
					"icon": "ti ti-print",
					"group": "Common",
					"name": "Print",
					"inputs": [
						{
							"id": "input",
							"name": "Input"
						}
					]
				}
			},
			"print_1748290886133": {
				"id": "print_1748290886133",
				"config": {
					"repo": false,
					"data": true,
					"text": false
				},
				"x": 722.5234375,
				"y": 864.5611405437947,
				"component": "print",
				"connections": {},
				"inputs": [
					{
						"id": "input",
						"name": "Input"
					}
				],
				"template": {
					"icon": "ti ti-print",
					"group": "Common",
					"name": "Print",
					"inputs": [
						{
							"id": "input",
							"name": "Input"
						}
					]
				}
			}
		},
		"variables": {},
		"sources": {},
		"dtcreated": "2025-05-26T20:13:10.026Z",
		"size": 29580
	}
}